import React, { useState, useMemo } from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, LineChart, Line, PieChart, Pie, Cell, ComposedChart, Area } from 'recharts';

// ============================================
// F&F Corporation Q4 2025 Financial Dashboard
// shadcn/ui ìŠ¤íƒ€ì¼ ì ìš©
// ============================================

// ì»¤ìŠ¤í…€ ë„ë„› ì°¨íŠ¸ íˆ´íŒ ì»´í¬ë„ŒíŠ¸
const CustomPieTooltip = ({ active, payload, formatter }) => {
  if (active && payload && payload.length) {
    const data = payload[0];
    const color = data.payload.color;
    const name = data.name;
    const value = formatter ? formatter(data.value) : data.value;
    
    return (
      <div className="bg-white/95 backdrop-blur-sm border border-zinc-200 rounded-lg shadow-lg px-3 py-2 min-w-[160px]">
        <div className="flex items-center gap-2 mb-1">
          <span 
            className="w-2.5 h-2.5 rounded-full flex-shrink-0" 
            style={{ backgroundColor: color }}
          />
          <span className="text-xs font-medium text-zinc-700 whitespace-nowrap">{name}</span>
        </div>
        <div className="text-sm font-semibold text-zinc-900 pl-4 whitespace-nowrap">{value}</div>
      </div>
    );
  }
  return null;
};

// ì»¤ìŠ¤í…€ ì°¨íŠ¸ íˆ´íŒ ì»´í¬ë„ŒíŠ¸
const CustomChartTooltip = ({ active, payload, label }) => {
  if (active && payload && payload.length) {
    return (
      <div className="bg-white/95 backdrop-blur-sm border border-zinc-200 rounded-lg shadow-lg px-3 py-2.5 min-w-[140px]">
        <p className="text-xs font-medium text-zinc-500 mb-1.5 pb-1.5 border-b border-zinc-100 whitespace-nowrap">{label}</p>
        <div className="space-y-1">
          {payload.map((entry, index) => (
            <div key={index} className="flex items-center justify-between gap-3">
              <div className="flex items-center gap-1.5">
                <span 
                  className="w-2 h-2 rounded-full flex-shrink-0" 
                  style={{ backgroundColor: entry.color }}
                />
                <span className="text-xs text-zinc-600 whitespace-nowrap">{entry.name || entry.dataKey}</span>
              </div>
              <span className="text-xs font-semibold text-zinc-900 whitespace-nowrap">{entry.value?.toLocaleString()}</span>
            </div>
          ))}
        </div>
      </div>
    );
  }
  return null;
};

export default function FnFQ4Dashboard() {
  const [activeTab, setActiveTab] = useState('summary');
  const [selectedAccount, setSelectedAccount] = useState('ë§¤ì¶œì•¡');
  const [selectedBSAccount, setSelectedBSAccount] = useState('ìì‚°ì´ê³„');
  const [isNonOperatingExpanded, setIsNonOperatingExpanded] = useState(false);
  const [incomeViewMode, setIncomeViewMode] = useState('quarter'); // 'quarter' | 'annual'
  const [selectedPeriod, setSelectedPeriod] = useState('2025_Q4'); // ì„ íƒëœ ì¡°íšŒê¸°ê°„ ('2025_Q1' ~ '2025_Q4')
  const [incomeEditMode, setIncomeEditMode] = useState(false); // ì†ìµê³„ì‚°ì„œ ì¦ê° ë¶„ì„ í¸ì§‘ ëª¨ë“œ
  const [bsEditMode, setBsEditMode] = useState(false); // ì¬ë¬´ìƒíƒœí‘œ ì¦ê° ë¶„ì„ í¸ì§‘ ëª¨ë“œ
  const [incomeEditData, setIncomeEditData] = useState({}); // ì†ìµê³„ì‚°ì„œ í¸ì§‘ ë°ì´í„° {entity: {amount, rate, contribution}}
  const [bsEditData, setBsEditData] = useState({}); // ì¬ë¬´ìƒíƒœí‘œ í¸ì§‘ ë°ì´í„°

  // ============================================
  // ê¸°ê°„ ë§¤í•‘ í•¨ìˆ˜
  // ============================================
  const getPeriodKey = (selectedPeriod, type) => {
    // selectedPeriod: '2025_Q1', '2025_Q2', '2025_Q3', '2025_Q4'
    // type: 'quarter' (ë¶„ê¸°), 'year' (ëˆ„ì ), 'prev_quarter' (ì „ë…„ ë™ ë¶„ê¸°), 'prev_year' (ì „ë…„ ë™ê¸° ëˆ„ì ), 'prev' (ì „ ë¶„ê¸°)
    const [year, quarter] = selectedPeriod.split('_');
    const yearNum = parseInt(year);
    const quarterNum = quarter.replace('Q', '');
    
    if (type === 'quarter') {
      return `${year}_${quarterNum}Q`;
    } else if (type === 'year') {
      // ëˆ„ì : Q4ëŠ” '2025_Year', Q1~Q3ëŠ” '2025_1Q_Year' í˜•ì‹
      if (quarterNum === '4') {
        return `${year}_Year`;
      }
      return `${year}_${quarterNum}Q_Year`;
    } else if (type === 'prev_quarter') {
      const prevYear = (yearNum - 1).toString();
      return `${prevYear}_${quarterNum}Q`;
    } else if (type === 'prev_year') {
      const prevYear = (yearNum - 1).toString();
      // ì „ë…„ ë™ê¸° ëˆ„ì : Q4ëŠ” '2024_Year', Q1~Q3ëŠ” '2024_1Q_Year' í˜•ì‹
      if (quarterNum === '4') {
        return `${prevYear}_Year`;
      }
      return `${prevYear}_${quarterNum}Q_Year`;
    } else if (type === 'prev') {
      // ì „ ë¶„ê¸°: Q1ì´ë©´ ì „ë…„ Q4, ê·¸ ì™¸ëŠ” ê°™ì€ í•´ ì „ ë¶„ê¸°
      if (quarterNum === '1') {
        const prevYear = (yearNum - 1).toString();
        return `${prevYear}_4Q`;
      } else {
        const prevQuarter = (parseInt(quarterNum) - 1).toString();
        return `${year}_${prevQuarter}Q`;
      }
    }
    return `${year}_4Q`; // ê¸°ë³¸ê°’
  };

  const getPeriodLabel = (selectedPeriod) => {
    // '2025_Q4' -> 'FY2025 Q4'
    return selectedPeriod.replace('_', ' ');
  };

  // ============================================
  // ì¬ë¬´ìƒíƒœí‘œ ì¡°íšŒ ê¸°ì¤€(ì»´í¬ë„ŒíŠ¸ ì „ì—­)
  // - ì¬ë¬´ìƒíƒœí‘œëŠ” ì„ íƒ ë¶„ê¸° ê¸°ë§ vs ì „ë…„ ê¸°ë§ ë¹„êµ
  // ============================================
  const bsCurrentPeriod = getPeriodKey(selectedPeriod, 'quarter'); // ì„ íƒëœ ë¶„ê¸° ê¸°ë§
  const bsPrevPeriod = '2024_4Q'; // ì „ë…„ ê¸°ë§ (ê³ ì •)

    // ============================================
  // ì†ìµê³„ì‚°ì„œ ë°ì´í„° - ë¶„ê¸°(3ê°œì›”) + ëˆ„ì (ì—°ê°„) í†µí•© (CSV ê¸°ë°˜)
  // ============================================
  const incomeStatementData = {
    // 2024ë…„ ë¶„ê¸° (3ê°œì›”)
    '2024_1Q': {
      ë§¤ì¶œì•¡: 507029,
      ë§¤ì¶œì›ê°€: 174545,
      ë§¤ì¶œì´ì´ìµ: 332484,
      íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„: 202273,
      ì¸ê±´ë¹„: 19658,
      ê´‘ê³ ì„ ì „ë¹„: 24097,
      ìˆ˜ìˆ˜ë£Œ: 118770,
      ê°ê°€ìƒê°ë¹„: 20565,
      ê¸°íƒ€íŒê´€ë¹„: 19183,
      ì˜ì—…ì´ìµ: 130211,
      ì˜ì—…ì™¸ì†ìµ: 21031,
      ì™¸í™˜ì†ìµ: 10008,
      ì„ ë¬¼í™˜ì†ìµ: 473,
      ê¸ˆìœµìƒí’ˆì†ìµ: 1941,
      ì´ìì†ìµ: 4736,
      ë°°ë‹¹ìˆ˜ìµ: 62,
      ê¸°íƒ€ì†ìµ: 2913,
      ì§€ë¶„ë²•ì†ìµ: 803,
      ê¸°ë¶€ê¸ˆ: 94,
      ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ: 128159,
      ë²•ì¸ì„¸ë¹„ìš©: 31837,
      ë‹¹ê¸°ìˆœì´ìµ: 96322,
    },
    '2024_2Q': {
      ë§¤ì¶œì•¡: 391473,
      ë§¤ì¶œì›ê°€: 120174,
      ë§¤ì¶œì´ì´ìµ: 271299,
      íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„: 179497,
      ì¸ê±´ë¹„: 22002,
      ê´‘ê³ ì„ ì „ë¹„: 16955,
      ìˆ˜ìˆ˜ë£Œ: 102336,
      ê°ê°€ìƒê°ë¹„: 21537,
      ê¸°íƒ€íŒê´€ë¹„: 16667,
      ì˜ì—…ì´ìµ: 91802,
      ì˜ì—…ì™¸ì†ìµ: 16367,
      ì™¸í™˜ì†ìµ: 5536,
      ì„ ë¬¼í™˜ì†ìµ: 471,
      ê¸ˆìœµìƒí’ˆì†ìµ: 748,
      ì´ìì†ìµ: 4846,
      ë°°ë‹¹ìˆ˜ìµ: 2144,
      ê¸°íƒ€ì†ìµ: 1412,
      ì§€ë¶„ë²•ì†ìµ: 800,
      ê¸°ë¶€ê¸ˆ: 409,
      ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ: 97956,
      ë²•ì¸ì„¸ìš©: 24005,
      ë²•ì¸ì„¸ë¹„ìš©: 24005,
      ë‹¹ê¸°ìˆœì´ìµ: 73951,
    },
    '2024_3Q': {
      ë§¤ì¶œì•¡: 450963,
      ë§¤ì¶œì›ê°€: 166042,
      ë§¤ì¶œì´ì´ìµ: 284921,
      íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„: 176618,
      ì¸ê±´ë¹„: 19926,
      ê´‘ê³ ì„ ì „ë¹„: 19902,
      ìˆ˜ìˆ˜ë£Œ: 96464,
      ê°ê°€ìƒê°ë¹„: 23267,
      ê¸°íƒ€íŒê´€ë¹„: 17059,
      ì˜ì—…ì´ìµ: 108303,
      ì˜ì—…ì™¸ì†ìµ: 32491,
      ì™¸í™˜ì†ìµ: 5066,
      ì„ ë¬¼í™˜ì†ìµ: 1022,
      ê¸ˆìœµìƒí’ˆì†ìµ: 2468,
      ì´ìì†ìµ: 4486,
      ë°°ë‹¹ìˆ˜ìµ: 1088,
      ê¸°íƒ€ì†ìµ: 7353,
      ì§€ë¶„ë²•ì†ìµ: 9098,
      ê¸°ë¶€ê¸ˆ: 1910,
      ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ: 109840,
      ë²•ì¸ì„¸ë¹„ìš©: 30039,
      ë‹¹ê¸°ìˆœì´ìµ: 79801,
    },
    '2024_4Q': {
      ë§¤ì¶œì•¡: 546545,
      ë§¤ì¶œì›ê°€: 188255,
      ë§¤ì¶œì´ì´ìµ: 358290,
      íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„: 237871,
      ì¸ê±´ë¹„: 22685,
      ê´‘ê³ ì„ ì „ë¹„: 32179,
      ìˆ˜ìˆ˜ë£Œ: 135912,
      ê°ê°€ìƒê°ë¹„: 23440,
      ê¸°íƒ€íŒê´€ë¹„: 23655,
      ì˜ì—…ì´ìµ: 120419,
      ì˜ì—…ì™¸ì†ìµ: 55396,
      ì™¸í™˜ì†ìµ: 16230,
      ì„ ë¬¼í™˜ì†ìµ: 685,
      ê¸ˆìœµìƒí’ˆì†ìµ: 845,
      ì´ìì†ìµ: 4538,
      ë°°ë‹¹ìˆ˜ìµ: -271,
      ê¸°íƒ€ì†ìµ: 9703,
      ì§€ë¶„ë²•ì†ìµ: 17757,
      ê¸°ë¶€ê¸ˆ: 826,
      ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ: 141346,
      ë²•ì¸ì„¸ë¹„ìš©: 35461,
      ë‹¹ê¸°ìˆœì´ìµ: 105885,
    },

    // 2024ë…„ ëˆ„ì 
    '2024_1Q_Year': {
      ë§¤ì¶œì•¡: 507029,
      ë§¤ì¶œì›ê°€: 174545,
      ë§¤ì¶œì´ì´ìµ: 332484,
      íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„: 202273,
      ì¸ê±´ë¹„: 19658,
      ê´‘ê³ ì„ ì „ë¹„: 24097,
      ìˆ˜ìˆ˜ë£Œ: 118770,
      ê°ê°€ìƒê°ë¹„: 20565,
      ê¸°íƒ€íŒê´€ë¹„: 19183,
      ì˜ì—…ì´ìµ: 130211,
      ì˜ì—…ì™¸ì†ìµ: 21031,
      ì™¸í™˜ì†ìµ: 10008,
      ì„ ë¬¼í™˜ì†ìµ: 473,
      ê¸ˆìœµìƒí’ˆì†ìµ: 1941,
      ì´ìì†ìµ: 4736,
      ë°°ë‹¹ìˆ˜ìµ: 62,
      ê¸°íƒ€ì†ìµ: 2913,
      ì§€ë¶„ë²•ì†ìµ: 803,
      ê¸°ë¶€ê¸ˆ: 94,
      ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ: 128159,
      ë²•ì¸ì„¸ë¹„ìš©: 31837,
      ë‹¹ê¸°ìˆœì´ìµ: 96322,
    },
    '2024_2Q_Year': {
      ë§¤ì¶œì•¡: 898501,
      ë§¤ì¶œì›ê°€: 294720,
      ë§¤ì¶œì´ì´ìµ: 603781,
      íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„: 381771,
      ì¸ê±´ë¹„: 41660,
      ê´‘ê³ ì„ ì „ë¹„: 41052,
      ìˆ˜ìˆ˜ë£Œ: 221107,
      ê°ê°€ìƒê°ë¹„: 42103,
      ê¸°íƒ€íŒê´€ë¹„: 35849,
      ì˜ì—…ì´ìµ: 222010,
      ì˜ì—…ì™¸ì†ìµ: 37398,
      ì™¸í™˜ì†ìµ: 15547,
      ì„ ë¬¼í™˜ì†ìµ: 944,
      ê¸ˆìœµìƒí’ˆì†ìµ: 2689,
      ì´ìì†ìµ: 9581,
      ë°°ë‹¹ìˆ˜ìµ: 2207,
      ê¸°íƒ€ì†ìµ: 4326,
      ì§€ë¶„ë²•ì†ìµ: 1603,
      ê¸°ë¶€ê¸ˆ: 503,
      ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ: 226115,
      ë²•ì¸ì„¸ë¹„ìš©: 55842,
      ë‹¹ê¸°ìˆœì´ìµ: 170273,
    },
    '2024_3Q_Year': {
      ë§¤ì¶œì•¡: 1349465,
      ë§¤ì¶œì›ê°€: 460761,
      ë§¤ì¶œì´ì´ìµ: 888704,
      íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„: 558386,
      ì¸ê±´ë¹„: 61585,
      ê´‘ê³ ì„ ì „ë¹„: 60954,
      ìˆ˜ìˆ˜ë£Œ: 317570,
      ê°ê°€ìƒê°ë¹„: 65370,
      ê¸°íƒ€íŒê´€ë¹„: 52907,
      ì˜ì—…ì´ìµ: 330318,
      ì˜ì—…ì™¸ì†ìµ: 69888,
      ì™¸í™˜ì†ìµ: 20612,
      ì„ ë¬¼í™˜ì†ìµ: 1966,
      ê¸ˆìœµìƒí’ˆì†ìµ: 5157,
      ì´ìì†ìµ: 14068,
      ë°°ë‹¹ìˆ˜ìµ: 3295,
      ê¸°íƒ€ì†ìµ: 11678,
      ì§€ë¶„ë²•ì†ìµ: 10701,
      ê¸°ë¶€ê¸ˆ: 2413,
      ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ: 335955,
      ë²•ì¸ì„¸ë¹„ìš©: 85881,
      ë‹¹ê¸°ìˆœì´ìµ: 250074,
    },
    '2024_Year': {
      ë§¤ì¶œì•¡: 1896010,
      ë§¤ì¶œì›ê°€: 649017,
      ë§¤ì¶œì´ì´ìµ: 1246993,
      íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„: 796256,
      ì¸ê±´ë¹„: 84270,
      ê´‘ê³ ì„ ì „ë¹„: 93133,
      ìˆ˜ìˆ˜ë£Œ: 453482,
      ê°ê°€ìƒê°ë¹„: 88809,
      ê¸°íƒ€íŒê´€ë¹„: 76562,
      ì˜ì—…ì´ìµ: 450737,
      ì˜ì—…ì™¸ì†ìµ: 125284,
      ì™¸í™˜ì†ìµ: 36843,
      ì„ ë¬¼í™˜ì†ìµ: 2651,
      ê¸ˆìœµìƒí’ˆì†ìµ: 6002,
      ì´ìì†ìµ: 18606,
      ë°°ë‹¹ìˆ˜ìµ: 3024,
      ê¸°íƒ€ì†ìµ: 21379,
      ì§€ë¶„ë²•ì†ìµ: 28458,
      ê¸°ë¶€ê¸ˆ: 3239,
      ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ: 477301,
      ë²•ì¸ì„¸ë¹„ìš©: 121341,
      ë‹¹ê¸°ìˆœì´ìµ: 355960,
    },

    // 2025ë…„ ë¶„ê¸° (3ê°œì›”)
    '2025_1Q': {
      ë§¤ì¶œì•¡: 505617,
      ë§¤ì¶œì›ê°€: 175882,
      ë§¤ì¶œì´ì´ìµ: 329735,
      íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„: 206117,
      ì¸ê±´ë¹„: 21638,
      ê´‘ê³ ì„ ì „ë¹„: 24609,
      ìˆ˜ìˆ˜ë£Œ: 114788,
      ê°ê°€ìƒê°ë¹„: 24508,
      ê¸°íƒ€íŒê´€ë¹„: 20574,
      ì˜ì—…ì´ìµ: 123618,
      ì˜ì—…ì™¸ì†ìµ: 37983,
      ì™¸í™˜ì†ìµ: 21907,
      ì„ ë¬¼í™˜ì†ìµ: 3457,
      ê¸ˆìœµìƒí’ˆì†ìµ: 1129,
      ì´ìì†ìµ: 4360,
      ë°°ë‹¹ìˆ˜ìµ: 337,
      ê¸°íƒ€ì†ìµ: 6022,
      ì§€ë¶„ë²•ì†ìµ: 766,
      ê¸°ë¶€ê¸ˆ: 5,
      ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ: 110663,
      ë²•ì¸ì„¸ë¹„ìš©: 28094,
      ë‹¹ê¸°ìˆœì´ìµ: 82569,
    },
    '2025_2Q': {
      ë§¤ì¶œì•¡: 378870,
      ë§¤ì¶œì›ê°€: 119965,
      ë§¤ì¶œì´ì´ìµ: 258905,
      íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„: 174878,
      ì¸ê±´ë¹„: 20875,
      ê´‘ê³ ì„ ì „ë¹„: 19539,
      ìˆ˜ìˆ˜ë£Œ: 95162,
      ê°ê°€ìƒê°ë¹„: 22116,
      ê¸°íƒ€íŒê´€ë¹„: 17186,
      ì˜ì—…ì´ìµ: 84027,
      ì˜ì—…ì™¸ì†ìµ: 25837,
      ì™¸í™˜ì†ìµ: 10246,
      ì„ ë¬¼í™˜ì†ìµ: 5637,
      ê¸ˆìœµìƒí’ˆì†ìµ: -46,
      ì´ìì†ìµ: 3016,
      ë°°ë‹¹ìˆ˜ìµ: 37,
      ê¸°íƒ€ì†ìµ: 6118,
      ì§€ë¶„ë²•ì†ìµ: 828,
      ê¸°ë¶€ê¸ˆ: 0,
      ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ: 86083,
      ë²•ì¸ì„¸ë¹„ìš©: 23444,
      ë‹¹ê¸°ìˆœì´ìµ: 62639,
    },
    '2025_3Q': {
      ë§¤ì¶œì•¡: 474257,
      ë§¤ì¶œì›ê°€: 165303,
      ë§¤ì¶œì´ì´ìµ: 308954,
      íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„: 180936,
      ì¸ê±´ë¹„: 20266,
      ê´‘ê³ ì„ ì „ë¹„: 25032,
      ìˆ˜ìˆ˜ë£Œ: 93907,
      ê°ê°€ìƒê°ë¹„: 22262,
      ê¸°íƒ€íŒê´€ë¹„: 19469,
      ì˜ì—…ì´ìµ: 128018,
      ì˜ì—…ì™¸ì†ìµ: 23580,
      ì™¸í™˜ì†ìµ: 9435,
      ì„ ë¬¼í™˜ì†ìµ: -5393,
      ê¸ˆìœµìƒí’ˆì†ìµ: 668,
      ì´ìì†ìµ: 3480,
      ë°°ë‹¹ìˆ˜ìµ: 482,
      ê¸°íƒ€ì†ìµ: 5713,
      ì§€ë¶„ë²•ì†ìµ: 9117,
      ê¸°ë¶€ê¸ˆ: 78,
      ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ: 135278,
      ë²•ì¸ì„¸ë¹„ìš©: 34583,
      ë‹¹ê¸°ìˆœì´ìµ: 100695,
    },

    // 2025ë…„ ëˆ„ì 
    '2025_1Q_Year': {
      ë§¤ì¶œì•¡: 505617,
      ë§¤ì¶œì›ê°€: 175882,
      ë§¤ì¶œì´ì´ìµ: 329735,
      íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„: 206117,
      ì¸ê±´ë¹„: 21638,
      ê´‘ê³ ì„ ì „ë¹„: 24609,
      ìˆ˜ìˆ˜ë£Œ: 114788,
      ê°ê°€ìƒê°ë¹„: 24508,
      ê¸°íƒ€íŒê´€ë¹„: 20574,
      ì˜ì—…ì´ìµ: 123618,
      ì˜ì—…ì™¸ì†ìµ: 37983,
      ì™¸í™˜ì†ìµ: 21907,
      ì„ ë¬¼í™˜ì†ìµ: 3457,
      ê¸ˆìœµìƒí’ˆì†ìµ: 1129,
      ì´ìì†ìµ: 4360,
      ë°°ë‹¹ìˆ˜ìµ: 337,
      ê¸°íƒ€ì†ìµ: 6022,
      ì§€ë¶„ë²•ì†ìµ: 766,
      ê¸°ë¶€ê¸ˆ: 5,
      ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ: 110663,
      ë²•ì¸ì„¸ë¹„ìš©: 28094,
      ë‹¹ê¸°ìˆœì´ìµ: 82569,
    },
    '2025_2Q_Year': {
      ë§¤ì¶œì•¡: 884487,
      ë§¤ì¶œì›ê°€: 295848,
      ë§¤ì¶œì´ì´ìµ: 588639,
      íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„: 380996,
      ì¸ê±´ë¹„: 42515,
      ê´‘ê³ ì„ ì „ë¹„: 44148,
      ìˆ˜ìˆ˜ë£Œ: 209951,
      ê°ê°€ìƒê°ë¹„: 46623,
      ê¸°íƒ€íŒê´€ë¹„: 37759,
      ì˜ì—…ì´ìµ: 207643,
      ì˜ì—…ì™¸ì†ìµ: 63818,
      ì™¸í™˜ì†ìµ: 32153,
      ì„ ë¬¼í™˜ì†ìµ: 9095,
      ê¸ˆìœµìƒí’ˆì†ìµ: 1083,
      ì´ìì†ìµ: 7377,
      ë°°ë‹¹ìˆ˜ìµ: 373,
      ê¸°íƒ€ì†ìµ: 12138,
      ì§€ë¶„ë²•ì†ìµ: 1594,
      ê¸°ë¶€ê¸ˆ: 5,
      ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ: 196746,
      ë²•ì¸ì„¸ë¹„ìš©: 51538,
      ë‹¹ê¸°ìˆœì´ìµ: 145208,
    },
    '2025_3Q_Year': {
      ë§¤ì¶œì•¡: 1358744,
      ë§¤ì¶œì›ê°€: 461149,
      ë§¤ì¶œì´ì´ìµ: 897595,
      íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„: 561928,
      ì¸ê±´ë¹„: 62780,
      ê´‘ê³ ì„ ì „ë¹„: 69180,
      ìˆ˜ìˆ˜ë£Œ: 303857,
      ê°ê°€ìƒê°ë¹„: 68886,
      ê¸°íƒ€íŒê´€ë¹„: 57225,
      ì˜ì—…ì´ìµ: 335667,
      ì˜ì—…ì™¸ì†ìµ: 87398,
      ì™¸í™˜ì†ìµ: 41588,
      ì„ ë¬¼í™˜ì†ìµ: 3700,
      ê¸ˆìœµìƒí’ˆì†ìµ: 1752,
      ì´ìì†ìµ: 10856,
      ë°°ë‹¹ìˆ˜ìµ: 855,
      ê¸°íƒ€ì†ìµ: 17854,
      ì§€ë¶„ë²•ì†ìµ: 10711,
      ê¸°ë¶€ê¸ˆ: 83,
      ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ: 332024,
      ë²•ì¸ì„¸ë¹„ìš©: 86121,
      ë‹¹ê¸°ìˆœì´ìµ: 245903,
    },
    '2025_Year': {
      ë§¤ì¶œì•¡: 1358744,
      ë§¤ì¶œì›ê°€: 461149,
      ë§¤ì¶œì´ì´ìµ: 897595,
      íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„: 561928,
      ì¸ê±´ë¹„: 62780,
      ê´‘ê³ ì„ ì „ë¹„: 69180,
      ìˆ˜ìˆ˜ë£Œ: 303857,
      ê°ê°€ìƒê°ë¹„: 68886,
      ê¸°íƒ€íŒê´€ë¹„: 57225,
      ì˜ì—…ì´ìµ: 335667,
      ì˜ì—…ì™¸ì†ìµ: 87398,
      ì™¸í™˜ì†ìµ: 41588,
      ì„ ë¬¼í™˜ì†ìµ: 3700,
      ê¸ˆìœµìƒí’ˆì†ìµ: 1752,
      ì´ìì†ìµ: 10856,
      ë°°ë‹¹ìˆ˜ìµ: 855,
      ê¸°íƒ€ì†ìµ: 17854,
      ì§€ë¶„ë²•ì†ìµ: 10711,
      ê¸°ë¶€ê¸ˆ: 83,
      ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ: 332024,
      ë²•ì¸ì„¸ë¹„ìš©: 86121,
      ë‹¹ê¸°ìˆœì´ìµ: 245903,
    },
  };

  // ============================================
  // ì¬ë¬´ìƒíƒœí‘œ ë°ì´í„° - ì „ë…„ê¸°ë§ vs ë‹¹ê¸°ë§
  // ============================================
  // ì¬ë¬´ìƒíƒœí‘œ ë°ì´í„° (ì„±ê²©ë³„ ë¶„ë¥˜ - ìœ ë™/ë¹„ìœ ë™ í†µí•©)
  const balanceSheetData = {
    // 2024ë…„ ì—°ê²° BS (2024_BS.csv ê¸°ë°˜, ë‹¨ìœ„: ë°±ë§Œì›)
    '2024_1Q': {
      í˜„ê¸ˆì„±ìì‚°: 334707,
      ê¸ˆìœµìƒí’ˆ: 32034,
      ë§¤ì¶œì±„ê¶Œ: 82369,
      ì¬ê³ ìì‚°: 323836,
      ê´€ê³„ê¸°ì—…íˆ¬ì: 633124,
      ìœ ë¬´í˜•ìì‚°: 327883,
      ì‚¬ìš©ê¶Œìì‚°: 213602,
      ê¸°íƒ€ìì‚°: 109815,
      ìì‚°ì´ê³„: 2057370,
      ì°¨ì…ê¸ˆ: 73262,
      ë§¤ì…ì±„ë¬´: 75896,
      ë¯¸ì§€ê¸‰ê¸ˆ: 95705,
      ë¦¬ìŠ¤ë¶€ì±„: 163946,
      ë³´ì¦ê¸ˆ: 16360,
      ê¸°íƒ€ë¶€ì±„: 282478,
      ë¶€ì±„ì´ê³„: 707649,
      ìë³¸ê¸ˆ: 3831,
      ìë³¸ì‰ì—¬ê¸ˆ: 317545,
      ê¸°íƒ€ìë³¸: -21519,
      ì´ìµì‰ì—¬ê¸ˆ: 1018879,
      ë¹„ì§€ë°°ì§€ë¶„: 30985,
      ìë³¸ì´ê³„: 1349721,
    },
    '2024_2Q': {
      í˜„ê¸ˆì„±ìì‚°: 220611,
      ê¸ˆìœµìƒí’ˆ: 18747,
      ë§¤ì¶œì±„ê¶Œ: 67859,
      ì¬ê³ ìì‚°: 292899,
      ê´€ê³„ê¸°ì—…íˆ¬ì: 632510,
      ìœ ë¬´í˜•ìì‚°: 384106,
      ì‚¬ìš©ê¶Œìì‚°: 210463,
      ê¸°íƒ€ìì‚°: 99180,
      ìì‚°ì´ê³„: 1926377,
      ì°¨ì…ê¸ˆ: 820,
      ë§¤ì…ì±„ë¬´: 62956,
      ë¯¸ì§€ê¸‰ê¸ˆ: 34040,
      ë¦¬ìŠ¤ë¶€ì±„: 160758,
      ë³´ì¦ê¸ˆ: 16225,
      ê¸°íƒ€ë¶€ì±„: 239442,
      ë¶€ì±„ì´ê³„: 514242,
      ìë³¸ê¸ˆ: 3831,
      ìë³¸ì‰ì—¬ê¸ˆ: 317545,
      ê¸°íƒ€ìë³¸: -33162,
      ì´ìµì‰ì—¬ê¸ˆ: 1092725,
      ë¹„ì§€ë°°ì§€ë¶„: 31196,
      ìë³¸ì´ê³„: 1412135,
    },
    '2024_3Q': {
      í˜„ê¸ˆì„±ìì‚°: 190422,
      ê¸ˆìœµìƒí’ˆ: 17954,
      ë§¤ì¶œì±„ê¶Œ: 135245,
      ì¬ê³ ìì‚°: 361737,
      ê´€ê³„ê¸°ì—…íˆ¬ì: 634781,
      ìœ ë¬´í˜•ìì‚°: 441828,
      ì‚¬ìš©ê¶Œìì‚°: 207368,
      ê¸°íƒ€ìì‚°: 150141,
      ìì‚°ì´ê³„: 2139478,
      ì°¨ì…ê¸ˆ: 86820,
      ë§¤ì…ì±„ë¬´: 130612,
      ë¯¸ì§€ê¸‰ê¸ˆ: 37911,
      ë¦¬ìŠ¤ë¶€ì±„: 158831,
      ë³´ì¦ê¸ˆ: 16125,
      ê¸°íƒ€ë¶€ì±„: 224490,
      ë¶€ì±„ì´ê³„: 654790,
      ìë³¸ê¸ˆ: 3831,
      ìë³¸ì‰ì—¬ê¸ˆ: 317545,
      ê¸°íƒ€ìë³¸: -40262,
      ì´ìµì‰ì—¬ê¸ˆ: 1176364,
      ë¹„ì§€ë°°ì§€ë¶„: 27209,
      ìë³¸ì´ê³„: 1484687,
    },
    // 2025ë…„ ì—°ê²° BS (2025_BS.csv ê¸°ë°˜, ë‹¨ìœ„: ë°±ë§Œì›)
    '2025_1Q': {
      í˜„ê¸ˆì„±ìì‚°: 164044,
      ê¸ˆìœµìƒí’ˆ: 10966,
      ë§¤ì¶œì±„ê¶Œ: 91239,
      ì¬ê³ ìì‚°: 314052,
      ê´€ê³„ê¸°ì—…íˆ¬ì: 651745,
      ìœ ë¬´í˜•ìì‚°: 713433,
      ì‚¬ìš©ê¶Œìì‚°: 198220,
      ê¸°íƒ€ìì‚°: 114250,
      ìì‚°ì´ê³„: 2257950,
      ì°¨ì…ê¸ˆ: 76470,
      ë§¤ì…ì±„ë¬´: 81968,
      ë¯¸ì§€ê¸‰ê¸ˆ: 100026,
      ë¦¬ìŠ¤ë¶€ì±„: 151882,
      ë³´ì¦ê¸ˆ: 18817,
      ê¸°íƒ€ë¶€ì±„: 234811,
      ë¶€ì±„ì´ê³„: 663974,
      ìë³¸ê¸ˆ: 3831,
      ìë³¸ì‰ì—¬ê¸ˆ: 317545,
      ê¸°íƒ€ìë³¸: -43459,
      ì´ìµì‰ì—¬ê¸ˆ: 1302260,
      ë¹„ì§€ë°°ì§€ë¶„: 13799,
      ìë³¸ì´ê³„: 1593976,
    },
    '2025_2Q': {
      í˜„ê¸ˆì„±ìì‚°: 126440,
      ê¸ˆìœµìƒí’ˆ: 11012,
      ë§¤ì¶œì±„ê¶Œ: 61178,
      ì¬ê³ ìì‚°: 293350,
      ê´€ê³„ê¸°ì—…íˆ¬ì: 650955,
      ìœ ë¬´í˜•ìì‚°: 702103,
      ì‚¬ìš©ê¶Œìì‚°: 184171,
      ê¸°íƒ€ìì‚°: 121492,
      ìì‚°ì´ê³„: 2150700,
      ì°¨ì…ê¸ˆ: 32157,
      ë§¤ì…ì±„ë¬´: 68454,
      ë¯¸ì§€ê¸‰ê¸ˆ: 28936,
      ë¦¬ìŠ¤ë¶€ì±„: 142100,
      ë³´ì¦ê¸ˆ: 19565,
      ê¸°íƒ€ë¶€ì±„: 211731,
      ë¶€ì±„ì´ê³„: 502944,
      ìë³¸ê¸ˆ: 3831,
      ìë³¸ì‰ì—¬ê¸ˆ: 317545,
      ê¸°íƒ€ìë³¸: -51346,
      ì´ìµì‰ì—¬ê¸ˆ: 1364602,
      ë¹„ì§€ë°°ì§€ë¶„: 13124,
      ìë³¸ì´ê³„: 1647756,
    },
    '2025_3Q': {
      í˜„ê¸ˆì„±ìì‚°: 208285,
      ê¸ˆìœµìƒí’ˆ: 36645,
      ë§¤ì¶œì±„ê¶Œ: 159109,
      ì¬ê³ ìì‚°: 414026,
      ê´€ê³„ê¸°ì—…íˆ¬ì: 653157,
      ìœ ë¬´í˜•ìì‚°: 703080,
      ì‚¬ìš©ê¶Œìì‚°: 186155,
      ê¸°íƒ€ìì‚°: 140206,
      ìì‚°ì´ê³„: 2500662,
      ì°¨ì…ê¸ˆ: 160605,
      ë§¤ì…ì±„ë¬´: 158517,
      ë¯¸ì§€ê¸‰ê¸ˆ: 36728,
      ë¦¬ìŠ¤ë¶€ì±„: 139760,
      ë³´ì¦ê¸ˆ: 18953,
      ê¸°íƒ€ë¶€ì±„: 235599,
      ë¶€ì±„ì´ê³„: 750162,
      ìë³¸ê¸ˆ: 3831,
      ìë³¸ì‰ì—¬ê¸ˆ: 317545,
      ê¸°íƒ€ìë³¸: -50132,
      ì´ìµì‰ì—¬ê¸ˆ: 1463247,
      ë¹„ì§€ë°°ì§€ë¶„: 16009,
      ìë³¸ì´ê³„: 1750500,
    },
    '2024_4Q': {
      // ìì‚° (ì„±ê²©ë³„)
      í˜„ê¸ˆì„±ìì‚°: 119833,
      ê¸ˆìœµìƒí’ˆ: 19479,      // ìœ ë™ 6,388 + ë¹„ìœ ë™ 13,091
      ë§¤ì¶œì±„ê¶Œ: 133826,
      ì¬ê³ ìì‚°: 324992,
      ê´€ê³„ê¸°ì—…íˆ¬ì: 652474,
      ìœ ë¬´í˜•ìì‚°: 714996,   // ìœ í˜• 501,307 + íˆ¬ìë¶€ë™ì‚° 0 + ë¬´í˜• 213,689
      ì‚¬ìš©ê¶Œìì‚°: 207683,
      ê¸°íƒ€ìì‚°: 112622,     // ìœ ë™ê¸°íƒ€ 51,755 + ë¹„ìœ ë™ê¸°íƒ€ 60,867
      ìì‚°ì´ê³„: 2285905,
      // ë¶€ì±„ (ì„±ê²©ë³„)
      ì°¨ì…ê¸ˆ: 145635,       // ë‹¨ê¸° 145,635 + ì¥ê¸° 0
      ë§¤ì…ì±„ë¬´: 102685,
      ë¯¸ì§€ê¸‰ê¸ˆ: 41982,
      ë¦¬ìŠ¤ë¶€ì±„: 215428,     // ìœ ë™ 57,979 + ë¹„ìœ ë™ 157,449
      ë³´ì¦ê¸ˆ: 5692,
      ê¸°íƒ€ë¶€ì±„: 197185,     // ìœ ë™ê¸°íƒ€ 173,828 + ë¹„ìœ ë™ê¸°íƒ€ 23,355
      ë¶€ì±„ì´ê³„: 708607,
      // ìë³¸
      ìë³¸ê¸ˆ: 3831,
      ìë³¸ì‰ì—¬ê¸ˆ: 317545,
      ê¸°íƒ€ìë³¸: -42530,
      ì´ìµì‰ì—¬ê¸ˆ: 1283355,
      ë¹„ì§€ë°°ì§€ë¶„: 15098,
      ìë³¸ì´ê³„: 1577298,
    },
  };

  // ============================================
  // ê¸ˆìœµìƒí’ˆí‰ê°€ ë°ì´í„°
  // ============================================
  const financialInstrumentsData = {
    '2024_4Q': {
      FVPLê¸ˆìœµìì‚°: 0,
      FVOCIê¸ˆìœµìì‚°: 0,
      ACê¸ˆìœµìì‚°: 0,
      íŒŒìƒìƒí’ˆìì‚°: 0,
      ë‹¹ê¸°ì†ìµì¸ì‹ê¸ˆìœµë¶€ì±„: 0,
      ìƒê°í›„ì›ê°€ê¸ˆìœµë¶€ì±„: 0,
      íŒŒìƒìƒí’ˆë¶€ì±„: 0,
      FVPLí‰ê°€ì†ìµ: 0,
      FVOCIí‰ê°€ì†ìµ: 0,
      íŒŒìƒìƒí’ˆí‰ê°€ì†ìµ: 0,
    },
  };

  // ============================================
  // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
  // ============================================
  const formatNumber = (num) => {
    if (num === 0 || num === undefined || num === null) return '-';
    return new Intl.NumberFormat('ko-KR').format(num);
  };

  const calculateYoY = (current, previous) => {
    if (!previous || previous === 0) return '-';
    const change = ((current - previous) / Math.abs(previous)) * 100;
    return change.toFixed(1);
  };

  const calculateDiff = (current, previous) => {
    if (current === 0 && previous === 0) return 0;
    return current - previous;
  };

  // ============================================
  // íƒ­ ì»´í¬ë„ŒíŠ¸
  // ============================================
  const tabs = [
    { id: 'summary', label: 'ì „ì²´ìš”ì•½', icon: 'ğŸ“Š' },
    { id: 'income', label: 'ì†ìµê³„ì‚°ì„œ', icon: 'ğŸ“ˆ' },
    { id: 'balance', label: 'ì¬ë¬´ìƒíƒœí‘œ', icon: 'ğŸ’°' },
  ];

  // ============================================
  // ë²•ì¸ë³„ ì†ìµê³„ì‚°ì„œ ë°ì´í„° (ì»´í¬ë„ŒíŠ¸ ìƒìœ„ ë ˆë²¨)
  // ============================================
  // ë²•ì¸ë³„ ë°ì´í„° (ì„ íƒëœ ê³¼ëª©ì— ë”°ë¼) - ë¶„ê¸° ë° ëˆ„ì 
  // ì£¼ì˜: ë²•ì¸ë³„ ë°ì´í„°ëŠ” ì—°ê²°ì¡°ì • ì „ ë²•ì¸ë³„ í•©ì‚° ê¸°ì¤€ (ì—°ê°„ ëˆ„ì )
  // entity_is_data.jsonì—ì„œ ë³€í™˜: China -> ì¤‘êµ­, Sergio + ê¸°íƒ€ -> ê¸°íƒ€
  const entityData = {
    'ë§¤ì¶œì•¡': {
      '2024_1Q': { 'OC(êµ­ë‚´)': 388852, 'ì¤‘êµ­': 238976, 'í™ì½©': 22211, 'ê¸°íƒ€': 9926 },
      '2024_1Q_Year': { 'OC(êµ­ë‚´)': 388852, 'ì¤‘êµ­': 238976, 'í™ì½©': 22211, 'ê¸°íƒ€': 9926 },
      '2024_2Q': { 'OC(êµ­ë‚´)': 275632, 'ì¤‘êµ­': 154544, 'í™ì½©': 16965, 'ê¸°íƒ€': 11200 },
      '2024_2Q_Year': { 'OC(êµ­ë‚´)': 664484, 'ì¤‘êµ­': 393520, 'í™ì½©': 39176, 'ê¸°íƒ€': 21126 },
      '2024_3Q': { 'OC(êµ­ë‚´)': 417280, 'ì¤‘êµ­': 250154, 'í™ì½©': 15559, 'ê¸°íƒ€': 17473 },
      '2024_3Q_Year': { 'OC(êµ­ë‚´)': 1081765, 'ì¤‘êµ­': 643675, 'í™ì½©': 54736, 'ê¸°íƒ€': 38599 },
      '2024_4Q': { 'OC(êµ­ë‚´)': 436230, 'ì¤‘êµ­': 214166, 'í™ì½©': 20299, 'ê¸°íƒ€': 11221 },
      '2024_Year': { 'OC(êµ­ë‚´)': 1517994, 'ì¤‘êµ­': 857840, 'í™ì½©': 75035, 'ê¸°íƒ€': 49820 },
      '2025_1Q': { 'OC(êµ­ë‚´)': 396770, 'ì¤‘êµ­': 258540, 'í™ì½©': 20663, 'ê¸°íƒ€': 9432 },
      '2025_1Q_Year': { 'OC(êµ­ë‚´)': 396770, 'ì¤‘êµ­': 258540, 'í™ì½©': 20663, 'ê¸°íƒ€': 9432 },
      '2025_2Q': { 'OC(êµ­ë‚´)': 307393, 'ì¤‘êµ­': 170703, 'í™ì½©': 15742, 'ê¸°íƒ€': 10275 },
      '2025_2Q_Year': { 'OC(êµ­ë‚´)': 704163, 'ì¤‘êµ­': 429243, 'í™ì½©': 36405, 'ê¸°íƒ€': 19708 },
      '2025_3Q': { 'OC(êµ­ë‚´)': 510671, 'ì¤‘êµ­': 283919, 'í™ì½©': 16908, 'ê¸°íƒ€': 18838 },
      '2025_3Q_Year': { 'OC(êµ­ë‚´)': 1214834, 'ì¤‘êµ­': 713162, 'í™ì½©': 53313, 'ê¸°íƒ€': 38547 },
      '2025_4Q': { 'OC(êµ­ë‚´)': 0, 'ì¤‘êµ­': 0, 'í™ì½©': 0, 'ê¸°íƒ€': 0 },
      '2025_Year': { 'OC(êµ­ë‚´)': 1214834, 'ì¤‘êµ­': 713162, 'í™ì½©': 53313, 'ê¸°íƒ€': 38547 },
    },
    'ë§¤ì¶œì›ê°€': {
      '2024_1Q': { 'OC(êµ­ë‚´)': 147628, 'ì¤‘êµ­': 173679, 'í™ì½©': 9231, 'ê¸°íƒ€': 4830 },
      '2024_1Q_Year': { 'OC(êµ­ë‚´)': 147628, 'ì¤‘êµ­': 173679, 'í™ì½©': 9231, 'ê¸°íƒ€': 4830 },
      '2024_2Q': { 'OC(êµ­ë‚´)': 89806, 'ì¤‘êµ­': 103635, 'í™ì½©': 7228, 'ê¸°íƒ€': 5609 },
      '2024_2Q_Year': { 'OC(êµ­ë‚´)': 237433, 'ì¤‘êµ­': 277315, 'í™ì½©': 16460, 'ê¸°íƒ€': 10439 },
      '2024_3Q': { 'OC(êµ­ë‚´)': 158791, 'ì¤‘êµ­': 198826, 'í™ì½©': 7135, 'ê¸°íƒ€': 15991 },
      '2024_3Q_Year': { 'OC(êµ­ë‚´)': 396225, 'ì¤‘êµ­': 476141, 'í™ì½©': 23595, 'ê¸°íƒ€': 26430 },
      '2024_4Q': { 'OC(êµ­ë‚´)': 147388, 'ì¤‘êµ­': 188025, 'í™ì½©': 8472, 'ê¸°íƒ€': 9945 },
      '2024_Year': { 'OC(êµ­ë‚´)': 543613, 'ì¤‘êµ­': 664166, 'í™ì½©': 32067, 'ê¸°íƒ€': 36374 },
      '2025_1Q': { 'OC(êµ­ë‚´)': 145093, 'ì¤‘êµ­': 203778, 'í™ì½©': 9671, 'ê¸°íƒ€': 3643 },
      '2025_1Q_Year': { 'OC(êµ­ë‚´)': 145093, 'ì¤‘êµ­': 203778, 'í™ì½©': 9671, 'ê¸°íƒ€': 3643 },
      '2025_2Q': { 'OC(êµ­ë‚´)': 102778, 'ì¤‘êµ­': 135222, 'í™ì½©': 6988, 'ê¸°íƒ€': 4565 },
      '2025_2Q_Year': { 'OC(êµ­ë‚´)': 247871, 'ì¤‘êµ­': 339000, 'í™ì½©': 16659, 'ê¸°íƒ€': 8208 },
      '2025_3Q': { 'OC(êµ­ë‚´)': 202041, 'ì¤‘êµ­': 208506, 'í™ì½©': 8019, 'ê¸°íƒ€': 7562 },
      '2025_3Q_Year': { 'OC(êµ­ë‚´)': 449912, 'ì¤‘êµ­': 547506, 'í™ì½©': 24679, 'ê¸°íƒ€': 15770 },
      '2025_4Q': { 'OC(êµ­ë‚´)': 0, 'ì¤‘êµ­': 0, 'í™ì½©': 0, 'ê¸°íƒ€': 0 },
      '2025_Year': { 'OC(êµ­ë‚´)': 449912, 'ì¤‘êµ­': 547506, 'í™ì½©': 24679, 'ê¸°íƒ€': 15770 },
    },
    'ë§¤ì¶œì´ì´ìµ': {
      '2024_1Q': { 'OC(êµ­ë‚´)': 241224, 'ì¤‘êµ­': 65297, 'í™ì½©': 12980, 'ê¸°íƒ€': 5096 },
      '2024_1Q_Year': { 'OC(êµ­ë‚´)': 241224, 'ì¤‘êµ­': 65297, 'í™ì½©': 12980, 'ê¸°íƒ€': 5096 },
      '2024_2Q': { 'OC(êµ­ë‚´)': 185827, 'ì¤‘êµ­': 50908, 'í™ì½©': 9737, 'ê¸°íƒ€': 5591 },
      '2024_2Q_Year': { 'OC(êµ­ë‚´)': 427051, 'ì¤‘êµ­': 116206, 'í™ì½©': 22717, 'ê¸°íƒ€': 10687 },
      '2024_3Q': { 'OC(êµ­ë‚´)': 258489, 'ì¤‘êµ­': 51328, 'í™ì½©': 8424, 'ê¸°íƒ€': 1481 },
      '2024_3Q_Year': { 'OC(êµ­ë‚´)': 685540, 'ì¤‘êµ­': 167533, 'í™ì½©': 31141, 'ê¸°íƒ€': 12168 },
      '2024_4Q': { 'OC(êµ­ë‚´)': 288842, 'ì¤‘êµ­': 26141, 'í™ì½©': 11827, 'ê¸°íƒ€': 1276 },
      '2024_Year': { 'OC(êµ­ë‚´)': 974382, 'ì¤‘êµ­': 193674, 'í™ì½©': 42968, 'ê¸°íƒ€': 13445 },
      '2025_1Q': { 'OC(êµ­ë‚´)': 251677, 'ì¤‘êµ­': 54762, 'í™ì½©': 10992, 'ê¸°íƒ€': 5789 },
      '2025_1Q_Year': { 'OC(êµ­ë‚´)': 251677, 'ì¤‘êµ­': 54762, 'í™ì½©': 10992, 'ê¸°íƒ€': 5789 },
      '2025_2Q': { 'OC(êµ­ë‚´)': 204615, 'ì¤‘êµ­': 35481, 'í™ì½©': 8754, 'ê¸°íƒ€': 5712 },
      '2025_2Q_Year': { 'OC(êµ­ë‚´)': 456292, 'ì¤‘êµ­': 90244, 'í™ì½©': 19746, 'ê¸°íƒ€': 11501 },
      '2025_3Q': { 'OC(êµ­ë‚´)': 308630, 'ì¤‘êµ­': 75413, 'í™ì½©': 8889, 'ê¸°íƒ€': 11276 },
      '2025_3Q_Year': { 'OC(êµ­ë‚´)': 764922, 'ì¤‘êµ­': 165656, 'í™ì½©': 28634, 'ê¸°íƒ€': 22777 },
      '2025_4Q': { 'OC(êµ­ë‚´)': 0, 'ì¤‘êµ­': 0, 'í™ì½©': 0, 'ê¸°íƒ€': 0 },
      '2025_Year': { 'OC(êµ­ë‚´)': 764922, 'ì¤‘êµ­': 165656, 'í™ì½©': 28634, 'ê¸°íƒ€': 22777 },
    },
    'ì¸ê±´ë¹„': {
      '2024_1Q': { 'OC(êµ­ë‚´)': 9937, 'ì¤‘êµ­': 6513, 'í™ì½©': 1928, 'ê¸°íƒ€': 1229 },
      '2024_1Q_Year': { 'OC(êµ­ë‚´)': 9937, 'ì¤‘êµ­': 6513, 'í™ì½©': 1928, 'ê¸°íƒ€': 1229 },
      '2024_2Q': { 'OC(êµ­ë‚´)': 11939, 'ì¤‘êµ­': 6389, 'í™ì½©': 1977, 'ê¸°íƒ€': 1627 },
      '2024_2Q_Year': { 'OC(êµ­ë‚´)': 21876, 'ì¤‘êµ­': 12901, 'í™ì½©': 3906, 'ê¸°íƒ€': 2856 },
      '2024_3Q': { 'OC(êµ­ë‚´)': 10188, 'ì¤‘êµ­': 6043, 'í™ì½©': 1724, 'ê¸°íƒ€': 1893 },
      '2024_3Q_Year': { 'OC(êµ­ë‚´)': 32064, 'ì¤‘êµ­': 18944, 'í™ì½©': 5630, 'ê¸°íƒ€': 4749 },
      '2024_4Q': { 'OC(êµ­ë‚´)': 11627, 'ì¤‘êµ­': 7185, 'í™ì½©': 2181, 'ê¸°íƒ€': 1570 },
      '2024_Year': { 'OC(êµ­ë‚´)': 43692, 'ì¤‘êµ­': 26130, 'í™ì½©': 7811, 'ê¸°íƒ€': 6319 },
      '2025_1Q': { 'OC(êµ­ë‚´)': 9755, 'ì¤‘êµ­': 7851, 'í™ì½©': 2410, 'ê¸°íƒ€': 1515 },
      '2025_1Q_Year': { 'OC(êµ­ë‚´)': 9755, 'ì¤‘êµ­': 7851, 'í™ì½©': 2410, 'ê¸°íƒ€': 1515 },
      '2025_2Q': { 'OC(êµ­ë‚´)': 10693, 'ì¤‘êµ­': 7020, 'í™ì½©': 1718, 'ê¸°íƒ€': 1305 },
      '2025_2Q_Year': { 'OC(êµ­ë‚´)': 20448, 'ì¤‘êµ­': 14870, 'í™ì½©': 4128, 'ê¸°íƒ€': 2819 },
      '2025_3Q': { 'OC(êµ­ë‚´)': 9633, 'ì¤‘êµ­': 6734, 'í™ì½©': 2156, 'ê¸°íƒ€': 1610 },
      '2025_3Q_Year': { 'OC(êµ­ë‚´)': 30082, 'ì¤‘êµ­': 21604, 'í™ì½©': 6284, 'ê¸°íƒ€': 4429 },
      '2025_4Q': { 'OC(êµ­ë‚´)': 0, 'ì¤‘êµ­': 0, 'í™ì½©': 0, 'ê¸°íƒ€': 0 },
      '2025_Year': { 'OC(êµ­ë‚´)': 30082, 'ì¤‘êµ­': 21604, 'í™ì½©': 6284, 'ê¸°íƒ€': 4429 },
    },
    'ê´‘ê³ ì„ ì „ë¹„': {
      '2024_1Q': { 'OC(êµ­ë‚´)': 10689, 'ì¤‘êµ­': 12045, 'í™ì½©': 422, 'ê¸°íƒ€': 940 },
      '2024_1Q_Year': { 'OC(êµ­ë‚´)': 10689, 'ì¤‘êµ­': 12045, 'í™ì½©': 422, 'ê¸°íƒ€': 940 },
      '2024_2Q': { 'OC(êµ­ë‚´)': 9145, 'ì¤‘êµ­': 5745, 'í™ì½©': 635, 'ê¸°íƒ€': 1430 },
      '2024_2Q_Year': { 'OC(êµ­ë‚´)': 19835, 'ì¤‘êµ­': 17790, 'í™ì½©': 1057, 'ê¸°íƒ€': 2371 },
      '2024_3Q': { 'OC(êµ­ë‚´)': 7102, 'ì¤‘êµ­': 10839, 'í™ì½©': 415, 'ê¸°íƒ€': 1546 },
      '2024_3Q_Year': { 'OC(êµ­ë‚´)': 26937, 'ì¤‘êµ­': 28628, 'í™ì½©': 1472, 'ê¸°íƒ€': 3917 },
      '2024_4Q': { 'OC(êµ­ë‚´)': 13418, 'ì¤‘êµ­': 16640, 'í™ì½©': 542, 'ê¸°íƒ€': 1579 },
      '2024_Year': { 'OC(êµ­ë‚´)': 40355, 'ì¤‘êµ­': 45269, 'í™ì½©': 2014, 'ê¸°íƒ€': 5496 },
      '2025_1Q': { 'OC(êµ­ë‚´)': 8143, 'ì¤‘êµ­': 14554, 'í™ì½©': 534, 'ê¸°íƒ€': 1379 },
      '2025_1Q_Year': { 'OC(êµ­ë‚´)': 8143, 'ì¤‘êµ­': 14554, 'í™ì½©': 534, 'ê¸°íƒ€': 1379 },
      '2025_2Q': { 'OC(êµ­ë‚´)': 8488, 'ì¤‘êµ­': 9119, 'í™ì½©': 554, 'ê¸°íƒ€': 1386 },
      '2025_2Q_Year': { 'OC(êµ­ë‚´)': 16631, 'ì¤‘êµ­': 23672, 'í™ì½©': 1088, 'ê¸°íƒ€': 2765 },
      '2025_3Q': { 'OC(êµ­ë‚´)': 6683, 'ì¤‘êµ­': 16328, 'í™ì½©': 585, 'ê¸°íƒ€': 1462 },
      '2025_3Q_Year': { 'OC(êµ­ë‚´)': 23314, 'ì¤‘êµ­': 40000, 'í™ì½©': 1673, 'ê¸°íƒ€': 4227 },
      '2025_4Q': { 'OC(êµ­ë‚´)': 0, 'ì¤‘êµ­': 0, 'í™ì½©': 0, 'ê¸°íƒ€': 0 },
      '2025_Year': { 'OC(êµ­ë‚´)': 23314, 'ì¤‘êµ­': 40000, 'í™ì½©': 1673, 'ê¸°íƒ€': 4227 },
    },
    'ìˆ˜ìˆ˜ë£Œ': {
      '2024_1Q': { 'OC(êµ­ë‚´)': 103398, 'ì¤‘êµ­': 11140, 'í™ì½©': 4655, 'ê¸°íƒ€': 2205 },
      '2024_1Q_Year': { 'OC(êµ­ë‚´)': 103398, 'ì¤‘êµ­': 11140, 'í™ì½©': 4655, 'ê¸°íƒ€': 2205 },
      '2024_2Q': { 'OC(êµ­ë‚´)': 89436, 'ì¤‘êµ­': 8168, 'í™ì½©': 1479, 'ê¸°íƒ€': 2829 },
      '2024_2Q_Year': { 'OC(êµ­ë‚´)': 192834, 'ì¤‘êµ­': 19308, 'í™ì½©': 6133, 'ê¸°íƒ€': 5035 },
      '2024_3Q': { 'OC(êµ­ë‚´)': 82954, 'ì¤‘êµ­': 8951, 'í™ì½©': 811, 'ê¸°íƒ€': 2866 },
      '2024_3Q_Year': { 'OC(êµ­ë‚´)': 275788, 'ì¤‘êµ­': 28260, 'í™ì½©': 6944, 'ê¸°íƒ€': 7900 },
      '2024_4Q': { 'OC(êµ­ë‚´)': 121114, 'ì¤‘êµ­': 13237, 'í™ì½©': 1689, 'ê¸°íƒ€': -469 },
      '2024_Year': { 'OC(êµ­ë‚´)': 396902, 'ì¤‘êµ­': 41497, 'í™ì½©': 8633, 'ê¸°íƒ€': 7432 },
      '2025_1Q': { 'OC(êµ­ë‚´)': 98102, 'ì¤‘êµ­': 13152, 'í™ì½©': 2341, 'ê¸°íƒ€': 1523 },
      '2025_1Q_Year': { 'OC(êµ­ë‚´)': 98102, 'ì¤‘êµ­': 13152, 'í™ì½©': 2341, 'ê¸°íƒ€': 1523 },
      '2025_2Q': { 'OC(êµ­ë‚´)': 82021, 'ì¤‘êµ­': 10209, 'í™ì½©': 1841, 'ê¸°íƒ€': 1844 },
      '2025_2Q_Year': { 'OC(êµ­ë‚´)': 180123, 'ì¤‘êµ­': 23360, 'í™ì½©': 4182, 'ê¸°íƒ€': 3367 },
      '2025_3Q': { 'OC(êµ­ë‚´)': 78829, 'ì¤‘êµ­': 11034, 'í™ì½©': 2221, 'ê¸°íƒ€': 1788 },
      '2025_3Q_Year': { 'OC(êµ­ë‚´)': 258952, 'ì¤‘êµ­': 34395, 'í™ì½©': 6403, 'ê¸°íƒ€': 5156 },
      '2025_4Q': { 'OC(êµ­ë‚´)': 0, 'ì¤‘êµ­': 0, 'í™ì½©': 0, 'ê¸°íƒ€': 0 },
      '2025_Year': { 'OC(êµ­ë‚´)': 258952, 'ì¤‘êµ­': 34395, 'í™ì½©': 6403, 'ê¸°íƒ€': 5156 },
    },
    'ê°ê°€ìƒê°ë¹„': {
      '2024_1Q': { 'OC(êµ­ë‚´)': 10414, 'ì¤‘êµ­': 5333, 'í™ì½©': 3793, 'ê¸°íƒ€': 327 },
      '2024_1Q_Year': { 'OC(êµ­ë‚´)': 10414, 'ì¤‘êµ­': 5333, 'í™ì½©': 3793, 'ê¸°íƒ€': 327 },
      '2024_2Q': { 'OC(êµ­ë‚´)': 10778, 'ì¤‘êµ­': 6017, 'í™ì½©': 3760, 'ê¸°íƒ€': 262 },
      '2024_2Q_Year': { 'OC(êµ­ë‚´)': 21192, 'ì¤‘êµ­': 11350, 'í™ì½©': 7552, 'ê¸°íƒ€': 590 },
      '2024_3Q': { 'OC(êµ­ë‚´)': 11822, 'ì¤‘êµ­': 6248, 'í™ì½©': 3540, 'ê¸°íƒ€': 313 },
      '2024_3Q_Year': { 'OC(êµ­ë‚´)': 33014, 'ì¤‘êµ­': 17598, 'í™ì½©': 11093, 'ê¸°íƒ€': 902 },
      '2024_4Q': { 'OC(êµ­ë‚´)': 12447, 'ì¤‘êµ­': 6712, 'í™ì½©': 3264, 'ê¸°íƒ€': 282 },
      '2024_Year': { 'OC(êµ­ë‚´)': 45461, 'ì¤‘êµ­': 24311, 'í™ì½©': 14357, 'ê¸°íƒ€': 1184 },
      '2025_1Q': { 'OC(êµ­ë‚´)': 12795, 'ì¤‘êµ­': 7629, 'í™ì½©': 3123, 'ê¸°íƒ€': 284 },
      '2025_1Q_Year': { 'OC(êµ­ë‚´)': 12795, 'ì¤‘êµ­': 7629, 'í™ì½©': 3123, 'ê¸°íƒ€': 284 },
      '2025_2Q': { 'OC(êµ­ë‚´)': 13173, 'ì¤‘êµ­': 6121, 'í™ì½©': 1876, 'ê¸°íƒ€': 292 },
      '2025_2Q_Year': { 'OC(êµ­ë‚´)': 25968, 'ì¤‘êµ­': 13750, 'í™ì½©': 5000, 'ê¸°íƒ€': 576 },
      '2025_3Q': { 'OC(êµ­ë‚´)': 12850, 'ì¤‘êµ­': 5468, 'í™ì½©': 3009, 'ê¸°íƒ€': 290 },
      '2025_3Q_Year': { 'OC(êµ­ë‚´)': 38819, 'ì¤‘êµ­': 19219, 'í™ì½©': 8009, 'ê¸°íƒ€': 867 },
      '2025_4Q': { 'OC(êµ­ë‚´)': 0, 'ì¤‘êµ­': 0, 'í™ì½©': 0, 'ê¸°íƒ€': 0 },
      '2025_Year': { 'OC(êµ­ë‚´)': 38819, 'ì¤‘êµ­': 19219, 'í™ì½©': 8009, 'ê¸°íƒ€': 867 },
    },
    'ê¸°íƒ€íŒê´€ë¹„': {
      '2024_1Q': { 'OC(êµ­ë‚´)': 11331, 'ì¤‘êµ­': 5585, 'í™ì½©': 1532, 'ê¸°íƒ€': 978 },
      '2024_1Q_Year': { 'OC(êµ­ë‚´)': 11331, 'ì¤‘êµ­': 5585, 'í™ì½©': 1532, 'ê¸°íƒ€': 978 },
      '2024_2Q': { 'OC(êµ­ë‚´)': 10450, 'ì¤‘êµ­': 3883, 'í™ì½©': 1390, 'ê¸°íƒ€': 973 },
      '2024_2Q_Year': { 'OC(êµ­ë‚´)': 21781, 'ì¤‘êµ­': 9469, 'í™ì½©': 2921, 'ê¸°íƒ€': 1952 },
      '2024_3Q': { 'OC(êµ­ë‚´)': 9320, 'ì¤‘êµ­': 5952, 'í™ì½©': 1478, 'ê¸°íƒ€': 1074 },
      '2024_3Q_Year': { 'OC(êµ­ë‚´)': 31101, 'ì¤‘êµ­': 15420, 'í™ì½©': 4400, 'ê¸°íƒ€': 3025 },
      '2024_4Q': { 'OC(êµ­ë‚´)': 14464, 'ì¤‘êµ­': 4950, 'í™ì½©': 2397, 'ê¸°íƒ€': 1893 },
      '2024_Year': { 'OC(êµ­ë‚´)': 45565, 'ì¤‘êµ­': 20370, 'í™ì½©': 6797, 'ê¸°íƒ€': 4918 },
      '2025_1Q': { 'OC(êµ­ë‚´)': 10904, 'ì¤‘êµ­': 5466, 'í™ì½©': 2581, 'ê¸°íƒ€': 1618 },
      '2025_1Q_Year': { 'OC(êµ­ë‚´)': 10904, 'ì¤‘êµ­': 5466, 'í™ì½©': 2581, 'ê¸°íƒ€': 1618 },
      '2025_2Q': { 'OC(êµ­ë‚´)': 9640, 'ì¤‘êµ­': 3353, 'í™ì½©': 2577, 'ê¸°íƒ€': 1649 },
      '2025_2Q_Year': { 'OC(êµ­ë‚´)': 20544, 'ì¤‘êµ­': 8820, 'í™ì½©': 5158, 'ê¸°íƒ€': 3267 },
      '2025_3Q': { 'OC(êµ­ë‚´)': 8066, 'ì¤‘êµ­': 5795, 'í™ì½©': 2164, 'ê¸°íƒ€': 3459 },
      '2025_3Q_Year': { 'OC(êµ­ë‚´)': 28610, 'ì¤‘êµ­': 14615, 'í™ì½©': 7323, 'ê¸°íƒ€': 6726 },
      '2025_4Q': { 'OC(êµ­ë‚´)': 0, 'ì¤‘êµ­': 0, 'í™ì½©': 0, 'ê¸°íƒ€': 0 },
      '2025_Year': { 'OC(êµ­ë‚´)': 28610, 'ì¤‘êµ­': 14615, 'í™ì½©': 7323, 'ê¸°íƒ€': 6726 },
    },
    'ì˜ì—…ì´ìµ': {
      '2024_1Q': { 'OC(êµ­ë‚´)': 95454, 'ì¤‘êµ­': 24682, 'í™ì½©': 650, 'ê¸°íƒ€': -583 },
      '2024_1Q_Year': { 'OC(êµ­ë‚´)': 95454, 'ì¤‘êµ­': 24682, 'í™ì½©': 650, 'ê¸°íƒ€': -583 },
      '2024_2Q': { 'OC(êµ­ë‚´)': 54079, 'ì¤‘êµ­': 20706, 'í™ì½©': 497, 'ê¸°íƒ€': -1531 },
      '2024_2Q_Year': { 'OC(êµ­ë‚´)': 149533, 'ì¤‘êµ­': 45387, 'í™ì½©': 1147, 'ê¸°íƒ€': -2114 },
      '2024_3Q': { 'OC(êµ­ë‚´)': 137103, 'ì¤‘êµ­': 13296, 'í™ì½©': 455, 'ê¸°íƒ€': -6210 },
      '2024_3Q_Year': { 'OC(êµ­ë‚´)': 286636, 'ì¤‘êµ­': 58683, 'í™ì½©': 1602, 'ê¸°íƒ€': -8324 },
      '2024_4Q': { 'OC(êµ­ë‚´)': 115771, 'ì¤‘êµ­': -22584, 'í™ì½©': 1754, 'ê¸°íƒ€': -3579 },
      '2024_Year': { 'OC(êµ­ë‚´)': 402407, 'ì¤‘êµ­': 36099, 'í™ì½©': 3357, 'ê¸°íƒ€': -11903 },
      '2025_1Q': { 'OC(êµ­ë‚´)': 111978, 'ì¤‘êµ­': 6110, 'í™ì½©': 3, 'ê¸°íƒ€': -529 },
      '2025_1Q_Year': { 'OC(êµ­ë‚´)': 111978, 'ì¤‘êµ­': 6110, 'í™ì½©': 3, 'ê¸°íƒ€': -529 },
      '2025_2Q': { 'OC(êµ­ë‚´)': 80600, 'ì¤‘êµ­': -340, 'í™ì½©': 187, 'ê¸°íƒ€': -765 },
      '2025_2Q_Year': { 'OC(êµ­ë‚´)': 192577, 'ì¤‘êµ­': 5770, 'í™ì½©': 190, 'ê¸°íƒ€': -1294 },
      '2025_3Q': { 'OC(êµ­ë‚´)': 192568, 'ì¤‘êµ­': 30053, 'í™ì½©': -1246, 'ê¸°íƒ€': 2667 },
      '2025_3Q_Year': { 'OC(êµ­ë‚´)': 385145, 'ì¤‘êµ­': 35823, 'í™ì½©': -1056, 'ê¸°íƒ€': 1372 },
      '2025_4Q': { 'OC(êµ­ë‚´)': 0, 'ì¤‘êµ­': 0, 'í™ì½©': 0, 'ê¸°íƒ€': 0 },
      '2025_Year': { 'OC(êµ­ë‚´)': 385145, 'ì¤‘êµ­': 35823, 'í™ì½©': -1056, 'ê¸°íƒ€': 1372 },
    },
    'ë‹¹ê¸°ìˆœì´ìµ': {
      '2024_1Q': { 'OC(êµ­ë‚´)': 72187, 'ì¤‘êµ­': 18059, 'í™ì½©': 319, 'ê¸°íƒ€': -820 },
      '2024_1Q_Year': { 'OC(êµ­ë‚´)': 72187, 'ì¤‘êµ­': 18059, 'í™ì½©': 319, 'ê¸°íƒ€': -820 },
      '2024_2Q': { 'OC(êµ­ë‚´)': 48504, 'ì¤‘êµ­': 15349, 'í™ì½©': 267, 'ê¸°íƒ€': -2445 },
      '2024_2Q_Year': { 'OC(êµ­ë‚´)': 120691, 'ì¤‘êµ­': 33409, 'í™ì½©': 586, 'ê¸°íƒ€': -3265 },
      '2024_3Q': { 'OC(êµ­ë‚´)': 105886, 'ì¤‘êµ­': 9479, 'í™ì½©': 2, 'ê¸°íƒ€': -9957 },
      '2024_3Q_Year': { 'OC(êµ­ë‚´)': 226577, 'ì¤‘êµ­': 42887, 'í™ì½©': 588, 'ê¸°íƒ€': -13222 },
      '2024_4Q': { 'OC(êµ­ë‚´)': 96955, 'ì¤‘êµ­': -17665, 'í™ì½©': 1540, 'ê¸°íƒ€': -9135 },
      '2024_Year': { 'OC(êµ­ë‚´)': 323532, 'ì¤‘êµ­': 25222, 'í™ì½©': 2128, 'ê¸°íƒ€': -22358 },
      '2025_1Q': { 'OC(êµ­ë‚´)': 79838, 'ì¤‘êµ­': 3693, 'í™ì½©': -173, 'ê¸°íƒ€': -4775 },
      '2025_1Q_Year': { 'OC(êµ­ë‚´)': 79838, 'ì¤‘êµ­': 3693, 'í™ì½©': -173, 'ê¸°íƒ€': -4775 },
      '2025_2Q': { 'OC(êµ­ë‚´)': 64206, 'ì¤‘êµ­': -1457, 'í™ì½©': 397, 'ê¸°íƒ€': -4516 },
      '2025_2Q_Year': { 'OC(êµ­ë‚´)': 144044, 'ì¤‘êµ­': 2236, 'í™ì½©': 224, 'ê¸°íƒ€': -9292 },
      '2025_3Q': { 'OC(êµ­ë‚´)': 150942, 'ì¤‘êµ­': 21686, 'í™ì½©': -1312, 'ê¸°íƒ€': -259 },
      '2025_3Q_Year': { 'OC(êµ­ë‚´)': 294987, 'ì¤‘êµ­': 23922, 'í™ì½©': -1087, 'ê¸°íƒ€': -9551 },
      '2025_4Q': { 'OC(êµ­ë‚´)': 0, 'ì¤‘êµ­': 0, 'í™ì½©': 0, 'ê¸°íƒ€': 0 },
      '2025_Year': { 'OC(êµ­ë‚´)': 294987, 'ì¤‘êµ­': 23922, 'í™ì½©': -1087, 'ê¸°íƒ€': -9551 },
    },
  };

  // ============================================
  // ë²•ì¸ë³„ ì¬ë¬´ìƒíƒœí‘œ ë°ì´í„° (ì»´í¬ë„ŒíŠ¸ ìƒìœ„ ë ˆë²¨)
  // ============================================
  const entityBSData = {
    '2024_1Q': {
      í˜„ê¸ˆì„±ìì‚°: { 'OC(êµ­ë‚´)': 291693, ì¤‘êµ­: 12162, í™ì½©: 4132, STë¯¸êµ­: 22754 },
      ë§¤ì¶œì±„ê¶Œ: { 'OC(êµ­ë‚´)': 109224, ì¤‘êµ­: 7225, í™ì½©: 3399, STë¯¸êµ­: 3441 },
      ì¬ê³ ìì‚°: { 'OC(êµ­ë‚´)': 232095, ì¤‘êµ­: 136110, í™ì½©: 33179, STë¯¸êµ­: 4244 },
      ìœ ë¬´í˜•ìì‚°: { 'OC(êµ­ë‚´)': 197870, ì¤‘êµ­: 9894, í™ì½©: 3591, STë¯¸êµ­: 64546 },
      ì‚¬ìš©ê¶Œìì‚°: { 'OC(êµ­ë‚´)': 182423, ì¤‘êµ­: 62091, í™ì½©: 36179, STë¯¸êµ­: 2573 },
      ì°¨ì…ê¸ˆ: { 'OC(êµ­ë‚´)': 0, ì¤‘êµ­: 72442, í™ì½©: 0, STë¯¸êµ­: 9051 },
      ë§¤ì…ì±„ë¬´: { 'OC(êµ­ë‚´)': 69104, ì¤‘êµ­: 5104, í™ì½©: 45034, STë¯¸êµ­: 1191 },
      ìì‚°ì´ê³„: { 'OC(êµ­ë‚´)': 1765417, ì¤‘êµ­: 271920, í™ì½©: 64615, STë¯¸êµ­: 99288 },
      ë¶€ì±„ì´ê³„: { 'OC(êµ­ë‚´)': 492867, ì¤‘êµ­: 201248, í™ì½©: 64061, STë¯¸êµ­: 14432 },
      ìë³¸ì´ê³„: { 'OC(êµ­ë‚´)': 1272550, ì¤‘êµ­: 70672, í™ì½©: 554, STë¯¸êµ­: 84856 },
    },
    '2024_2Q': {
      í˜„ê¸ˆì„±ìì‚°: { 'OC(êµ­ë‚´)': 161519, ì¤‘êµ­: 27175, í™ì½©: 3743, STë¯¸êµ­: 23099 },
      ë§¤ì¶œì±„ê¶Œ: { 'OC(êµ­ë‚´)': 91507, ì¤‘êµ­: 7183, í™ì½©: 2816, STë¯¸êµ­: 5174 },
      ì¬ê³ ìì‚°: { 'OC(êµ­ë‚´)': 207444, ì¤‘êµ­: 115040, í™ì½©: 30582, STë¯¸êµ­: 4806 },
      ìœ ë¬´í˜•ìì‚°: { 'OC(êµ­ë‚´)': 251498, ì¤‘êµ­: 10189, í™ì½©: 3419, STë¯¸êµ­: 66586 },
      ì‚¬ìš©ê¶Œìì‚°: { 'OC(êµ­ë‚´)': 181318, ì¤‘êµ­: 73343, í™ì½©: 35860, STë¯¸êµ­: 2654 },
      ì°¨ì…ê¸ˆ: { 'OC(êµ­ë‚´)': 0, ì¤‘êµ­: 0, í™ì½©: 0, STë¯¸êµ­: 9440 },
      ë§¤ì…ì±„ë¬´: { 'OC(êµ­ë‚´)': 48681, ì¤‘êµ­: 1415, í™ì½©: 42027, STë¯¸êµ­: 3799 },
      ìì‚°ì´ê³„: { 'OC(êµ­ë‚´)': 1636710, ì¤‘êµ­: 243233, í™ì½©: 59168, STë¯¸êµ­: 105286 },
      ë¶€ì±„ì´ê³„: { 'OC(êµ­ë‚´)': 330928, ì¤‘êµ­: 155343, í™ì½©: 58441, STë¯¸êµ­: 17169 },
      ìë³¸ì´ê³„: { 'OC(êµ­ë‚´)': 1305782, ì¤‘êµ­: 87890, í™ì½©: 727, STë¯¸êµ­: 88118 },
    },
    '2024_3Q': {
      í˜„ê¸ˆì„±ìì‚°: { 'OC(êµ­ë‚´)': 142325, ì¤‘êµ­: 24304, í™ì½©: 3061, STë¯¸êµ­: 19294 },
      ë§¤ì¶œì±„ê¶Œ: { 'OC(êµ­ë‚´)': 137912, ì¤‘êµ­: 81857, í™ì½©: 2230, STë¯¸êµ­: 6587 },
      ì¬ê³ ìì‚°: { 'OC(êµ­ë‚´)': 247068, ì¤‘êµ­: 174481, í™ì½©: 34086, STë¯¸êµ­: 5150 },
      ìœ ë¬´í˜•ìì‚°: { 'OC(êµ­ë‚´)': 345549, ì¤‘êµ­: 9901, í™ì½©: 2659, STë¯¸êµ­: 63244 },
      ì‚¬ìš©ê¶Œìì‚°: { 'OC(êµ­ë‚´)': 185625, ì¤‘êµ­: 77192, í™ì½©: 36969, STë¯¸êµ­: 2521 },
      ì°¨ì…ê¸ˆ: { 'OC(êµ­ë‚´)': 0, ì¤‘êµ­: 86820, í™ì½©: 0, STë¯¸êµ­: 10398 },
      ë§¤ì…ì±„ë¬´: { 'OC(êµ­ë‚´)': 115166, ì¤‘êµ­: 63397, í™ì½©: 43473, STë¯¸êµ­: 1942 },
      ìì‚°ì´ê³„: { 'OC(êµ­ë‚´)': 1806476, ì¤‘êµ­: 363370, í™ì½©: 59839, STë¯¸êµ­: 97845 },
      ë¶€ì±„ì´ê³„: { 'OC(êµ­ë‚´)': 397220, ì¤‘êµ­: 266874, í™ì½©: 59025, STë¯¸êµ­: 16360 },
      ìë³¸ì´ê³„: { 'OC(êµ­ë‚´)': 1409256, ì¤‘êµ­: 96496, í™ì½©: 814, STë¯¸êµ­: 81486 },
    },
    '2024_4Q': {
      í˜„ê¸ˆì„±ìì‚°: { 'OC(êµ­ë‚´)': 61500, ì¤‘êµ­: 29229, í™ì½©: 6073, STë¯¸êµ­: 22881 },
      ë§¤ì¶œì±„ê¶Œ: { 'OC(êµ­ë‚´)': 134453, ì¤‘êµ­: 40081, í™ì½©: 3967, STë¯¸êµ­: 7463 },
      ì¬ê³ ìì‚°: { 'OC(êµ­ë‚´)': 214281, ì¤‘êµ­: 141223, í™ì½©: 35205, STë¯¸êµ­: 8723 },
      ìœ ë¬´í˜•ìì‚°: { 'OC(êµ­ë‚´)': 609769, ì¤‘êµ­: 10416, í™ì½©: 2479, STë¯¸êµ­: 70443 },
      ì‚¬ìš©ê¶Œìì‚°: { 'OC(êµ­ë‚´)': 183782, ì¤‘êµ­: 93085, í™ì½©: 43127, STë¯¸êµ­: 2809 },
      ì°¨ì…ê¸ˆ: { 'OC(êµ­ë‚´)': 45000, ì¤‘êµ­: 100635, í™ì½©: 0, STë¯¸êµ­: 16128 },
      ë§¤ì…ì±„ë¬´: { 'OC(êµ­ë‚´)': 79795, ì¤‘êµ­: 17885, í™ì½©: 47089, STë¯¸êµ­: 6030 },
      ìì‚°ì´ê³„: { 'OC(êµ­ë‚´)': 1923504, ì¤‘êµ­: 336611, í™ì½©: 67244, STë¯¸êµ­: 112329 },
      ë¶€ì±„ì´ê³„: { 'OC(êµ­ë‚´)': 429786, ì¤‘êµ­: 252897, í™ì½©: 64912, STë¯¸êµ­: 26968 },
      ìë³¸ì´ê³„: { 'OC(êµ­ë‚´)': 1493718, ì¤‘êµ­: 83714, í™ì½©: 2333, STë¯¸êµ­: 85361 },
    },
    '2025_1Q': {
      í˜„ê¸ˆì„±ìì‚°: { 'OC(êµ­ë‚´)': 79496, ì¤‘êµ­: 60404, í™ì½©: 7022, STë¯¸êµ­: 16283 },
      ë§¤ì¶œì±„ê¶Œ: { 'OC(êµ­ë‚´)': 123193, ì¤‘êµ­: 20896, í™ì½©: 2465, STë¯¸êµ­: 8621 },
      ì¬ê³ ìì‚°: { 'OC(êµ­ë‚´)': 214607, ì¤‘êµ­: 123617, í™ì½©: 33553, STë¯¸êµ­: 9993 },
      ìœ ë¬´í˜•ìì‚°: { 'OC(êµ­ë‚´)': 611019, ì¤‘êµ­: 9130, í™ì½©: 1887, STë¯¸êµ­: 70268 },
      ì‚¬ìš©ê¶Œìì‚°: { 'OC(êµ­ë‚´)': 187827, ì¤‘êµ­: 64626, í™ì½©: 28845, STë¯¸êµ­: 1788 },
      ì°¨ì…ê¸ˆ: { 'OC(êµ­ë‚´)': 20000, ì¤‘êµ­: 56470, í™ì½©: 0, STë¯¸êµ­: 19935 },
      ë§¤ì…ì±„ë¬´: { 'OC(êµ­ë‚´)': 69813, ì¤‘êµ­: 28622, í™ì½©: 44833, STë¯¸êµ­: 3153 },
      ìì‚°ì´ê³„: { 'OC(êµ­ë‚´)': 1944504, ì¤‘êµ­: 290073, í™ì½©: 65030, STë¯¸êµ­: 108362 },
      ë¶€ì±„ì´ê³„: { 'OC(êµ­ë‚´)': 435129, ì¤‘êµ­: 202453, í™ì½©: 62976, STë¯¸êµ­: 27826 },
      ìë³¸ì´ê³„: { 'OC(êµ­ë‚´)': 1509375, ì¤‘êµ­: 87621, í™ì½©: 2054, STë¯¸êµ­: 80536 },
    },
    '2025_2Q': {
      í˜„ê¸ˆì„±ìì‚°: { 'OC(êµ­ë‚´)': 88735, ì¤‘êµ­: 20311, í™ì½©: 4732, STë¯¸êµ­: 12241 },
      ë§¤ì¶œì±„ê¶Œ: { 'OC(êµ­ë‚´)': 81953, ì¤‘êµ­: 8793, í™ì½©: 3324, STë¯¸êµ­: 7117 },
      ì¬ê³ ìì‚°: { 'OC(êµ­ë‚´)': 199308, ì¤‘êµ­: 113822, í™ì½©: 29260, STë¯¸êµ­: 9317 },
      ìœ ë¬´í˜•ìì‚°: { 'OC(êµ­ë‚´)': 607960, ì¤‘êµ­: 7699, í™ì½©: 2490, STë¯¸êµ­: 64980 },
      ì‚¬ìš©ê¶Œìì‚°: { 'OC(êµ­ë‚´)': 188380, ì¤‘êµ­: 54824, í™ì½©: 25337, STë¯¸êµ­: 1653 },
      ì°¨ì…ê¸ˆ: { 'OC(êµ­ë‚´)': 0, ì¤‘êµ­: 32157, í™ì½©: 0, STë¯¸êµ­: 18641 },
      ë§¤ì…ì±„ë¬´: { 'OC(êµ­ë‚´)': 53644, ì¤‘êµ­: 10263, í™ì½©: 39679, STë¯¸êµ­: 3362 },
      ìì‚°ì´ê³„: { 'OC(êµ­ë‚´)': 1891404, ì¤‘êµ­: 231683, í™ì½©: 56311, STë¯¸êµ­: 99662 },
      ë¶€ì±„ì´ê³„: { 'OC(êµ­ë‚´)': 318573, ì¤‘êµ­: 150855, í™ì½©: 52987, STë¯¸êµ­: 25993 },
      ìë³¸ì´ê³„: { 'OC(êµ­ë‚´)': 1572831, ì¤‘êµ­: 80828, í™ì½©: 3324, STë¯¸êµ­: 73668 },
    },
    '2025_3Q': {
      í˜„ê¸ˆì„±ìì‚°: { 'OC(êµ­ë‚´)': 182075, ì¤‘êµ­: 9318, í™ì½©: 4446, STë¯¸êµ­: 11400 },
      ë§¤ì¶œì±„ê¶Œ: { 'OC(êµ­ë‚´)': 205309, ì¤‘êµ­: 97531, í™ì½©: 2871, STë¯¸êµ­: 16277 },
      ì¬ê³ ìì‚°: { 'OC(êµ­ë‚´)': 242024, ì¤‘êµ­: 281973, í™ì½©: 34165, STë¯¸êµ­: 12558 },
      ìœ ë¬´í˜•ìì‚°: { 'OC(êµ­ë‚´)': 605413, ì¤‘êµ­: 8114, í™ì½©: 3290, STë¯¸êµ­: 67161 },
      ì‚¬ìš©ê¶Œìì‚°: { 'OC(êµ­ë‚´)': 186612, ì¤‘êµ­: 56782, í™ì½©: 37937, STë¯¸êµ­: 1709 },
      ì°¨ì…ê¸ˆ: { 'OC(êµ­ë‚´)': 0, ì¤‘êµ­: 160605, í™ì½©: 0, STë¯¸êµ­: 25140 },
      ë§¤ì…ì±„ë¬´: { 'OC(êµ­ë‚´)': 139941, ì¤‘êµ­: 131315, í™ì½©: 47089, STë¯¸êµ­: 3739 },
      ìì‚°ì´ê³„: { 'OC(êµ­ë‚´)': 2145196, ì¤‘êµ­: 495765, í™ì½©: 71221, STë¯¸êµ­: 111397 },
      ë¶€ì±„ì´ê³„: { 'OC(êµ­ë‚´)': 423707, ì¤‘êµ­: 389821, í™ì½©: 69512, STë¯¸êµ­: 32762 },
      ìë³¸ì´ê³„: { 'OC(êµ­ë‚´)': 1721489, ì¤‘êµ­: 105943, í™ì½©: 1710, STë¯¸êµ­: 78635 },
    },
  };
  // ============================================
  // AI ë¶„ì„ í•¨ìˆ˜
  // ============================================
  const generateAIAnalysis = () => {
    if (!selectedPeriod) {
      return {
        keyMetrics: {
          opMargin: { curr: 0, prev: 0, change: 0 },
          netMargin: { curr: 0, prev: 0, change: 0 },
          debtRatio: { curr: 0, prev: 0, status: 'ì•ˆì •' },
          roe: { curr: 0, prev: 0, change: 0 }
        },
        insights: [],
        risks: [],
        actions: [],
        improvementTargets: []
      };
    }
    const selectedYearKey = getPeriodKey(selectedPeriod, 'year');
    const prevYearKey = getPeriodKey(selectedPeriod, 'prev_year') || '2024_Year';
    // ì¬ë¬´ìƒíƒœí‘œëŠ” ë¶„ê¸°ë³„ ë°ì´í„°ì´ë¯€ë¡œ quarter í‚¤ ì‚¬ìš©
    let currentPeriod = getPeriodKey(selectedPeriod, 'quarter'); // '2025_Q4' -> '2025_4Q'
    let prevPeriod = getPeriodKey(selectedPeriod, 'prev') || '2024_4Q';
    
    // ì¬ë¬´ìƒíƒœí‘œ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ìµœì‹  ë¶„ê¸° ë°ì´í„° ì‚¬ìš© (fallback)
    if (!balanceSheetData[currentPeriod]) {
      // 2025_4Qê°€ ì—†ìœ¼ë©´ 2025_3Q ì‚¬ìš©
      if (currentPeriod === '2025_4Q') {
        currentPeriod = '2025_3Q';
      }
    }
    if (!balanceSheetData[prevPeriod]) {
      // ì „ ë¶„ê¸° ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì „ë…„ ë™ê¸° ì‚¬ìš©
      prevPeriod = getPeriodKey(selectedPeriod, 'prev_quarter') || '2024_4Q';
    }
    
    // 1) í•µì‹¬ ì§€í‘œ ê³„ì‚°
    const salesCurr = incomeStatementData[selectedYearKey]?.ë§¤ì¶œì•¡ || 0;
    const salesPrev = incomeStatementData[prevYearKey]?.ë§¤ì¶œì•¡ || 0;
    const opIncomeCurr = incomeStatementData[selectedYearKey]?.ì˜ì—…ì´ìµ || 0;
    const opIncomePrev = incomeStatementData[prevYearKey]?.ì˜ì—…ì´ìµ || 0;
    const netIncomeCurr = incomeStatementData[selectedYearKey]?.ë‹¹ê¸°ìˆœì´ìµ || 0;
    const netIncomePrev = incomeStatementData[prevYearKey]?.ë‹¹ê¸°ìˆœì´ìµ || 0;
    
    // ì¬ë¬´ìƒíƒœí‘œ ë°ì´í„° í™•ì¸ ë° ê³„ì‚° (ì•ˆì „í•œ ì ‘ê·¼)
    const bsCurr = balanceSheetData?.[currentPeriod] || {};
    const bsPrev = balanceSheetData?.[prevPeriod] || {};
    const totalAssetsCurr = bsCurr.ìì‚°ì´ê³„ || 0;
    const totalAssetsPrev = bsPrev.ìì‚°ì´ê³„ || 0;
    const totalDebtCurr = bsCurr.ë¶€ì±„ì´ê³„ || 0;
    const totalDebtPrev = bsPrev.ë¶€ì±„ì´ê³„ || 0;
    const totalEquityCurr = bsCurr.ìë³¸ì´ê³„ || 0;
    const totalEquityPrev = bsPrev.ìë³¸ì´ê³„ || 0;
    
    const opMarginCurr = salesCurr > 0 ? (opIncomeCurr / salesCurr * 100) : 0;
    const opMarginPrev = salesPrev > 0 ? (opIncomePrev / salesPrev * 100) : 0;
    const netMarginCurr = salesCurr > 0 ? (netIncomeCurr / salesCurr * 100) : 0;
    const netMarginPrev = salesPrev > 0 ? (netIncomePrev / salesPrev * 100) : 0;
    
    // ë¶€ì±„ë¹„ìœ¨ ê³„ì‚° (ë¶€ì±„ì´ê³„ / ìë³¸ì´ê³„ * 100)
    let debtRatioCurr = 0;
    if (totalEquityCurr > 0) {
      debtRatioCurr = (totalDebtCurr / totalEquityCurr * 100);
      if (!isFinite(debtRatioCurr) || isNaN(debtRatioCurr)) debtRatioCurr = 0;
    } else if (totalDebtCurr > 0) {
      debtRatioCurr = 999; // ìë³¸ì´ 0ì¸ ê²½ìš°
    }
    
    let debtRatioPrev = 0;
    if (totalEquityPrev > 0) {
      debtRatioPrev = (totalDebtPrev / totalEquityPrev * 100);
      if (!isFinite(debtRatioPrev) || isNaN(debtRatioPrev)) debtRatioPrev = 0;
    } else if (totalDebtPrev > 0) {
      debtRatioPrev = 999;
    }
    
    // ROE ê³„ì‚° (ë‹¹ê¸°ìˆœì´ìµ / ìë³¸ì´ê³„ * 100)
    let roeCurr = 0;
    if (totalEquityCurr > 0) {
      roeCurr = (netIncomeCurr / totalEquityCurr * 100);
      if (!isFinite(roeCurr) || isNaN(roeCurr)) roeCurr = 0;
    }
    
    let roePrev = 0;
    if (totalEquityPrev > 0) {
      roePrev = (netIncomePrev / totalEquityPrev * 100);
      if (!isFinite(roePrev) || isNaN(roePrev)) roePrev = 0;
    }
    
    const salesGrowth = salesPrev > 0 ? ((salesCurr - salesPrev) / salesPrev * 100) : 0;
    const opMarginChange = opMarginCurr - opMarginPrev;
    const netMarginChange = netMarginCurr - netMarginPrev;
    const roeChange = roeCurr - roePrev;
    
    // 2) ë²•ì¸ë³„ ìˆ˜ìµì„± ë¶„ì„ (ì˜ì—…ì´ìµë¥  + ROE)
    // entityBSDataë„ ê°™ì€ currentPeriod ì‚¬ìš© (fallback ì ìš©ë¨)
    const entityBSPeriod = entityBSData[currentPeriod] ? currentPeriod : (currentPeriod === '2025_4Q' ? '2025_3Q' : currentPeriod);
    
    const entityProfitability = ['OC(êµ­ë‚´)', 'ì¤‘êµ­', 'í™ì½©', 'ê¸°íƒ€'].map(entity => {
      const sales = entityData.ë§¤ì¶œì•¡?.[selectedYearKey]?.[entity] || 0;
      const opIncome = entityData.ì˜ì—…ì´ìµ?.[selectedYearKey]?.[entity] || 0;
      const netIncome = entityData.ë‹¹ê¸°ìˆœì´ìµ?.[selectedYearKey]?.[entity] || 0;
      const margin = sales > 0 ? (opIncome / sales * 100) : 0;
      
      // ë²•ì¸ë³„ ROE ê³„ì‚° (ë²•ì¸ë³„ ë‹¹ê¸°ìˆœì´ìµ / ë²•ì¸ë³„ ìë³¸ì´ê³„ * 100)
      const entityEquity = (entityBSData && entityBSData[entityBSPeriod] && entityBSData[entityBSPeriod].ìë³¸ì´ê³„) 
        ? (entityBSData[entityBSPeriod].ìë³¸ì´ê³„[entity] || 0) 
        : 0;
      let entityROE = 0;
      if (entityEquity > 0) {
        entityROE = (netIncome / entityEquity * 100);
        if (!isFinite(entityROE) || isNaN(entityROE)) entityROE = 0;
      }
      
      return { entity, sales, opIncome, netIncome, margin, equity: entityEquity, roe: entityROE };
    }).sort((a, b) => b.margin - a.margin);
    
    // 3) íŒê´€ë¹„ êµ¬ì¡° ë¶„ì„
    const sgaBreakdown = ['ì¸ê±´ë¹„', 'ê´‘ê³ ì„ ì „ë¹„', 'ìˆ˜ìˆ˜ë£Œ', 'ê°ê°€ìƒê°ë¹„', 'ê¸°íƒ€íŒê´€ë¹„'].map(item => {
      const curr = incomeStatementData[selectedYearKey]?.[item] || 0;
      const prev = incomeStatementData[prevYearKey]?.[item] || 0;
      const change = prev > 0 ? ((curr - prev) / prev * 100) : 0;
      const salesRatio = salesCurr > 0 ? (curr / salesCurr * 100) : 0;
      return { item, curr, prev, change, salesRatio };
    }).sort((a, b) => b.curr - a.curr);
    
    // 4) ì¬ë¬´ì•ˆì •ì„± ë¶„ì„
    const cashCurr = bsCurr.í˜„ê¸ˆë°í˜„ê¸ˆì„±ìì‚° || bsCurr.í˜„ê¸ˆì„±ìì‚° || 0;
    const cashPrev = bsPrev.í˜„ê¸ˆë°í˜„ê¸ˆì„±ìì‚° || bsPrev.í˜„ê¸ˆì„±ìì‚° || 0;
    const arCurr = bsCurr.ë§¤ì¶œì±„ê¶Œ || 0;
    const inventoryCurr = bsCurr.ì¬ê³ ìì‚° || 0;
    const inventoryPrev = bsPrev.ì¬ê³ ìì‚° || 0;
    const apCurr = bsCurr.ë§¤ì…ì±„ë¬´ || 0;
    const workingCapitalCurr = arCurr + inventoryCurr - apCurr;
    
    const inventoryGrowth = inventoryPrev > 0 ? ((inventoryCurr - inventoryPrev) / inventoryPrev * 100) : 0;
    const cashGrowth = cashPrev > 0 ? ((cashCurr - cashPrev) / cashPrev * 100) : 0;
    
    // 5) ì°¨ì…ê¸ˆ ë¶„ì„ (entityBSPeriod ì‚¬ìš©)
    const borrowingsByEntity = ['OC(êµ­ë‚´)', 'ì¤‘êµ­', 'í™ì½©', 'STë¯¸êµ­'].map(entity => {
      const debt = (entityBSData && entityBSData[entityBSPeriod] && entityBSData[entityBSPeriod].ì°¨ì…ê¸ˆ) ? (entityBSData[entityBSPeriod].ì°¨ì…ê¸ˆ[entity] || 0) : 0;
      const equity = (entityBSData && entityBSData[entityBSPeriod] && entityBSData[entityBSPeriod].ìë³¸ì´ê³„) ? (entityBSData[entityBSPeriod].ìë³¸ì´ê³„[entity] || 0) : 0;
      const debtRatio = equity > 0 ? (debt / equity * 100) : 0;
      return { entity, debt, equity, debtRatio };
    }).filter(x => x.debt > 0).sort((a, b) => b.debt - a.debt);
    
    const totalBorrowing = borrowingsByEntity.reduce((sum, x) => sum + x.debt, 0);
    
    // 6) íšŒì „ìœ¨ ë¶„ì„
    const inventoryTurnover = (salesCurr > 0 && inventoryCurr > 0) ? (salesCurr / inventoryCurr) : 0;
    const inventoryDays = inventoryTurnover > 0 ? (365 / inventoryTurnover) : 0;
    const arTurnover = (salesCurr > 0 && arCurr > 0) ? (salesCurr / arCurr) : 0;
    const arDays = arTurnover > 0 ? (365 / arTurnover) : 0;
    const apTurnover = (salesCurr > 0 && apCurr > 0) ? (salesCurr / apCurr) : 0;
    const apDays = apTurnover > 0 ? (365 / apTurnover) : 0;
    const cashConversionCycle = (arDays || 0) + (inventoryDays || 0) - (apDays || 0);
    
    // 7) ë§¤ì¶œì´ì´ìµë¥  ë¶„ì„
    const grossProfitCurr = incomeStatementData[selectedYearKey]?.ë§¤ì¶œì´ì´ìµ || 0;
    const grossProfitPrev = incomeStatementData[prevYearKey]?.ë§¤ì¶œì´ì´ìµ || 0;
    const grossMarginCurr = salesCurr > 0 ? (grossProfitCurr / salesCurr * 100) : 0;
    const grossMarginPrev = salesPrev > 0 ? (grossProfitPrev / salesPrev * 100) : 0;
    const grossMarginChange = grossMarginCurr - grossMarginPrev;
    
    // 8) ì¸ì‚¬ì´íŠ¸ ìƒì„±
    const insights = [];
    const risks = [];
    const actions = [];
    const improvementTargets = []; // ê°œì„  íƒ€ê²Ÿ ë°°ì—´ ì´ˆê¸°í™”
    
    // ìˆ˜ìµì„± ì¸ì‚¬ì´íŠ¸
    if (opMarginChange > 0) {
      insights.push({
        title: 'ì˜ì—…ì´ìµë¥  ê°œì„ ',
        desc: `${opMarginCurr.toFixed(1)}%ë¡œ ${Math.abs(opMarginChange).toFixed(1)}%p ìƒìŠ¹. ${
          salesGrowth < 0 ? 'ë§¤ì¶œ ê°ì†Œì—ë„ ë¹„ìš© ê´€ë¦¬ íš¨ê³¼ë¡œ ìˆ˜ìµì„± ê°œì„ ' : 'ë§¤ì¶œ ì„±ì¥ê³¼ í•¨ê»˜ ìˆ˜ìµì„± ë™ë°˜ ìƒìŠ¹'
        }`
      });
    } else if (opMarginChange < -1) {
      risks.push({
        title: 'ìˆ˜ìµì„± ì•…í™”',
        desc: `ì˜ì—…ì´ìµë¥  ${opMarginCurr.toFixed(1)}%ë¡œ ${Math.abs(opMarginChange).toFixed(1)}%p í•˜ë½. ë¹„ìš© êµ¬ì¡° ì ê²€ í•„ìš”`
      });
    }
    
    // ë§¤ì¶œì´ì´ìµë¥  ë¶„ì„
    if (grossMarginChange < -2) {
      risks.push({
        title: 'ë§¤ì¶œì´ì´ìµë¥  í•˜ë½',
        desc: `${grossMarginCurr.toFixed(1)}%ë¡œ ${Math.abs(grossMarginChange).toFixed(1)}%p í•˜ë½. ì›ê°€ ìƒìŠ¹ ë˜ëŠ” ê°€ê²© ê²½ìŸ ì‹¬í™”`
      });
      actions.push({
        title: 'ì›ê°€ìœ¨ ê°œì„ ',
        desc: `í˜‘ë ¥ì—…ì²´ í˜‘ìƒë ¥ ê°•í™”, ì†Œì‹± ë‹¤ë³€í™”, ìƒì‚° íš¨ìœ¨ ê°œì„ ìœ¼ë¡œ ì›ê°€ìœ¨ 2%p ì ˆê° ëª©í‘œ`
      });
    } else if (grossMarginChange > 2) {
      insights.push({
        title: 'ë§¤ì¶œì´ì´ìµë¥  ê°œì„ ',
        desc: `${grossMarginCurr.toFixed(1)}%ë¡œ ${grossMarginChange.toFixed(1)}%p ìƒìŠ¹. ì›ê°€ ê´€ë¦¬ ë° ì œí’ˆë¯¹ìŠ¤ ìµœì í™” íš¨ê³¼`
      });
    }
    
    // íšŒì „ìœ¨ ì¸ì‚¬ì´íŠ¸
    if (inventoryDays > 0 && inventoryDays < 1000 && inventoryDays > 120) {
      risks.push({
        title: 'ì¬ê³ íšŒì „ìœ¨ ì €í•˜',
        desc: `ì¬ê³ íšŒì „ì¼ìˆ˜ ${Math.round(inventoryDays)}ì¼. ì¬ê³  ì ì²´ë¡œ ì¸í•œ í˜„ê¸ˆíë¦„ ì•…í™” ë° í‰ê°€ì†ì‹¤ ë¦¬ìŠ¤í¬`
      });
    } else if (inventoryDays > 0 && inventoryDays < 60) {
      insights.push({
        title: 'ì¬ê³  íš¨ìœ¨ì„± ìš°ìˆ˜',
        desc: `ì¬ê³ íšŒì „ì¼ìˆ˜ ${Math.round(inventoryDays)}ì¼. ë¹ ë¥¸ ì¬ê³  íšŒì „ìœ¼ë¡œ ìš´ì „ìë³¸ íš¨ìœ¨ ê·¹ëŒ€í™”`
      });
    }
    
    if (arDays > 0 && arDays < 1000 && arDays > 60) {
      risks.push({
        title: 'ë§¤ì¶œì±„ê¶Œ íšŒìˆ˜ ì§€ì—°',
        desc: `íšŒìˆ˜ê¸°ê°„ ${Math.round(arDays)}ì¼. í˜„ê¸ˆíë¦„ ì••ë°• ë° ëŒ€ì† ë¦¬ìŠ¤í¬ ì¦ê°€`
      });
      actions.push({
        title: 'ì±„ê¶Œ ê´€ë¦¬ ê°•í™”',
        desc: `ê±°ë˜ì²˜ ì‹ ìš©í‰ê°€ ê°•í™”, ì¡°ê¸° íšŒìˆ˜ ì¸ì„¼í‹°ë¸Œ, íŒ©í† ë§ í™œìš©ìœ¼ë¡œ íšŒìˆ˜ê¸°ê°„ 45ì¼ ëª©í‘œ`
      });
    }
    
    if (cashConversionCycle > 0 && cashConversionCycle < 1000 && cashConversionCycle > 90) {
      risks.push({
        title: 'í˜„ê¸ˆìˆœí™˜ì£¼ê¸° ì¥ê¸°í™”',
        desc: `${Math.round(cashConversionCycle)}ì¼ ì†Œìš”. ìš´ì „ìë³¸ ë¶€ë‹´ ë° ìê¸ˆ íš¨ìœ¨ ì €í•˜`
      });
    }
    
    // ë²•ì¸ë³„ ìˆ˜ìµì„± ë¶„ì„ (ìƒì„¸)
    const topProfitEntity = entityProfitability.length > 0 ? entityProfitability[0] : null;
    const lowProfitEntity = entityProfitability.find(e => e.margin < 15 && e.sales > 50000);
    
    // ìµœê³  ìˆ˜ìµì„± ë²•ì¸
    if (topProfitEntity && topProfitEntity.margin > 25) {
      insights.push({
        title: `${topProfitEntity.entity} ìˆ˜ìµì„± ìš°ìˆ˜`,
        desc: `ì˜ì—…ì´ìµë¥  ${topProfitEntity.margin.toFixed(1)}%, ROE ${topProfitEntity.roe.toFixed(1)}%, ë§¤ì¶œ ${Math.round(topProfitEntity.sales/100)}ì–µì›. ì„±ê³µ ëª¨ë¸ë¡œ ë‹¤ë¥¸ ë²•ì¸ ë²¤ì¹˜ë§ˆí‚¹`
      });
    }
    
    // ë²•ì¸ë³„ ROE ë¶„ì„
    const entityROEAnalysis = entityProfitability
      .filter(e => e.equity > 0)
      .sort((a, b) => b.roe - a.roe);
    
    const topROEEntity = entityROEAnalysis.length > 0 ? entityROEAnalysis[0] : null;
    const lowROEEntity = entityROEAnalysis.find(e => e.roe < 10 && e.equity > 10000);
    
    if (topROEEntity && topROEEntity.roe > 15) {
      insights.push({
        title: `${topROEEntity.entity} ROE ìš°ìˆ˜`,
        desc: `ROE ${topROEEntity.roe.toFixed(1)}%, ìë³¸ íš¨ìœ¨ì„± ìµœê³ . ìë³¸ ë°°ë¶„ ìš°ì„ ìˆœìœ„ ê²€í† `
      });
    }
    
    if (lowROEEntity && topROEEntity && topROEEntity.roe > lowROEEntity.roe + 5) {
      risks.push({
        title: `${lowROEEntity.entity} ìë³¸ íš¨ìœ¨ì„± ì €í•˜`,
        desc: `ROE ${lowROEEntity.roe.toFixed(1)}% (${topROEEntity.entity}: ${topROEEntity.roe.toFixed(1)}%). ìë³¸ ëŒ€ë¹„ ìˆ˜ìµ ì°½ì¶œ ëŠ¥ë ¥ ê°œì„  í•„ìš”`
      });
      actions.push({
        title: `${lowROEEntity.entity} ROE ì œê³ `,
        desc: `ìˆ˜ìµì„± ê°œì„  ë˜ëŠ” ìë³¸ êµ¬ì¡° ìµœì í™”ë¡œ ROE ${(lowROEEntity.roe + 5).toFixed(1)}% ëª©í‘œ`
      });
    }
    
    // ì €ìˆ˜ìµ ë²•ì¸
    if (lowProfitEntity && topProfitEntity) {
      risks.push({
        title: `${lowProfitEntity.entity} ìˆ˜ìµì„± ì €í•˜`,
        desc: `ì˜ì—…ì´ìµë¥  ${lowProfitEntity.margin.toFixed(1)}%, ROE ${lowProfitEntity.roe.toFixed(1)}%, ë§¤ì¶œ ${Math.round(lowProfitEntity.sales/100)}ì–µì›. ${topProfitEntity.entity}(${topProfitEntity.margin.toFixed(1)}%)ì™€ ${Math.abs(lowProfitEntity.margin - topProfitEntity.margin).toFixed(1)}%p ê²©ì°¨`
      });
      actions.push({
        title: `${lowProfitEntity.entity} ìˆ˜ìµì„± ê°œì„ `,
        desc: `${topProfitEntity.entity} ì›ê°€êµ¬ì¡° ë²¤ì¹˜ë§ˆí‚¹, ë¹„íš¨ìœ¨ ë¹„ìš© 20% ì ˆê°, ê³ ë§ˆì§„ ì œí’ˆ ë¹„ì¤‘ í™•ëŒ€`
      });
    }
    
    // ë²•ì¸ë³„ ê·œëª¨ì™€ ìˆ˜ìµì„± ë¶ˆê· í˜•
    const totalSales = entityProfitability.reduce((sum, e) => sum + e.sales, 0);
    const totalOpIncome = entityProfitability.reduce((sum, e) => sum + e.opIncome, 0);
    const entityImbalance = entityProfitability.map(e => ({
      ...e,
      salesShare: totalSales > 0 ? (e.sales / totalSales * 100) : 0,
      profitShare: totalOpIncome > 0 ? (e.opIncome / totalOpIncome * 100) : 0
    })).filter(e => e.salesShare > 15 && e.profitShare < e.salesShare * 0.7);
    
    if (entityImbalance.length > 0) {
      const target = entityImbalance[0];
      risks.push({
        title: `${target.entity} ìˆ˜ìµ ê¸°ì—¬ë„ ë‚®ìŒ`,
        desc: `ë§¤ì¶œ ë¹„ì¤‘ ${target.salesShare.toFixed(0)}%ì§€ë§Œ ì´ìµ ê¸°ì—¬ ${target.profitShare.toFixed(0)}%. êµ¬ì¡°ì¡°ì • ë˜ëŠ” ìˆ˜ìµì„± ê°œì„  ì‹œê¸‰`
      });
    }
    
    // íŒê´€ë¹„ ë¶„ì„ (êµ¬ì²´í™”)
    const highSGA = sgaBreakdown.filter(x => x.change > 15 && x.salesRatio > 10);
    if (highSGA.length > 0) {
      const top = highSGA[0];
      risks.push({
        title: `${top.item} ê¸‰ì¦`,
        desc: `${Math.round(top.curr/100)}ì–µì›ìœ¼ë¡œ ì „ë…„ëŒ€ë¹„ ${top.change.toFixed(1)}% ì¦ê°€ (+${Math.round((top.curr-top.prev)/100)}ì–µì›), ë§¤ì¶œëŒ€ë¹„ ${top.salesRatio.toFixed(1)}%`
      });
      actions.push({
        title: `${top.item} ìµœì í™”`,
        desc: `${top.item === 'ê´‘ê³ ì„ ì „ë¹„' ? 'ë””ì§€í„¸ ë§ˆì¼€íŒ… ì „í™˜, ROI 2ë°° ê°œì„ ' : top.item === 'ì¸ê±´ë¹„' ? 'ì¸ë‹¹ ìƒì‚°ì„± 20% í–¥ìƒ, ì•„ì›ƒì†Œì‹± í™•ëŒ€' : 'ì—…ë¬´ í”„ë¡œì„¸ìŠ¤ ìë™í™”'}`
      });
      
      const targetReduction = top.curr * 0.15; // 15% ì ˆê° ì‹œ
      let roeImpact = 0;
      if (totalEquityCurr > 0) {
        roeImpact = (targetReduction*0.73 / totalEquityCurr * 100);
        if (!isFinite(roeImpact) || isNaN(roeImpact)) roeImpact = 0;
      }
      
      improvementTargets.push({
        area: `${top.item} êµ¬ì¡° í˜ì‹ `,
        current: `${Math.round(top.curr/100)}ì–µì› (ë§¤ì¶œëŒ€ë¹„ ${top.salesRatio.toFixed(1)}%, ì „ë…„ëŒ€ë¹„ +${top.change.toFixed(0)}%)`,
        target: `${Math.round(top.curr*0.85/100)}ì–µì› (ë§¤ì¶œëŒ€ë¹„ ${(top.salesRatio*0.85).toFixed(1)}%)`,
        impact: `ì˜ì—…ì´ìµ +${Math.round(targetReduction/100)}ì–µì› (+${(targetReduction/opIncomeCurr*100).toFixed(1)}%), ì˜ì—…ì´ìµë¥  +${(targetReduction/salesCurr*100).toFixed(1)}%p, ë‹¹ê¸°ìˆœì´ìµ +${Math.round(targetReduction*0.73/100)}ì–µì›, ROE +${roeImpact.toFixed(1)}%p`,
        method: top.item === 'ê´‘ê³ ì„ ì „ë¹„' 
          ? `ì„±ê³¼ ê¸°ë°˜ ì§‘í–‰ ì²´ê³„ (ë§¤ì¶œ ì „í™˜ìœ¨ ëª©í‘œ ë‹¬ì„± ì‹œ ì§‘í–‰), ë””ì§€í„¸ ê´‘ê³  ë¹„ì¤‘ 60%â†’80% í™•ëŒ€ (CPM 30% ì ˆê°), ëŒ€í–‰ì‚¬ ìˆ˜ìˆ˜ë£Œ ì¬í˜‘ìƒ`
          : top.item === 'ì¸ê±´ë¹„'
          ? `ì¸ë‹¹ ë§¤ì¶œì•¡ ëª©í‘œ 20% ìƒí–¥, RPAÂ·AI ë„ì…ìœ¼ë¡œ ë°˜ë³µì—…ë¬´ ìë™í™”, ì„±ê³¼ê¸‰ ë¹„ì¤‘ í™•ëŒ€ (ê³ ì •ê¸‰ ì–µì œ), ë¹„í•µì‹¬ ê¸°ëŠ¥ ì•„ì›ƒì†Œì‹±`
          : top.item === 'ìˆ˜ìˆ˜ë£Œ'
          ? `ë¬¼ë¥˜Â·ê²°ì œ ìˆ˜ìˆ˜ë£Œìœ¨ í˜‘ìƒ (ë³¼ë¥¨ ê¸°ë°˜ í• ì¸ í™•ë³´), ì§ë°°ì†¡ ë¹„ì¤‘ í™•ëŒ€, ìì²´ í’€í•„ë¨¼íŠ¸ ì„¼í„° êµ¬ì¶• ê²€í† `
          : `ë¹„ìš© í•­ëª©ë³„ ROI ë¶„ì„, ì œë¡œë² ì´ìŠ¤ ì˜ˆì‚° ë„ì…, ë¹„í•µì‹¬ ì§€ì¶œ 30% ê°ì¶•`
      });
    }
    
    // í˜„ê¸ˆ ë° ìœ ë™ì„± ë¶„ì„
    const cashRatio = totalAssetsCurr > 0 ? (cashCurr / totalAssetsCurr * 100) : 0;
    if (cashGrowth > 50) {
      insights.push({
        title: 'ìœ ë™ì„± ëŒ€í­ ê°œì„ ',
        desc: `í˜„ê¸ˆì„±ìì‚° ${Math.round(cashCurr/100)}ì–µì›ìœ¼ë¡œ ${cashGrowth.toFixed(0)}% ì¦ê°€ (ì „ë…„ +${Math.round((cashCurr-cashPrev)/100)}ì–µì›). ìì‚°ëŒ€ë¹„ ${cashRatio.toFixed(1)}%ë¡œ íˆ¬ì ì—¬ë ¥ í™•ë³´`
      });
      
      // ì‰ì—¬í˜„ê¸ˆì´ ë§ìœ¼ë©´ í™œìš© ë°©ì•ˆ ì œì‹œ
      if (cashCurr > totalAssetsCurr * 0.1) {
        actions.push({
          title: 'ì‰ì—¬í˜„ê¸ˆ ì „ëµì  í™œìš©',
          desc: `${Math.round(cashCurr*0.4/100)}ì–µì›ì„ M&A ë˜ëŠ” ì‹ ê·œ ë¸Œëœë“œì— íˆ¬ì ì‹œ ROE ${totalEquityCurr > 0 ? (cashCurr*0.4*0.15/totalEquityCurr*100).toFixed(1) : '0.0'}%p ì¶”ê°€ ê°œì„  ê°€ëŠ¥`
        });
        
        improvementTargets.push({
          area: 'ì‰ì—¬í˜„ê¸ˆ ì „ëµì  ì¬ë°°ì¹˜',
          current: `í˜„ê¸ˆì„±ìì‚° ${Math.round(cashCurr/100)}ì–µì› (ìì‚°ëŒ€ë¹„ ${cashRatio.toFixed(1)}%)`,
          target: `ì ì • í˜„ê¸ˆ ${Math.round(cashCurr*0.6/100)}ì–µì› ìœ ì§€ + ì „ëµíˆ¬ì ${Math.round(cashCurr*0.4/100)}ì–µì›`,
          impact: `ROE 15% íˆ¬ìì²˜ ë°œêµ´ ì‹œ ì—°ê²° ROE +${totalEquityCurr > 0 ? (cashCurr*0.4*0.15/totalEquityCurr*100).toFixed(1) : '0.0'}%p, ì£¼ì£¼ê°€ì¹˜ ì¦ëŒ€`,
          method: `ì˜µì…˜1: ê³ ìˆ˜ìµ ë¸Œëœë“œ M&A (ëª©í‘œ ROE 18%+), ì˜µì…˜2: ë°°ë‹¹ì„±í–¥ 30%â†’50% í™•ëŒ€ + ìì‚¬ì£¼ ë§¤ì… ${Math.round(cashCurr*0.15/100)}ì–µì›, ì˜µì…˜3: í•´ì™¸ ê±°ì  í™•ëŒ€ íˆ¬ì (ë™ë‚¨ì•„, ì¤‘ë™)`
        });
      }
    } else if (cashCurr < totalAssetsCurr * 0.05) {
      risks.push({
        title: 'ìœ ë™ì„± ë¶€ì¡±',
        desc: `í˜„ê¸ˆì„±ìì‚° ${Math.round(cashCurr/100)}ì–µì›, ìì‚°ëŒ€ë¹„ ${cashRatio.toFixed(1)}%. ë‹¨ê¸° ìê¸ˆ ì••ë°• ë¦¬ìŠ¤í¬`
      });
      actions.push({
        title: 'ìœ ë™ì„± í™•ë³´',
        desc: `ì¬ê³  ê°ì¶•, ë§¤ì¶œì±„ê¶Œ íŒ©í† ë§, ë‹¨ê¸° ì—¬ì‹  í•œë„ í™•ë³´ë¡œ ${Math.round(totalAssetsCurr*0.08/100)}ì–µì› í™•ë³´`
      });
    }
    
    // ìì‚° íš¨ìœ¨ì„± ë¶„ì„
    const assetTurnover = totalAssetsCurr > 0 ? (salesCurr / totalAssetsCurr) : 0;
    const assetTurnoverPrev = totalAssetsPrev > 0 ? (salesPrev / totalAssetsPrev) : 0;
    if (assetTurnover < 0.5 && assetTurnover < assetTurnoverPrev) {
      risks.push({
        title: 'ìì‚° íš¨ìœ¨ì„± ì €í•˜',
        desc: `ì´ìì‚°íšŒì „ìœ¨ ${assetTurnover.toFixed(2)}íšŒë¡œ ì „ë…„(${assetTurnoverPrev.toFixed(2)}íšŒ) ëŒ€ë¹„ í•˜ë½. ìì‚° ëŒ€ë¹„ ë§¤ì¶œ ì°½ì¶œë ¥ ê°ì†Œ`
      });
      actions.push({
        title: 'ìì‚° íš¨ìœ¨ ì œê³ ',
        desc: `ì €íš¨ìœ¨ ìì‚° ë§¤ê°, ìœ íœ´ ë¶€ë™ì‚° í™œìš©, ë¸Œëœë“œ ê°€ì¹˜ ê·¹ëŒ€í™”ë¡œ íšŒì „ìœ¨ ${(assetTurnover*1.2).toFixed(2)}íšŒ ëª©í‘œ`
      });
    } else if (assetTurnover > assetTurnoverPrev && assetTurnover > 0.6) {
      insights.push({
        title: 'ìì‚° íš¨ìœ¨ì„± ìš°ìˆ˜',
        desc: `ì´ìì‚°íšŒì „ìœ¨ ${assetTurnover.toFixed(2)}íšŒë¡œ ê°œì„ . íš¨ìœ¨ì  ìì‚° ìš´ìš©ìœ¼ë¡œ ìˆ˜ìµì„± ê·¹ëŒ€í™”`
      });
    }
    
    // ì¬ê³  ë¶„ì„
    if (inventoryGrowth > 30) {
      risks.push({
        title: 'ì¬ê³ ìì‚° ê¸‰ì¦',
        desc: `${Math.round(inventoryCurr/100)}ì–µì›ìœ¼ë¡œ ${inventoryGrowth.toFixed(0)}% ì¦ê°€. ì¬ê³ íšŒì „ìœ¨ ì•…í™” ë° í‰ê°€ì†ì‹¤ ë¦¬ìŠ¤í¬`
      });
      actions.push({
        title: 'ì¬ê³  íš¨ìœ¨í™”',
        desc: `ì‹œì¦Œ ì˜¤í”„ í”„ë¡œëª¨ì…˜ ê°•í™”, ë°œì£¼ ìµœì í™”, VMI ë„ì…ìœ¼ë¡œ ì¬ê³ íšŒì „ì¼ìˆ˜ 30ì¼ ë‹¨ì¶• ëª©í‘œ`
      });
    }
    
    // ì°¨ì…ê¸ˆ ë¶„ì„
    if (totalBorrowing > 100000 && borrowingsByEntity.length > 0) {
      const topDebtor = borrowingsByEntity[0];
      risks.push({
        title: `${topDebtor.entity} ì°¨ì…ê¸ˆ ë¶€ë‹´`,
        desc: `${Math.round(topDebtor.debt/100)}ì–µì› (ì „ì²´ ${(topDebtor.debt/totalBorrowing*100).toFixed(0)}%), ì´ìë¹„ìš© ë° í™˜ìœ„í—˜ ë…¸ì¶œ`
      });
      actions.push({
        title: 'ì°¨ì…ê¸ˆ ê°ì¶•',
        desc: `${topDebtor.entity} ì˜ì—…í˜„ê¸ˆ ì°½ì¶œ ê°•í™”, ìš´ì „ìë³¸ íš¨ìœ¨í™”ë¡œ ì—°ê°„ ${Math.round(topDebtor.debt*0.3/100)}ì–µì› ìƒí™˜ ëª©í‘œ`
      });
    }
    
    // ë¶€ì±„ë¹„ìœ¨ ë¶„ì„
    if (debtRatioCurr > 100) {
      risks.push({
        title: 'ë¶€ì±„ë¹„ìœ¨ ìœ„í—˜',
        desc: `${debtRatioCurr.toFixed(1)}%ë¡œ ìë³¸ ëŒ€ë¹„ ë¶€ì±„ ê³¼ë‹¤. ì¬ë¬´ ì•ˆì •ì„± ì•…í™” ë° ê¸ˆìœµë¹„ìš© ë¶€ë‹´ ì¦ê°€`
      });
      actions.push({
        title: 'ë¶€ì±„ë¹„ìœ¨ ê°œì„ ',
        desc: `ìê¸°ìë³¸ í™•ì¶© ë˜ëŠ” ë¶€ì±„ ìƒí™˜ìœ¼ë¡œ ë¶€ì±„ë¹„ìœ¨ 100% ì´í•˜ ëª©í‘œ. ì—°ê°„ ${Math.round(totalDebtCurr*0.2/100)}ì–µì› ìƒí™˜ ê³„íš`
      });
    } else if (debtRatioCurr > 50 && debtRatioCurr <= 100) {
      risks.push({
        title: 'ë¶€ì±„ë¹„ìœ¨ ì£¼ì˜',
        desc: `${debtRatioCurr.toFixed(1)}%ë¡œ ì ì • ìˆ˜ì¤€ì´ë‚˜ ì§€ì† ëª¨ë‹ˆí„°ë§ í•„ìš”`
      });
    } else if (debtRatioCurr > 0 && debtRatioCurr <= 50) {
      insights.push({
        title: 'ë¶€ì±„ë¹„ìœ¨ ì•ˆì •',
        desc: `${debtRatioCurr.toFixed(1)}%ë¡œ ì¬ë¬´ ì•ˆì •ì„± ì–‘í˜¸. ì ì • ìˆ˜ì¤€ì˜ ë ˆë²„ë¦¬ì§€ í™œìš©`
      });
    }
    
    // ROE ë¶„ì„
    if (roeChange < -3) {
      risks.push({
        title: 'ROE í•˜ë½',
        desc: `${roeCurr.toFixed(1)}%ë¡œ ${Math.abs(roeChange).toFixed(1)}%p í•˜ë½. ìë³¸ íš¨ìœ¨ì„± ì €í•˜`
      });
      actions.push({
        title: 'ROE ì œê³ ',
        desc: `ìˆœì´ìµë¥  ê°œì„  + ìì‚°íšŒì „ìœ¨ í–¥ìƒìœ¼ë¡œ ROE 15% ë‹¬ì„±. ì €íš¨ìœ¨ ìì‚° ë§¤ê° ê²€í† `
      });
    } else if (roeCurr > 15) {
      insights.push({
        title: 'ROE ìš°ìˆ˜',
        desc: `${roeCurr.toFixed(1)}%ë¡œ ìë³¸ íš¨ìœ¨ì„± ìš°ìˆ˜. ì£¼ì£¼ê°€ì¹˜ ì°½ì¶œ ëŠ¥ë ¥ ê°•í™”`
      });
    } else if (roeCurr > 0 && roeCurr < 10) {
      risks.push({
        title: 'ROE ê°œì„  í•„ìš”',
        desc: `${roeCurr.toFixed(1)}%ë¡œ ìë³¸ ëŒ€ë¹„ ìˆ˜ìµ ì°½ì¶œ ëŠ¥ë ¥ ì €ì¡°. ìˆ˜ìµì„± ë° ìì‚° íš¨ìœ¨ ê°œì„  í•„ìš”`
      });
    }
    
    // ìš´ì „ìë³¸ ë¶„ì„
    const wcSalesRatio = salesCurr > 0 ? (workingCapitalCurr / salesCurr * 100) : 0;
    if (wcSalesRatio > 50) {
      risks.push({
        title: 'ìš´ì „ìë³¸ ê³¼ë‹¤',
        desc: `${Math.round(workingCapitalCurr/100)}ì–µì›, ë§¤ì¶œëŒ€ë¹„ ${wcSalesRatio.toFixed(0)}%. ìê¸ˆ íš¨ìœ¨ ì €í•˜`
      });
      actions.push({
        title: 'ìš´ì „ìë³¸ ìµœì í™”',
        desc: `ë§¤ì¶œì±„ê¶Œ íšŒìˆ˜ê¸°ê°„ ë‹¨ì¶•, ì¬ê³  ê°ì¶•, ë§¤ì…ì±„ë¬´ ì¡°ê±´ ê°œì„ ìœ¼ë¡œ ${Math.round(workingCapitalCurr*0.2/100)}ì–µì› ì ˆê°`
      });
    }
    
    // ë§¤ì¶œ ì„±ì¥ ì¸ì‚¬ì´íŠ¸
    if (salesGrowth < -10) {
      risks.push({
        title: 'ë§¤ì¶œ ì—­ì„±ì¥',
        desc: `ì „ë…„ëŒ€ë¹„ ${Math.abs(salesGrowth).toFixed(1)}% ê°ì†Œ. ì‹œì¥ ì ìœ ìœ¨ í•˜ë½ ë° ìˆ˜ìš” ìœ„ì¶•`
      });
      actions.push({
        title: 'ë§¤ì¶œ íšŒë³µ',
        desc: `ì‹ ê·œ ì±„ë„ í™•ëŒ€, ì˜¨ë¼ì¸ ê°•í™”, í•´ì™¸ì‹œì¥ ê³µëµìœ¼ë¡œ ì—°ê°„ ${Math.abs(salesGrowth/2).toFixed(0)}% ì„±ì¥ë¥  íšŒë³µ ëª©í‘œ`
      });
    } else if (salesGrowth > 15) {
      insights.push({
        title: 'ë§¤ì¶œ ê³ ì„±ì¥',
        desc: `ì „ë…„ëŒ€ë¹„ ${salesGrowth.toFixed(1)}% ì¦ê°€. ì‹œì¥ ì ìœ ìœ¨ í™•ëŒ€ ë° ë¸Œëœë“œ ê²½ìŸë ¥ ê°•í™”`
      });
    }
    
    // 9) ì—°ê²°ê´€ì  ê°œì„  íƒ€ê²Ÿ ë¶„ì„
    // ìˆ˜ìµì„± ê°œì„  í¬í…ì…œì´ í° ì˜ì—­ íŒŒì•…
    
    // íƒ€ê²Ÿ 1: ì €ìˆ˜ìµ ê³ ë§¤ì¶œ ë²•ì¸ ìˆ˜ìµì„± ê°œì„ 
    const highSalesLowMargin = entityProfitability.filter(e => e.sales > 100000 && e.margin < 20);
    if (highSalesLowMargin.length > 0) {
      const target = highSalesLowMargin[0];
      const potentialIncrease = (target.sales * 0.05); // ì˜ì—…ì´ìµë¥  5%p ê°œì„  ì‹œ
      let roeImpact = 0;
      if (totalEquityCurr > 0) {
        roeImpact = (potentialIncrease / totalEquityCurr * 100);
        if (!isFinite(roeImpact) || isNaN(roeImpact)) roeImpact = 0;
      }
      improvementTargets.push({
        area: `${target.entity} ìˆ˜ìµì„± ì§‘ì¤‘ ê°œì„ `,
        current: `ì˜ì—…ì´ìµë¥  ${target.margin.toFixed(1)}%, ë§¤ì¶œ ${Math.round(target.sales/100)}ì–µì›`,
        target: `ì˜ì—…ì´ìµë¥  ${(target.margin + 5).toFixed(1)}% ë‹¬ì„±`,
        impact: `ì—°ê²° ì˜ì—…ì´ìµ +${Math.round(potentialIncrease/100)}ì–µì› (+${(potentialIncrease/opIncomeCurr*100).toFixed(1)}%), ì˜ì—…ì´ìµë¥  +${(potentialIncrease/salesCurr*100).toFixed(1)}%p, ROE +${roeImpact.toFixed(1)}%p`,
        method: `ì›ê°€ìœ¨ 2%p ì ˆê° (ì†Œì‹± ìµœì í™”, ë¡œìŠ¤ìœ¨ ê°ì†Œ), íŒê´€ë¹„ ë§¤ì¶œëŒ€ë¹„ 3%p ì ˆê° (ë§ˆì¼€íŒ… ROI ê°œì„ , ì¸ë ¥ íš¨ìœ¨í™”), ê³ ë§ˆì§„ ì œí’ˆ ë¹„ì¤‘ 20%â†’35% í™•ëŒ€`
      });
    }
    
    // íƒ€ê²Ÿ 2: ë§¤ì¶œì´ì´ìµë¥ ì´ ë‚®ì€ ê²½ìš° ì›ê°€ ê°œì„ 
    if (grossMarginCurr < 60) {
      const targetGrossMargin = 65;
      const potentialIncrease = salesCurr * (targetGrossMargin - grossMarginCurr) / 100;
      const roeImpact = totalEquityCurr > 0 ? (potentialIncrease * 0.7 / totalEquityCurr * 100) : 0; // ì„¸í›„ 70%
      improvementTargets.push({
        area: 'ì—°ê²° ë§¤ì¶œì´ì´ìµë¥  ì œê³ ',
        current: `ë§¤ì¶œì´ì´ìµë¥  ${grossMarginCurr.toFixed(1)}%`,
        target: `ë§¤ì¶œì´ì´ìµë¥  ${targetGrossMargin}% ë‹¬ì„±`,
        impact: `ë§¤ì¶œì´ì´ìµ +${Math.round(potentialIncrease/100)}ì–µì›, ì˜ì—…ì´ìµë¥  +${((potentialIncrease*0.8)/salesCurr*100).toFixed(1)}%p, ROE +${roeImpact.toFixed(1)}%p`,
        method: `ì¤‘êµ­ ì œì¡°ì›ê°€ 5% ì ˆê° (ìë™í™” íˆ¬ì, ë¶ˆëŸ‰ë¥  ê°ì†Œ), ë¬¼ë¥˜ë¹„ 10% ì ˆê° (ì§ë°°ì†¡ í™•ëŒ€), ê³ ë§ˆì§„ ë¼ì¸ ê°•í™” (MLB, ë””ìŠ¤ì»¤ë²„ë¦¬)`
      });
    }
    
    // íŒê´€ë¹„ íš¨ìœ¨í™” íƒ€ê²Ÿ
    const highSGAItem = sgaBreakdown.find(x => x.salesRatio > 12 && x.change > 5);
    if (highSGAItem) {
      const targetReduction = highSGAItem.curr * 0.15; // 15% ì ˆê° ì‹œ
      improvementTargets.push({
        area: `${highSGAItem.item} íš¨ìœ¨í™”`,
        current: `ë§¤ì¶œëŒ€ë¹„ ${highSGAItem.salesRatio.toFixed(1)}%`,
        target: `ë§¤ì¶œëŒ€ë¹„ ${(highSGAItem.salesRatio * 0.85).toFixed(1)}%`,
        impact: `ì—°ê²° ì˜ì—…ì´ìµ +${Math.round(targetReduction/100)}ì–µì› (+${(targetReduction/opIncomeCurr*100).toFixed(1)}%)`,
        method: 'ì§€ì¶œ ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤ ê°•í™”, ëŒ€í–‰ì‚¬ í†µí•©, ì„±ê³¼ ê¸°ë°˜ ì§‘í–‰'
      });
    }
    
    // ì¬ê³  íš¨ìœ¨í™” íƒ€ê²Ÿ
    if (inventoryGrowth > 20) {
      const targetReduction = inventoryCurr * 0.25; // 25% ê°ì¶• ì‹œ
      const interestSaving = targetReduction * 0.05; // ì—° 5% ì´ì ì ˆê°
      improvementTargets.push({
        area: 'ì¬ê³ ìì‚° ìµœì í™”',
        current: `${Math.round(inventoryCurr/100)}ì–µì› (ì „ë…„ëŒ€ë¹„ +${inventoryGrowth.toFixed(0)}%)`,
        target: `${Math.round(inventoryCurr*0.75/100)}ì–µì› (25% ê°ì¶•)`,
        impact: `ìš´ì „ìë³¸ ${Math.round(targetReduction/100)}ì–µì› ì ˆê°, ì´ìë¹„ìš© -${Math.round(interestSaving/100)}ì–µì›, ROE +${totalEquityCurr > 0 ? (interestSaving/totalEquityCurr*100).toFixed(1) : '0.0'}%p`,
        method: 'ì‹œì¦Œë³„ ì¬ê³  íšŒì „ìœ¨ ëª©í‘œ ê´€ë¦¬, í”„ë¡œëª¨ì…˜ íƒ€ì´ë° ìµœì í™”, ëŠë¦° ìƒí’ˆ ì¡°ê¸° í• ì¸'
      });
    }
    
    // ì°¨ì…ê¸ˆ ê°ì¶• íƒ€ê²Ÿ (êµ¬ì²´í™”)
    if (totalBorrowing > 100000 && borrowingsByEntity.length > 0) {
      const topDebtor = borrowingsByEntity[0];
      const targetReduction = totalBorrowing * 0.5; // 50% ê°ì¶• ì‹œ
      const interestRate = 0.045; // ì—° 4.5% ê°€ì •
      const interestSaving = targetReduction * interestRate; // ì—° ì´ì ì ˆê°
      const netIncomIncrease = interestSaving * 0.73; // ì„¸í›„ íš¨ê³¼ (ë²•ì¸ì„¸ìœ¨ 27%)
      let roeImpact = 0;
      if (totalEquityCurr > 0) {
        roeImpact = (netIncomIncrease / totalEquityCurr * 100);
        if (!isFinite(roeImpact) || isNaN(roeImpact)) roeImpact = 0;
      }
      
      improvementTargets.push({
        area: 'ì°¨ì…ê¸ˆ ì „ëµì  ê°ì¶•',
        current: `ì´ ${Math.round(totalBorrowing/100)}ì–µì› (${topDebtor.entity} ${Math.round(topDebtor.debt/100)}ì–µì›, ë¶€ì±„ë¹„ìœ¨ ${topDebtor.debtRatio.toFixed(0)}%)`,
        target: `${Math.round(totalBorrowing*0.5/100)}ì–µì›ìœ¼ë¡œ ê°ì¶• (${topDebtor.entity} ìš°ì„  ìƒí™˜)`,
        impact: `ì´ìë¹„ìš© -${Math.round(interestSaving/100)}ì–µì›/ë…„, ë‹¹ê¸°ìˆœì´ìµ +${Math.round(netIncomIncrease/100)}ì–µì›, ìˆœì´ìµë¥  +${(netIncomIncrease/salesCurr*100).toFixed(1)}%p, ROE +${roeImpact.toFixed(1)}%p, ë¶€ì±„ë¹„ìœ¨ ${totalEquityCurr > 0 ? (debtRatioCurr - totalBorrowing*0.5/totalEquityCurr*100).toFixed(0) : debtRatioCurr.toFixed(0)}%ë¡œ ê°œì„ `,
        method: `${topDebtor.entity} ì¬ê³  ê°ì¶•ìœ¼ë¡œ í˜„ê¸ˆ ${Math.round(topDebtor.debt*0.3/100)}ì–µì› í™•ë³´ + ì˜ì—…ì´ìµ ê°œì„  + ë³¸ì‚¬ ì—¬ìœ ìê¸ˆ ${Math.round(cashCurr*0.3/100)}ì–µì› ì§€ì› + ì €íš¨ìœ¨ ìì‚° ë§¤ê°`
      });
    }
    
    // ìš´ì „ìë³¸ íš¨ìœ¨í™” (êµ¬ì²´í™”)
    const wcTurnover = (salesCurr > 0 && workingCapitalCurr > 0) ? (salesCurr / workingCapitalCurr) : 0;
    if (wcTurnover > 0 && wcTurnover < 3 && workingCapitalCurr > 100000) {
      const targetWC = workingCapitalCurr * 0.7; // 30% ê°œì„  ì‹œ
      const freedCash = workingCapitalCurr - targetWC;
      const interestSaving = freedCash * 0.04; // ì—° 4% ì ˆê° íš¨ê³¼
      let roeImpact = 0;
      if (totalEquityCurr > 0) {
        roeImpact = (interestSaving*0.73 / totalEquityCurr * 100);
        if (!isFinite(roeImpact) || isNaN(roeImpact)) roeImpact = 0;
      }
      
      const arDaysStr = (arDays > 0 && arDays < 1000) ? `${Math.round(arDays)}â†’${Math.round(arDays*0.8)}ì¼` : 'ë‹¨ì¶•';
      const inventoryDaysStr = (inventoryDays > 0 && inventoryDays < 1000) ? `${Math.round(inventoryDays)}â†’${Math.round(inventoryDays*0.75)}ì¼` : 'ë‹¨ì¶•';
      const apDaysStr = (apDays > 0 && apDays < 1000) ? `${Math.round(apDays)}â†’${Math.round(apDays*1.1)}ì¼` : 'ê°œì„ ';
      const cccStr = (cashConversionCycle > 0 && cashConversionCycle < 1000) ? `${Math.round(cashConversionCycle)}ì¼` : '-';
      const targetCccStr = (cashConversionCycle > 0 && cashConversionCycle < 1000) ? `${Math.round(cashConversionCycle*0.7)}ì¼` : 'ê°œì„ ';
      
      improvementTargets.push({
        area: 'ìš´ì „ìë³¸ ìˆœí™˜ íš¨ìœ¨í™”',
        current: `${Math.round(workingCapitalCurr/100)}ì–µì› (íšŒì „ìœ¨ ${wcTurnover.toFixed(1)}íšŒ, CCC ${cccStr})`,
        target: `${Math.round(targetWC/100)}ì–µì› (íšŒì „ìœ¨ ${(wcTurnover*1.43).toFixed(1)}íšŒ, CCC ${targetCccStr})`,
        impact: `í˜„ê¸ˆ ${Math.round(freedCash/100)}ì–µì› í™•ë³´, ê¸ˆìœµë¹„ìš© -${Math.round(interestSaving/100)}ì–µì›/ë…„, ìœ ë™ë¹„ìœ¨ ê°œì„ , ROE +${roeImpact.toFixed(1)}%p`,
        method: `ë§¤ì¶œì±„ê¶Œ: íšŒìˆ˜ê¸°ê°„ ${arDaysStr} (ì¡°ê¸°ê²°ì œ í• ì¸, ì‹ ìš©ê´€ë¦¬), ì¬ê³ : íšŒì „ì¼ìˆ˜ ${inventoryDaysStr} (ì¬ê³  KPI ê°•í™”), ë§¤ì…ì±„ë¬´: ${apDaysStr} (ì§€ê¸‰ì¡°ê±´ í˜‘ìƒ)`
      });
    }
    
    // íƒ€ê²Ÿ 3: ë²•ì¸ë³„ ë¶ˆê· í˜• í•´ì†Œ
    if (entityImbalance.length > 0 && entityProfitability.length > 0) {
      const target = entityImbalance[0];
      const profitGap = target.salesShare - target.profitShare;
      const potentialIncrease = opIncomeCurr * (profitGap / 100);
      const targetMargin = totalOpIncome > 0 ? (totalOpIncome / totalSales * 100) : 0;
      
      improvementTargets.push({
        area: `${target.entity} ìˆ˜ìµêµ¬ì¡° ì •ìƒí™”`,
        current: `ë§¤ì¶œë¹„ì¤‘ ${target.salesShare.toFixed(0)}% vs ì´ìµë¹„ì¤‘ ${target.profitShare.toFixed(0)}% (${profitGap.toFixed(0)}%p ê´´ë¦¬)`,
        target: `ì´ìµ ê¸°ì—¬ë„ë¥¼ ë§¤ì¶œ ë¹„ì¤‘ ìˆ˜ì¤€ìœ¼ë¡œ ê°œì„  (ì˜ì—…ì´ìµë¥  ${target.margin.toFixed(1)}%â†’${targetMargin.toFixed(1)}%)`,
        impact: `ì—°ê²° ì˜ì—…ì´ìµ +${Math.round(potentialIncrease/100)}ì–µì›, ì˜ì—…ì´ìµë¥  +${(potentialIncrease/salesCurr*100).toFixed(1)}%p, ROE +${totalEquityCurr > 0 ? (potentialIncrease*0.73/totalEquityCurr*100).toFixed(1) : '0.0'}%p`,
        method: `ì €ë§ˆì§„ ì œí’ˆ ë‹¨ì¢…/ê°€ê²© ì¸ìƒ, ê³ ë§ˆì§„ ë²•ì¸(${entityProfitability[0].entity})ì˜ ìš´ì˜ ë…¸í•˜ìš° ì´ì „, ê³ ì •ë¹„ êµ¬ì¡°ì¡°ì •, ë¸Œëœë“œ í¬íŠ¸í´ë¦¬ì˜¤ ì¬í¸`
      });
    }
    
    // ìš°ì„ ìˆœìœ„ ì •ë ¬ (ì˜í–¥ë„ í° ìˆœ)
    return {
      keyMetrics: {
        opMargin: { curr: opMarginCurr, prev: opMarginPrev, change: opMarginChange },
        netMargin: { curr: netMarginCurr, prev: netMarginPrev, change: netMarginChange },
        debtRatio: { curr: debtRatioCurr, prev: debtRatioPrev, status: debtRatioCurr < 100 ? 'ì•ˆì •' : 'ì£¼ì˜' },
        roe: { curr: roeCurr, prev: roePrev, change: roeChange }
      },
      insights: insights.slice(0, 3),
      risks: risks.slice(0, 3),
      actions: actions.slice(0, 3),
      improvementTargets: improvementTargets.slice(0, 4) // ìƒìœ„ 4ê°œ ê°œì„  íƒ€ê²Ÿ
    };
  };

  // ============================================
  // ì „ì²´ìš”ì•½ íƒ­ ë Œë”ë§
  // ============================================
  const renderSummaryTab = () => {
    // ì†ìµ ìš”ì•½ ì¹´ë“œ ë°ì´í„° (ì–µì› ë‹¨ìœ„, ì„ íƒëœ ë¶„ê¸°ê¹Œì§€ ëˆ„ì  ê¸°ì¤€)
    const selectedYearKey = getPeriodKey(selectedPeriod, 'year');
    const prevYearKey = getPeriodKey(selectedPeriod, 'prev_year') || '2024_Year';
    
    // ë§¤ì¶œì•¡ (ë¹„ìœ¨ ê³„ì‚°ìš©)
    const salesCurr = incomeStatementData[selectedYearKey]?.ë§¤ì¶œì•¡ || 0;
    const salesPrev = incomeStatementData[prevYearKey]?.ë§¤ì¶œì•¡ || 0;
    
    // ë§¤ì¶œì´ì´ìµ ë° ë§¤ì¶œì´ì´ìµë¥ 
    const grossProfitCurr = incomeStatementData[selectedYearKey]?.ë§¤ì¶œì´ì´ìµ || 0;
    const grossProfitPrev = incomeStatementData[prevYearKey]?.ë§¤ì¶œì´ì´ìµ || 0;
    const grossMarginCurr = salesCurr !== 0 ? (grossProfitCurr / salesCurr * 100) : 0;
    const grossMarginPrev = salesPrev !== 0 ? (grossProfitPrev / salesPrev * 100) : 0;
    
    // ì˜ì—…ì´ìµ ë° ì˜ì—…ì´ìµë¥ 
    const operatingIncomeCurr = incomeStatementData[selectedYearKey]?.ì˜ì—…ì´ìµ || 0;
    const operatingIncomePrev = incomeStatementData[prevYearKey]?.ì˜ì—…ì´ìµ || 0;
    const operatingMarginCurr = salesCurr !== 0 ? (operatingIncomeCurr / salesCurr * 100) : 0;
    const operatingMarginPrev = salesPrev !== 0 ? (operatingIncomePrev / salesPrev * 100) : 0;
    
    // ë‹¹ê¸°ìˆœì´ìµ ë° ë‹¹ê¸°ìˆœì´ìµë¥ 
    const netIncomeCurr = incomeStatementData[selectedYearKey]?.ë‹¹ê¸°ìˆœì´ìµ || 0;
    const netIncomePrev = incomeStatementData[prevYearKey]?.ë‹¹ê¸°ìˆœì´ìµ || 0;
    const netMarginCurr = salesCurr !== 0 ? (netIncomeCurr / salesCurr * 100) : 0;
    const netMarginPrev = salesPrev !== 0 ? (netIncomePrev / salesPrev * 100) : 0;
    
    const incomeCards = [
      { 
        title: 'ë§¤ì¶œì•¡', 
        value: Math.round(salesCurr / 100), 
        prevValue: Math.round(salesPrev / 100), 
        iconColor: 'bg-blue-500',
        hasRate: false
      },
      { 
        title: 'ë§¤ì¶œì´ì´ìµ', 
        value: Math.round(grossProfitCurr / 100), 
        prevValue: Math.round(grossProfitPrev / 100), 
        iconColor: 'bg-blue-500',
        hasRate: true,
        rateLabel: 'ë§¤ì¶œì´ì´ìµë¥ ',
        rateCurr: grossMarginCurr,
        ratePrev: grossMarginPrev
      },
      { 
        title: 'ì˜ì—…ì´ìµ', 
        value: Math.round(operatingIncomeCurr / 100), 
        prevValue: Math.round(operatingIncomePrev / 100), 
        iconColor: 'bg-emerald-500',
        hasRate: true,
        rateLabel: 'ì˜ì—…ì´ìµë¥ ',
        rateCurr: operatingMarginCurr,
        ratePrev: operatingMarginPrev
      },
      { 
        title: 'ë‹¹ê¸°ìˆœì´ìµ', 
        value: Math.round(netIncomeCurr / 100), 
        prevValue: Math.round(netIncomePrev / 100), 
        iconColor: 'bg-violet-500',
        hasRate: true,
        rateLabel: 'ë‹¹ê¸°ìˆœì´ìµë¥ ',
        rateCurr: netMarginCurr,
        ratePrev: netMarginPrev
      },
    ];

    // ì¬ë¬´ìƒíƒœ ìš”ì•½ ì¹´ë“œ ë°ì´í„° (ì–µì› ë‹¨ìœ„, ì„ íƒëœ ë¶„ê¸° ê¸°ë§ ê¸°ì¤€)
    const balanceCards = [
      { title: 'ìì‚°ì´ê³„', value: Math.round((balanceSheetData[bsCurrentPeriod]?.ìì‚°ì´ê³„ || 0) / 100), prevValue: Math.round((balanceSheetData[bsPrevPeriod]?.ìì‚°ì´ê³„ || 0) / 100), iconColor: 'bg-amber-500', hasRate: false },
      { title: 'ë¶€ì±„ì´ê³„', value: Math.round((balanceSheetData[bsCurrentPeriod]?.ë¶€ì±„ì´ê³„ || 0) / 100), prevValue: Math.round((balanceSheetData[bsPrevPeriod]?.ë¶€ì±„ì´ê³„ || 0) / 100), iconColor: 'bg-rose-500', hasRate: false },
      { title: 'ìë³¸ì´ê³„', value: Math.round((balanceSheetData[bsCurrentPeriod]?.ìë³¸ì´ê³„ || 0) / 100), prevValue: Math.round((balanceSheetData[bsPrevPeriod]?.ìë³¸ì´ê³„ || 0) / 100), iconColor: 'bg-cyan-500', hasRate: false },
    ];

    // ì¡°ë‹¨ìœ„ í¬ë§· í•¨ìˆ˜ (ì–µì› ë‹¨ìœ„ ì…ë ¥) - ìˆ«ìì™€ ë‹¨ìœ„ ë¶„ë¦¬ ë°˜í™˜
    const formatTrilBilSummary = (valueInBil) => {
      if (valueInBil === 0 || valueInBil === undefined || valueInBil === null) return { number: '-', unit: '' };
      const absValue = Math.abs(valueInBil);
      const sign = valueInBil < 0 ? '-' : '';
      
      if (absValue >= 10000) {
        const tril = Math.floor(absValue / 10000);
        const bil = Math.round(absValue % 10000);
        return { number: `${sign}${tril}ì¡° ${formatNumber(bil)}`, unit: 'ì–µì›' };
      }
      return { number: `${sign}${formatNumber(Math.round(absValue))}`, unit: 'ì–µì›' };
    };

    // ì¹´ë“œ ë Œë”ë§ í•¨ìˆ˜
    const renderCard = (card, idx) => {
      const change = card.prevValue !== 0 
        ? ((card.value - card.prevValue) / Math.abs(card.prevValue) * 100).toFixed(1) 
        : 0;
      const isPositive = parseFloat(change) >= 0;
      const formatted = formatTrilBilSummary(card.value);
      const formattedPrev = formatTrilBilSummary(card.prevValue);
      const diff = card.value - card.prevValue;
      const formattedDiff = formatTrilBilSummary(diff);
      
      // ë¹„ìœ¨ ì¦ê° ê³„ì‚°
      let rateDiff = null;
      if (card.hasRate && card.rateCurr !== undefined && card.ratePrev !== undefined) {
        rateDiff = (card.rateCurr - card.ratePrev).toFixed(1);
      }
      
      return (
        <div key={idx} className="bg-white rounded-lg border border-zinc-200 shadow-sm p-4 hover:shadow-md transition-shadow duration-200">
          {/* í—¤ë”: ì œëª©ê³¼ ì¦ê°ë¥  ë°•ìŠ¤ */}
          <div className="flex items-center justify-between mb-3">
            <span className="text-xs font-medium text-zinc-500 uppercase tracking-wide">{card.title}</span>
            <span className={`text-xs font-semibold px-2 py-0.5 rounded ${
              isPositive ? 'bg-emerald-50 text-emerald-600' : 'bg-rose-50 text-rose-600'
            }`}>
              {change != 0 ? `${isPositive ? '+' : ''}${change}%` : '-'}
            </span>
          </div>
          
          {/* ë‹¹ë…„ ìˆ˜ì¹˜ */}
          <div className="flex items-baseline gap-1 mb-3">
            <span className="text-2xl font-bold text-zinc-900">{formatted.number}</span>
            <span className="text-sm font-normal text-zinc-400">{formatted.unit}</span>
          </div>
          
          {/* ì „ë…„ ìˆ˜ì¹˜ ë° ì°¨ì•¡ (í•œ ì¤„) */}
          <div className="text-xs text-zinc-600 mb-3">
            ì „ë…„ {formattedPrev.number.replace('ì–µì›', 'ì–µ')}ì–µì›
            {diff !== 0 && (
              <span className={`ml-1 font-medium ${diff >= 0 ? 'text-emerald-600' : 'text-rose-600'}`}>
                {diff >= 0 ? '+' : ''}{formattedDiff.number.replace('ì–µì›', 'ì–µ')}ì–µì›
              </span>
            )}
          </div>
          
          {/* ë¹„ìœ¨ (ì˜ì—…ì´ìµë¥ , ë‹¹ê¸°ìˆœì´ìµë¥ ) */}
          {card.hasRate && card.rateCurr !== undefined && (
            <div className="pt-3 border-t border-zinc-100">
              <div className="flex items-center justify-between text-xs">
                <span className="text-zinc-400">{card.rateLabel}</span>
                <div className="flex items-center gap-1.5">
                  <span className="text-zinc-900 font-semibold">{card.rateCurr.toFixed(1)}%</span>
                  {rateDiff !== null && parseFloat(rateDiff) !== 0 && (
                    <span className={`text-xs font-medium ${parseFloat(rateDiff) >= 0 ? 'text-emerald-600' : 'text-rose-600'}`}>
                      {parseFloat(rateDiff) >= 0 ? '+' : ''}{rateDiff}%p
                    </span>
                  )}
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    return (
      <div className="space-y-4">
        {/* ì†ìµ ìš”ì•½ ì„¹ì…˜ */}
        <div>
          <h3 className="text-sm font-semibold text-zinc-700 mb-2 flex items-center gap-2">
            <span className="w-1 h-4 bg-blue-500 rounded"></span>
            ì†ìµ ìš”ì•½
          </h3>
          <div className="grid grid-cols-4 gap-3">
            {incomeCards.map((card, idx) => renderCard(card, idx))}
          </div>
        </div>

        {/* ì¬ë¬´ìƒíƒœ ìš”ì•½ ì„¹ì…˜ */}
        <div>
          <h3 className="text-sm font-semibold text-zinc-700 mb-2 flex items-center gap-2">
            <span className="w-1 h-4 bg-amber-500 rounded"></span>
            ì¬ë¬´ìƒíƒœ ìš”ì•½
          </h3>
          <div className="grid grid-cols-3 gap-3">
            {balanceCards.map((card, idx) => renderCard(card, idx))}
          </div>
        </div>

        {/* AI ë¶„ì„ ì„¹ì…˜ */}
        <div>
          <h3 className="text-sm font-semibold text-zinc-700 mb-2 flex items-center gap-2">
            <span className="w-1 h-4 bg-gradient-to-b from-blue-500 to-violet-500 rounded"></span>
            AI ë¶„ì„
          </h3>
          <div className="bg-gradient-to-br from-zinc-900 to-zinc-800 rounded-lg p-5 text-white shadow-lg">
            {(() => {
              try {
                const analysis = generateAIAnalysis();
                if (!analysis || !analysis.keyMetrics) {
                  return <div className="text-xs text-zinc-400">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
                }
                const { keyMetrics, insights = [], risks = [], actions = [], improvementTargets = [] } = analysis;
              
              return (
                <>
                  <div className="flex items-center gap-2 mb-4">
                    <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-500 to-violet-500 flex items-center justify-center shadow-md">
                      <span className="text-white text-xs font-bold">AI</span>
                    </div>
                    <div>
                      <div className="text-sm font-semibold">F&F {selectedPeriod ? selectedPeriod.split('_')[0] : '2025'}ë…„ ì¬ë¬´ ì¢…í•© ë¶„ì„</div>
                      <div className="text-xs text-zinc-400">ìˆ˜ìµì„± Â· ì•ˆì •ì„± Â· ë¦¬ìŠ¤í¬ Â· ì•¡ì…˜í”Œëœ</div>
                    </div>
                  </div>
                  
                  {/* í•µì‹¬ ì§€í‘œ ìš”ì•½ (ë™ì ) */}
                  <div className="grid grid-cols-4 gap-2 mb-4 p-3 bg-white/5 rounded-lg border border-white/10">
                    <div className="text-center">
                      <div className="text-[10px] text-zinc-400 mb-0.5">ì˜ì—…ì´ìµë¥ </div>
                      <div className={`text-sm font-bold ${keyMetrics.opMargin.change >= 0 ? 'text-emerald-400' : 'text-amber-400'}`}>
                        {keyMetrics.opMargin.curr.toFixed(1)}%
                      </div>
                      <div className={`text-[10px] ${keyMetrics.opMargin.change >= 0 ? 'text-emerald-400' : 'text-rose-400'}`}>
                        {keyMetrics.opMargin.change >= 0 ? '+' : ''}{keyMetrics.opMargin.change.toFixed(1)}%p
                      </div>
                    </div>
                    <div className="text-center border-l border-white/10">
                      <div className="text-[10px] text-zinc-400 mb-0.5">ìˆœì´ìµë¥ </div>
                      <div className={`text-sm font-bold ${keyMetrics.netMargin.change >= 0 ? 'text-emerald-400' : 'text-blue-400'}`}>
                        {keyMetrics.netMargin.curr.toFixed(1)}%
                      </div>
                      <div className={`text-[10px] ${keyMetrics.netMargin.change >= 0 ? 'text-emerald-400' : 'text-rose-400'}`}>
                        {keyMetrics.netMargin.change >= 0 ? '+' : ''}{keyMetrics.netMargin.change.toFixed(1)}%p
                      </div>
                    </div>
                    <div className="text-center border-l border-white/10">
                      <div className="text-[10px] text-zinc-400 mb-0.5">ë¶€ì±„ë¹„ìœ¨</div>
                      <div className={`text-sm font-bold ${keyMetrics.debtRatio.curr < 100 ? 'text-emerald-400' : 'text-amber-400'}`}>
                        {keyMetrics.debtRatio.curr.toFixed(1)}%
                      </div>
                      <div className="text-[10px] text-emerald-400">{keyMetrics.debtRatio.status}</div>
                    </div>
                    <div className="text-center border-l border-white/10">
                      <div className="text-[10px] text-zinc-400 mb-0.5">ROE</div>
                      <div className={`text-sm font-bold ${keyMetrics.roe.change >= 0 ? 'text-emerald-400' : 'text-violet-400'}`}>
                        {keyMetrics.roe.curr.toFixed(1)}%
                      </div>
                      <div className={`text-[10px] ${keyMetrics.roe.change >= 0 ? 'text-emerald-400' : 'text-rose-400'}`}>
                        {keyMetrics.roe.change >= 0 ? '+' : ''}{keyMetrics.roe.change.toFixed(1)}%p
                      </div>
                    </div>
                  </div>

                  <div className="grid grid-cols-2 gap-3 mb-4">
                    {/* ì£¼ìš” ì¸ì‚¬ì´íŠ¸ (ë™ì ) */}
                    <div className="p-3 bg-white/5 rounded-lg border border-white/10">
                      <div className="flex items-center gap-2 mb-2">
                        <span className="w-2 h-2 rounded-full bg-emerald-400"></span>
                        <span className="text-xs font-semibold text-emerald-400">ì£¼ìš” ì¸ì‚¬ì´íŠ¸</span>
                      </div>
                      {insights.length > 0 ? (
                        <ul className="text-xs text-zinc-300 space-y-1.5">
                          {insights.map((insight, idx) => (
                            <li key={idx} className="flex items-start gap-1.5">
                              <span className="text-emerald-400 mt-0.5">â€¢</span>
                              <span><strong className="text-white">{insight.title}:</strong> {insight.desc}</span>
                            </li>
                          ))}
                        </ul>
                      ) : (
                        <p className="text-xs text-zinc-400 italic">ê¸ì •ì  ì¸ì‚¬ì´íŠ¸ë¥¼ ë°œê²¬í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>
                      )}
                    </div>

                    {/* ë¦¬ìŠ¤í¬ ë¶„ì„ (ë™ì ) */}
                    <div className="p-3 bg-white/5 rounded-lg border border-white/10">
                      <div className="flex items-center gap-2 mb-2">
                        <span className="w-2 h-2 rounded-full bg-rose-400"></span>
                        <span className="text-xs font-semibold text-rose-400">ë¦¬ìŠ¤í¬ ë¶„ì„</span>
                      </div>
                      {risks.length > 0 ? (
                        <ul className="text-xs text-zinc-300 space-y-1.5">
                          {risks.map((risk, idx) => (
                            <li key={idx} className="flex items-start gap-1.5">
                              <span className="text-rose-400 mt-0.5">âš </span>
                              <span><strong className="text-white">{risk.title}:</strong> {risk.desc}</span>
                            </li>
                          ))}
                        </ul>
                      ) : (
                        <p className="text-xs text-zinc-400 italic">ì£¼ìš” ë¦¬ìŠ¤í¬ê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
                      )}
                    </div>
                  </div>

                  {/* ì•¡ì…˜ í”Œëœ (ë™ì ) */}
                  <div className="p-3 bg-gradient-to-r from-blue-500/20 to-violet-500/20 rounded-lg border border-blue-400/30 mb-3">
                    <div className="flex items-center gap-2 mb-2">
                      <span className="w-2 h-2 rounded-full bg-violet-400"></span>
                      <span className="text-sm font-semibold text-violet-400">ì „ëµì  ì•¡ì…˜ í”Œëœ</span>
                    </div>
                    {actions.length > 0 ? (
                      <div className="grid grid-cols-3 gap-3">
                        {actions.map((action, idx) => (
                          <div key={idx} className="p-2 bg-white/5 rounded">
                            <div className="flex items-center gap-1.5 mb-1">
                              <span className="text-blue-400 text-base">
                                {idx === 0 ? 'ğŸ¯' : idx === 1 ? 'âš¡' : 'ğŸ’¡'}
                              </span>
                              <span className="text-sm font-semibold text-blue-400">{action.title}</span>
                            </div>
                            <p className="text-xs text-zinc-300 leading-relaxed">
                              {action.desc}
                            </p>
                          </div>
                        ))}
                      </div>
                    ) : (
                      <p className="text-sm text-zinc-400 italic">ì „ëµì  ì•¡ì…˜ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                    )}
                  </div>

                  {/* ì—°ê²°ê´€ì  ê°œì„  íƒ€ê²Ÿ (ì‹ ê·œ) */}
                  {improvementTargets && improvementTargets.length > 0 && (
                    <div className="p-4 bg-gradient-to-br from-violet-500/10 to-blue-500/10 rounded-lg border border-violet-400/20">
                      <div className="flex items-center gap-2 mb-3">
                        <span className="w-2 h-2 rounded-full bg-violet-400"></span>
                        <span className="text-sm font-semibold text-violet-400">ì—°ê²°ê´€ì  ìˆ˜ìµì„±Â·ì•ˆì •ì„± ê°œì„  íƒ€ê²Ÿ</span>
                        <span className="text-xs text-zinc-400 ml-auto">ìš°ì„ ìˆœìœ„ ìˆœ</span>
                      </div>
                      <div className="space-y-2.5">
                        {improvementTargets.map((target, idx) => (
                          <div key={idx} className="p-3 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition-all">
                            <div className="flex items-start gap-2 mb-2">
                              <div className="flex-shrink-0 w-6 h-6 rounded bg-gradient-to-br from-violet-500 to-blue-500 flex items-center justify-center text-white text-xs font-bold">
                                {idx + 1}
                              </div>
                              <div className="flex-1">
                                <div className="text-sm font-semibold text-white mb-1">{target.area}</div>
                                <div className="grid grid-cols-2 gap-2 text-xs mb-2">
                                  <div className="p-1.5 bg-white/5 rounded">
                                    <span className="text-zinc-400">í˜„ì¬: </span>
                                    <span className="text-zinc-200">{target.current}</span>
                                  </div>
                                  <div className="p-1.5 bg-white/5 rounded">
                                    <span className="text-zinc-400">ëª©í‘œ: </span>
                                    <span className="text-emerald-400 font-semibold">{target.target}</span>
                                  </div>
                                </div>
                                <div className="p-2 bg-gradient-to-r from-emerald-500/10 to-blue-500/10 rounded border border-emerald-400/20 mb-1.5">
                                  <div className="text-xs text-emerald-400 font-semibold mb-0.5">ğŸ“Š ì˜ˆìƒ íš¨ê³¼</div>
                                  <div className="text-xs text-zinc-200">{target.impact}</div>
                                </div>
                                <div className="p-2 bg-white/5 rounded">
                                  <div className="text-xs text-blue-400 font-semibold mb-0.5">ğŸ”§ ì‹¤í–‰ ë°©ì•ˆ</div>
                                  <div className="text-xs text-zinc-300 leading-relaxed">{target.method}</div>
                                </div>
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                      
                      {/* ì¢…í•© ê°œì„  íš¨ê³¼ */}
                      {improvementTargets.length > 1 && (() => {
                        // ì „ì²´ ê°œì„  íš¨ê³¼ ê³„ì‚°
                        const totalOpIncomeIncrease = improvementTargets.reduce((sum, t) => {
                          const match = t.impact.match(/ì˜ì—…ì´ìµ \+(\d+)ì–µì›/);
                          return sum + (match ? parseInt(match[1]) : 0);
                        }, 0);
                        const totalRoeIncrease = improvementTargets.reduce((sum, t) => {
                          const match = t.impact.match(/ROE \+(\d+\.?\d*)%p/);
                          return sum + (match ? parseFloat(match[1]) : 0);
                        }, 0);
                        const currentOpMargin = keyMetrics.opMargin.curr;
                        const currentRoe = keyMetrics.roe.curr;
                        const targetOpMargin = currentOpMargin + (totalOpIncomeIncrease * 100 / (incomeStatementData[getPeriodKey(selectedPeriod, 'year')]?.ë§¤ì¶œì•¡ || 1));
                        const targetRoe = currentRoe + totalRoeIncrease;
                        
                        return (
                          <div className="mt-3 p-3 bg-gradient-to-r from-emerald-500/20 to-blue-500/20 rounded-lg border border-emerald-400/30">
                            <div className="flex items-center gap-2 mb-2">
                              <span className="text-emerald-400 text-base">âœ¨</span>
                              <span className="text-sm font-semibold text-emerald-400">ì „ì²´ ì‹¤í–‰ ì‹œ ì˜ˆìƒ íš¨ê³¼</span>
                            </div>
                            <div className="grid grid-cols-2 gap-2 mb-2">
                              <div className="p-2 bg-white/5 rounded">
                                <div className="text-xs text-zinc-400 mb-0.5">ì˜ì—…ì´ìµ ì¦ê°€</div>
                                <div className="text-sm font-bold text-emerald-400">+{totalOpIncomeIncrease}ì–µì›</div>
                                <div className="text-xs text-zinc-300">
                                  {currentOpMargin.toFixed(1)}% â†’ {targetOpMargin.toFixed(1)}% (+{(targetOpMargin - currentOpMargin).toFixed(1)}%p)
                                </div>
                              </div>
                              <div className="p-2 bg-white/5 rounded">
                                <div className="text-xs text-zinc-400 mb-0.5">ROE ê°œì„ </div>
                                <div className="text-sm font-bold text-blue-400">+{totalRoeIncrease.toFixed(1)}%p</div>
                                <div className="text-xs text-zinc-300">
                                  {currentRoe.toFixed(1)}% â†’ {targetRoe.toFixed(1)}%
                                </div>
                              </div>
                            </div>
                            <div className="text-xs text-zinc-200 leading-relaxed">
                              {improvementTargets.length}ê°œ íƒ€ê²Ÿ ìˆœì°¨ ì‹¤í–‰ìœ¼ë¡œ {selectedPeriod && selectedPeriod.split('_')[0] === '2025' ? '2026' : (selectedPeriod ? (Number(selectedPeriod.split('_')[0]) + 1) : 'ë‚´ë…„')}ë…„ 
                              ì—…ê³„ ìµœê³  ìˆ˜ì¤€ì˜ ì¬ë¬´êµ¬ì¡° ë‹¬ì„± ê°€ëŠ¥. 
                              ìš°ì„ ìˆœìœ„: â‘  ì¬ê³  íš¨ìœ¨í™” (ì¦‰ì‹œ íš¨ê³¼) â†’ â‘¡ ìˆ˜ìµì„± ê°œì„  (6ê°œì›”) â†’ â‘¢ ì°¨ì…ê¸ˆ ê°ì¶• (12ê°œì›”)
                            </div>
                          </div>
                        );
                      })()}
                    </div>
                  )}

                  <div className="mt-4 pt-3 border-t border-white/10 flex items-center justify-between">
                    <span className="text-[10px] text-zinc-500">AI ë¶„ì„ì€ ì°¸ê³ ìš©ì´ë©° íˆ¬ì ì¡°ì–¸ì´ ì•„ë‹™ë‹ˆë‹¤</span>
                    <span className="text-[10px] text-zinc-500">{selectedPeriod ? `${selectedPeriod.split('_')[0]}ë…„ ${selectedPeriod.split('_')[1]} ê¸°ì¤€` : 'ë°ì´í„° ê¸°ì¤€'}</span>
                  </div>
                </>
              );
              } catch (error) {
                console.error('AI ë¶„ì„ ì˜¤ë¥˜:', error);
                return (
                  <div className="p-4 text-center">
                    <div className="text-sm text-rose-400 mb-2">âš ï¸ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</div>
                    <div className="text-xs text-zinc-400">{error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}</div>
                  </div>
                );
              }
            })()}
          </div>
        </div>
      </div>
    );
  };

  // ============================================
  // ì†ìµê³„ì‚°ì„œ íƒ­ ë Œë”ë§
  // ============================================
  const renderIncomeTab = () => {
    // ë¹„ìœ¨ ê³„ì‚° í•¨ìˆ˜
    const calcRate = (numerator, denominator) => {
      if (!denominator || denominator === 0) return '-';
      return ((numerator / denominator) * 100).toFixed(1) + '%';
    };

    // ì¦ê°ë¥  ê³„ì‚° (percentage point ìš©)
    const calcRateDiff = (current, prev) => {
      if (current === '-' || prev === '-') return '-';
      const currNum = parseFloat(current);
      const prevNum = parseFloat(prev);
      if (isNaN(currNum) || isNaN(prevNum)) return '-';
      const diff = currNum - prevNum;
      return (diff >= 0 ? '+' : '') + diff.toFixed(1) + '%p';
    };

    // ë²•ì¸ë³„ ë°ì´í„°ëŠ” ì»´í¬ë„ŒíŠ¸ ìƒìœ„ ë ˆë²¨ì—ì„œ ì •ì˜ë¨ (entityData)
    // ì•„ë˜ ì¤‘ë³µ ì •ì˜ëŠ” ì œê±°ë¨ - ìƒìœ„ ë ˆë²¨ì˜ entityData ì‚¬ìš©
    
    // í˜„ì¬ ëª¨ë“œì— ë”°ë¥¸ ê¸°ê°„ ì„¤ì • (ì„ íƒëœ ê¸°ê°„ ê¸°ì¤€)
    const getCurrentPeriodKey = () => {
      if (incomeViewMode === 'quarter') {
        return getPeriodKey(selectedPeriod, 'quarter');
      } else {
        // ëˆ„ì : ì„ íƒëœ ë¶„ê¸°ê¹Œì§€ì˜ ëˆ„ì 
        return getPeriodKey(selectedPeriod, 'year');
      }
    };

    const getPrevPeriodKey = () => {
      if (incomeViewMode === 'quarter') {
        // ë¶„ê¸°: ì „ë…„ ë™ ë¶„ê¸°
        return getPeriodKey(selectedPeriod, 'prev_quarter');
      } else {
        // ëˆ„ì : ì „ë…„ ë™ê¸° ëˆ„ì 
        return getPeriodKey(selectedPeriod, 'prev_year');
      }
    };

    const currPeriod = getCurrentPeriodKey();
    const prevPeriod = getPrevPeriodKey();
    const periodLabel = incomeViewMode === 'quarter' 
      ? selectedPeriod.replace('2025_', '').replace('Q', '') + 'ë¶„ê¸°'
      : 'ì—°ê°„';

    // ë²•ì¸ ìƒ‰ìƒ
    const entityColors = {
      'OC(êµ­ë‚´)': '#3B82F6',
      'ì¤‘êµ­': '#F59E0B',
      'í™ì½©': '#8B5CF6',
      'ê¸°íƒ€': '#6B7280',
      'ì—°ê²°ì¡°ì •': '#9CA3AF',
    };

    // ============================================
    // ë²•ì¸ë³„ ë¶„ì„ ë°ì´í„° ì •í•©ì„± ë³´ì •
    // - í˜„ì¬ entityDataëŠ” "ì—°ê²°ì¡°ì • ì „ í•©ì‚°" ê¸°ì¤€ì´ë©°, ì¼ë¶€ ê¸°ê°„(4Q/ì—°ê°„)ì´ ë™ì¼ ê°’ìœ¼ë¡œ ë“¤ì–´ê°€ ìˆìŒ
    // - UI í‘œ(ì—°ê²°) í•©ê³„ì™€ ë§ì¶”ê¸° ìœ„í•´, ì„ íƒ ê³¼ëª©/ê¸°ê°„ì˜ ì—°ê²° ê¸ˆì•¡ì„ ê¸°ì¤€ìœ¼ë¡œ
    //   1) ê¸°ì¤€ ë¶„í•´(ì—°ê°„ ë¶„í•´ê°’)ë¥¼ ìŠ¤ì¼€ì¼ë§í•˜ê³ 
    //   2) ë°˜ì˜¬ë¦¼ ì˜¤ì°¨/ì—°ê²°ì¡°ì • ì°¨ì´ëŠ” 'ì—°ê²°ì¡°ì •' ë¼ì¸ìœ¼ë¡œ ë³´ì •
    // ============================================
    const getConsolidatedTotal = (accountKey, period) => {
      const v = incomeStatementData?.[period]?.[accountKey];
      return typeof v === 'number' ? v : 0;
    };

    const getBaseEntityBreakdown = (accountKey, period) => {
      // ìš°ì„  í•´ë‹¹ period ê°’ì´ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê°™ì€ ì—°ë„ì˜ Year ê°’ì„ ê¸°ì¤€(íŠ¹íˆ 4Q)ìœ¼ë¡œ ì‚¬ìš©
      const direct = entityData?.[accountKey]?.[period];
      if (direct && Object.keys(direct).length > 0) return direct;

      const fallbackPeriod = period.endsWith('_4Q') ? period.replace('_4Q', '_Year') : period;
      return entityData?.[accountKey]?.[fallbackPeriod] || {};
    };

    const getAlignedEntityBreakdown = (accountKey, period) => {
      const consolidatedTotal = getConsolidatedTotal(accountKey, period);
      const base = getBaseEntityBreakdown(accountKey, period);

      const baseKeys = Object.keys(base);
      if (baseKeys.length === 0) {
        return { 'ì—°ê²°ì¡°ì •': consolidatedTotal };
      }

      const baseSum = baseKeys.reduce((sum, k) => sum + (base[k] || 0), 0);
      if (baseSum === 0) {
        return { ...base, 'ì—°ê²°ì¡°ì •': consolidatedTotal };
      }

      const scale = consolidatedTotal / baseSum;
      const scaled = {};
      for (const k of baseKeys) {
        // ë°˜ì˜¬ë¦¼ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ì°¨ì´ëŠ” ì—°ê²°ì¡°ì •ìœ¼ë¡œ í¡ìˆ˜
        scaled[k] = Math.round((base[k] || 0) * scale);
      }

      const scaledSum = Object.values(scaled).reduce((sum, v) => sum + (v || 0), 0);
      const adjustment = consolidatedTotal - scaledSum;
      return { ...scaled, 'ì—°ê²°ì¡°ì •': adjustment };
    };

    // í‘œì‹œìš© ê·¸ë£¹í•‘: ë¹„ì¤‘ì´ ì‘ì€ ë²•ì¸ + ì—°ê²°ì¡°ì •ì„ 'ê¸°íƒ€(ì—°ê²°ì¡°ì •)'ë¡œ í•©ì‚°
    const MINOR_ENTITY_RATIO_THRESHOLD = 0.03; // 3% ë¯¸ë§Œì€ ê¸°íƒ€ë¡œ í•©ì‚°
    const MERGED_ENTITY_LABEL = 'ê¸°íƒ€(ì—°ê²°ì¡°ì •)';
    const MAJOR_ENTITIES = ['OC(êµ­ë‚´)', 'ì¤‘êµ­'];

    // ë‹¨ì¼ ê¸°ê°„ìš© (ë„ë„› ì°¨íŠ¸ ë“±)
    const getGroupedEntityBreakdown = (accountKey, period) => {
      return getGroupedEntityBreakdownForComparison(accountKey, period, period);
    };

    // ë¹„êµìš©: ì „ê¸°/ë‹¹ê¸° ë‘˜ ë‹¤ë¥¼ ê³ ë ¤í•˜ì—¬, í•œ ê¸°ê°„ì´ë¼ë„ ìœ ì˜ë¯¸í•˜ë©´ ê°œë³„ë¡œ ìœ ì§€
    const getGroupedEntityBreakdownForComparison = (accountKey, prevPeriod, currPeriod) => {
      const totalCurr = getConsolidatedTotal(accountKey, currPeriod);
      const totalPrev = getConsolidatedTotal(accountKey, prevPeriod);
      const alignedCurr = getAlignedEntityBreakdown(accountKey, currPeriod);
      const alignedPrev = getAlignedEntityBreakdown(accountKey, prevPeriod);

      // ì „ê¸°/ë‹¹ê¸° ëª¨ë‘ì˜ í‚¤ë¥¼ í•©ì§‘í•©ìœ¼ë¡œ ìˆ˜ì§‘
      const allKeys = Array.from(new Set([...Object.keys(alignedPrev), ...Object.keys(alignedCurr)]));

      const merged = {};
      const entitiesToKeep = new Set();

      // 1. OC(êµ­ë‚´), ì¤‘êµ­ì€ í•­ìƒ ìœ ì§€
      MAJOR_ENTITIES.forEach(entity => {
        if (allKeys.includes(entity)) {
          entitiesToKeep.add(entity);
        }
      });

      // 2. ì „ê¸°ë‚˜ ë‹¹ê¸° ì¤‘ í•˜ë‚˜ë¼ë„ ë°ì´í„°ê°€ ìˆê³ , ê·¸ ê¸°ê°„ì˜ ë¹„ì¤‘ì´ 3% ì´ìƒì´ë©´ ê°œë³„ë¡œ ìœ ì§€
      for (const name of allKeys) {
        if (MAJOR_ENTITIES.includes(name) || name === 'ì—°ê²°ì¡°ì •' || name === 'ê¸°íƒ€') continue;

        const prevVal = alignedPrev[name] || 0;
        const currVal = alignedCurr[name] || 0;
        
        const prevRatio = totalPrev !== 0 ? Math.abs(prevVal) / Math.abs(totalPrev) : 0;
        const currRatio = totalCurr !== 0 ? Math.abs(currVal) / Math.abs(totalCurr) : 0;

        // ì „ê¸°ë‚˜ ë‹¹ê¸° ì¤‘ í•˜ë‚˜ë¼ë„ ë°ì´í„°ê°€ ìˆê³ , ê·¸ ê¸°ê°„ì˜ ë¹„ì¤‘ì´ 3% ì´ìƒì´ë©´ ê°œë³„ ìœ ì§€
        const hasDataInEitherPeriod = prevVal !== 0 || currVal !== 0;
        const isSignificantInEitherPeriod = prevRatio >= MINOR_ENTITY_RATIO_THRESHOLD || currRatio >= MINOR_ENTITY_RATIO_THRESHOLD;

        if (hasDataInEitherPeriod && isSignificantInEitherPeriod) {
          entitiesToKeep.add(name);
        }
      }

      // 3. ìœ ì§€í•  ë²•ì¸ë“¤ì„ mergedì— ì¶”ê°€ (ë‹¹ê¸° ê°’ì„ ì‚¬ìš©)
      entitiesToKeep.forEach(name => {
        merged[name] = alignedCurr[name] || 0;
      });

      // 4. ë‚˜ë¨¸ì§€ëŠ” ê¸°íƒ€(ì—°ê²°ì¡°ì •)ë¡œ í¡ìˆ˜ (í•©ê³„ ì •í•©ì„± ë³´ì¥)
      const keptSum = Object.values(merged).reduce((s, v) => s + (v || 0), 0);
      merged[MERGED_ENTITY_LABEL] = totalCurr - keptSum;

      return merged;
    };

    // ë„ë„› ì°¨íŠ¸ìš© ë°ì´í„° ë³€í™˜ (ì–‘ìˆ˜ ê°’ë§Œ í‘œì‹œ)
    const getDonutData = (period) => {
      const data = getGroupedEntityBreakdown(selectedAccount, period);
      return Object.entries(data)
        .filter(([_, value]) => value > 0) // ì–‘ìˆ˜ë§Œ í•„í„°ë§ (ë„ë„›ì€ ìŒìˆ˜ í‘œí˜„ì´ ì–´ë ¤ì›€)
        .map(([name, value]) => ({
          name,
          value: value || 0,
          color:
            name === MERGED_ENTITY_LABEL
              ? '#6B7280'
              : (entityColors[name] || '#9CA3AF'),
        }));
    };

    // ë²•ì¸ë³„ í…Œì´ë¸” ë°ì´í„° - í˜„ì¬ ëª¨ë“œì— ë”°ë¼ ì—°ë™
    const getEntityTableData = () => {
      // ë¹„êµìš© í•¨ìˆ˜ ì‚¬ìš©: ì „ê¸°/ë‹¹ê¸° ë‘˜ ë‹¤ë¥¼ ê³ ë ¤
      const curr = getGroupedEntityBreakdownForComparison(selectedAccount, prevPeriod, currPeriod);
      const prev = getGroupedEntityBreakdownForComparison(selectedAccount, prevPeriod, prevPeriod);
      const totalCurr = getConsolidatedTotal(selectedAccount, currPeriod);
      
      // í‘œ í‘œì‹œ ìˆœì„œ:
      // - OC/ì¤‘êµ­ì€ í•­ìƒ ìƒë‹¨
      // - ê·¸ ì™¸(ì˜ˆ: í™ì½©)ê°€ ì„ê³„ì¹˜ ì´ìƒì´ë©´ ê°œë³„ë¡œ ë‚¨ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë™ì ìœ¼ë¡œ í¬í•¨
      // - ê¸°íƒ€(ì—°ê²°ì¡°ì •)ëŠ” í•­ìƒ ë§ˆì§€ë§‰
      const keyUnion = Array.from(
        new Set([...Object.keys(prev), ...Object.keys(curr)])
      );

      const dynamicEntities = keyUnion
        .filter((k) => k !== MERGED_ENTITY_LABEL && !MAJOR_ENTITIES.includes(k))
        .sort(
          (a, b) =>
            Math.max(Math.abs(curr[b] || 0), Math.abs(prev[b] || 0)) -
            Math.max(Math.abs(curr[a] || 0), Math.abs(prev[a] || 0))
        );

      const entityOrder = [...MAJOR_ENTITIES, ...dynamicEntities, MERGED_ENTITY_LABEL].filter(
        (v, i, arr) => arr.indexOf(v) === i
      );

      return entityOrder.map(entity => {
        const prevVal = prev[entity] || 0;
        const currVal = curr[entity] || 0;
        const ratio = totalCurr > 0 ? ((currVal / totalCurr) * 100).toFixed(1) : '0.0';
        const change = prevVal !== 0 ? (((currVal - prevVal) / Math.abs(prevVal)) * 100).toFixed(1) : '-';
        return { entity, prevVal, currVal, ratio, change };
      });
    };

    // ì†ìµê³„ì‚°ì„œ í•­ëª© ì •ì˜
    const incomeItems = [
      { key: 'ë§¤ì¶œì•¡', label: 'I. ë§¤ì¶œì•¡', depth: 0, bold: true, selectable: true },
      { key: 'ë§¤ì¶œì›ê°€', label: 'II. ë§¤ì¶œì›ê°€', depth: 0, bold: true, selectable: true },
      { key: 'ë§¤ì¶œì´ì´ìµ', label: 'III. ë§¤ì¶œì´ì´ìµ', depth: 0, bold: true, selectable: true },
      { key: 'ë§¤ì¶œì´ì´ìµë¥ ', label: 'ë§¤ì¶œì´ì´ìµë¥ ', depth: 0, isRate: true, rateOf: ['ë§¤ì¶œì´ì´ìµ', 'ë§¤ì¶œì•¡'], highlight: 'blue' },
      { key: 'íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„', label: 'IV. íŒë§¤ë¹„ì™€ê´€ë¦¬ë¹„', depth: 0, bold: true },
      { key: 'ì¸ê±´ë¹„', label: '(1)ì¸ê±´ë¹„', depth: 1, selectable: true },
      { key: 'ê´‘ê³ ì„ ì „ë¹„', label: '(2)ê´‘ê³ ì„ ì „ë¹„', depth: 1, selectable: true },
      { key: 'ìˆ˜ìˆ˜ë£Œ', label: '(3)ìˆ˜ìˆ˜ë£Œ', depth: 1, selectable: true },
      { key: 'ê°ê°€ìƒê°ë¹„', label: '(4)ê°ê°€ìƒê°ë¹„', depth: 1, selectable: true },
      { key: 'ê¸°íƒ€íŒê´€ë¹„', label: '(5)ê¸°íƒ€', depth: 1, selectable: true },
      { key: 'ì˜ì—…ì´ìµ', label: 'V. ì˜ì—…ì´ìµ', depth: 0, bold: true, highlight: 'green', selectable: true },
      { key: 'ì˜ì—…ì´ìµë¥ ', label: 'ì˜ì—…ì´ìµë¥ ', depth: 0, isRate: true, rateOf: ['ì˜ì—…ì´ìµ', 'ë§¤ì¶œì•¡'], highlight: 'blue' },
      { key: 'ì˜ì—…ì™¸ì†ìµ', label: 'VI. ì˜ì—…ì™¸ì†ìµ', depth: 0, bold: true, toggleParent: true },
      { key: 'ì™¸í™˜ì†ìµ', label: '(1)ì™¸í™˜ì†ìµ', depth: 1, toggleChild: true },
      { key: 'ì„ ë¬¼í™˜ì†ìµ', label: '(2)ì„ ë¬¼í™˜ì†ìµ', depth: 1, toggleChild: true },
      { key: 'ê¸ˆìœµìƒí’ˆì†ìµ', label: '(3)ê¸ˆìœµìƒí’ˆì†ìµ', depth: 1, toggleChild: true },
      { key: 'ì´ìì†ìµ', label: '(4)ì´ìì†ìµ', depth: 1, toggleChild: true },
      { key: 'ë°°ë‹¹ìˆ˜ìµ', label: '(5)ë°°ë‹¹ìˆ˜ìµ', depth: 1, toggleChild: true },
      { key: 'ê¸°ë¶€ê¸ˆ', label: '(6)ê¸°ë¶€ê¸ˆ', depth: 1, toggleChild: true },
      { key: 'ê¸°íƒ€ì†ìµ', label: '(7)ê¸°íƒ€ì†ìµ', depth: 1, toggleChild: true },
      { key: 'ì§€ë¶„ë²•ì†ìµ', label: 'VII. ì§€ë¶„ë²•ì†ìµ', depth: 0, bold: true },
      { key: 'ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ', label: 'VIII. ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ', depth: 0, bold: true },
      { key: 'ë²•ì¸ì„¸ë¹„ìš©', label: 'IX. ë²•ì¸ì„¸ë¹„ìš©', depth: 0, bold: true },
      { key: 'ë²•ì¸ì„¸ìœ¨', label: 'ë²•ì¸ì„¸ìœ¨', depth: 0, isRate: true, rateOf: ['ë²•ì¸ì„¸ë¹„ìš©', 'ë²•ì¸ì„¸ë¹„ìš©ì°¨ê°ì „ìˆœì´ìµ'], highlight: 'blue' },
      { key: 'ë‹¹ê¸°ìˆœì´ìµ', label: 'X. ë‹¹ê¸°ìˆœì´ìµ', depth: 0, bold: true, highlight: 'green', selectable: true },
      { key: 'ë‹¹ê¸°ìˆœì´ìµë¥ ', label: 'ë‹¹ê¸°ìˆœì´ìµë¥ ', depth: 0, isRate: true, rateOf: ['ë‹¹ê¸°ìˆœì´ìµ', 'ë§¤ì¶œì•¡'], highlight: 'blue' },
    ];

    // ì„ íƒ ê°€ëŠ¥í•œ ê³¼ëª© ëª©ë¡
    const selectableAccounts = incomeItems.filter(item => item.selectable).map(item => item.key);

    // ìš”ì•½ ì¹´ë“œ ë°ì´í„°
    const summaryCards = [
      {
        title: 'ë§¤ì¶œì•¡',
        key: 'ë§¤ì¶œì•¡',
        hasRate: false,
      },
      {
        title: 'ë§¤ì¶œì´ì´ìµ',
        key: 'ë§¤ì¶œì´ì´ìµ',
        hasRate: true,
        rateLabel: 'ë§¤ì¶œì´ì´ìµë¥ ',
        rateOf: ['ë§¤ì¶œì´ì´ìµ', 'ë§¤ì¶œì•¡'],
      },
      {
        title: 'ì˜ì—…ì´ìµ',
        key: 'ì˜ì—…ì´ìµ',
        hasRate: true,
        rateLabel: 'ì˜ì—…ì´ìµë¥ ',
        rateOf: ['ì˜ì—…ì´ìµ', 'ë§¤ì¶œì•¡'],
      },
      {
        title: 'ë‹¹ê¸°ìˆœì´ìµ',
        key: 'ë‹¹ê¸°ìˆœì´ìµ',
        hasRate: true,
        rateLabel: 'ë‹¹ê¸°ìˆœì´ìµë¥ ',
        rateOf: ['ë‹¹ê¸°ìˆœì´ìµ', 'ë§¤ì¶œì•¡'],
      },
    ];

    // ìš”ì•½ ì¹´ë“œëŠ” ì¡°íšŒ ì‹œì  ê¸°ì¤€ ëˆ„ì (ì—°ê°„) ë°ì´í„° ì‚¬ìš©
    const incomeSummaryYearKey = getPeriodKey(selectedPeriod, 'year');
    const incomeSummaryPrevYearKey = getPeriodKey(selectedPeriod, 'prev_year') || '2024_Year';

    return (
      <div className="space-y-4">
        {/* ìš”ì•½ ì¹´ë“œ ì„¹ì…˜ - ì¡°íšŒ ì‹œì  ê¸°ì¤€ ëˆ„ì  ì‹¤ì  */}
        <div>
          <div className="flex items-center justify-between mb-3">
            <h3 className="text-sm font-semibold text-zinc-700">ì‹¤ì  ìš”ì•½ (ëˆ„ì )</h3>
          </div>

          <div className="grid grid-cols-4 gap-3">
          {summaryCards.map((card, idx) => {
            // ì„ íƒëœ ê¸°ê°„ ê¸°ì¤€ ëˆ„ì (ì—°ê°„) ë°ì´í„°
            const curr = incomeStatementData[incomeSummaryYearKey]?.[card.key] || 0;
            const prev = incomeStatementData[incomeSummaryPrevYearKey]?.[card.key] || 0;
            const diff = curr - prev;
            const changeRate = calculateYoY(curr, prev);
            const isPositive = parseFloat(changeRate) >= 0;
            
            // ì–µì› ë‹¨ìœ„ ë³€í™˜ (ë°±ë§Œì› -> ì–µì›)
            const currBil = Math.round(curr / 100);
            const prevBil = Math.round(prev / 100);
            const diffBil = Math.round(diff / 100);
            
            // ì¡°ë‹¨ìœ„ í¬ë§· í•¨ìˆ˜
            const formatTrilBil = (val) => {
              if (val === 0) return '0';
              const absVal = Math.abs(val);
              const sign = val < 0 ? '-' : '';
              if (absVal >= 10000) {
                const tril = Math.floor(absVal / 10000);
                const bil = Math.round(absVal % 10000);
                return `${sign}${tril}ì¡° ${formatNumber(bil)}`;
              }
              return `${sign}${formatNumber(absVal)}`;
            };
            
            // ë¹„ìœ¨ ê³„ì‚°
            let currRate = null;
            let prevRate = null;
            let rateDiff = null;
            if (card.hasRate) {
              const [num, denom] = card.rateOf;
              const currNum = incomeStatementData[incomeSummaryYearKey]?.[num] || 0;
              const currDenom = incomeStatementData[incomeSummaryYearKey]?.[denom] || 0;
              const prevNum = incomeStatementData[incomeSummaryPrevYearKey]?.[num] || 0;
              const prevDenom = incomeStatementData[incomeSummaryPrevYearKey]?.[denom] || 0;
              
              currRate = currDenom > 0 ? ((currNum / currDenom) * 100).toFixed(1) : '0.0';
              prevRate = prevDenom > 0 ? ((prevNum / prevDenom) * 100).toFixed(1) : '0.0';
              rateDiff = (parseFloat(currRate) - parseFloat(prevRate)).toFixed(1);
            }
            
            // ì¡°ë‹¨ìœ„ í¬ë§· í•¨ìˆ˜ (ì–µì› ë‹¨ìœ„ ì…ë ¥) - ìˆ«ìì™€ ë‹¨ìœ„ ë¶„ë¦¬ ë°˜í™˜
            const formatTrilBilSummary = (valueInBil) => {
              if (valueInBil === 0 || valueInBil === undefined || valueInBil === null) return { number: '-', unit: '' };
              const absValue = Math.abs(valueInBil);
              const sign = valueInBil < 0 ? '-' : '';
              
              if (absValue >= 10000) {
                const tril = Math.floor(absValue / 10000);
                const bil = Math.round(absValue % 10000);
                return { number: `${sign}${tril}ì¡° ${formatNumber(bil)}`, unit: 'ì–µì›' };
              }
              return { number: `${sign}${formatNumber(Math.round(absValue))}`, unit: 'ì–µì›' };
            };
            
            const formatted = formatTrilBilSummary(currBil);
            const formattedPrev = formatTrilBilSummary(prevBil);
            const formattedDiff = formatTrilBilSummary(diffBil);
            
            return (
              <div 
                key={idx}
                className="bg-white rounded-lg border border-zinc-200 shadow-sm p-4 hover:shadow-md transition-shadow duration-200"
              >
                {/* í—¤ë”: ì œëª©ê³¼ ì¦ê°ë¥  ë°•ìŠ¤ */}
                <div className="flex items-center justify-between mb-3">
                  <span className="text-xs font-medium text-zinc-500 uppercase tracking-wide">{card.title}</span>
                  <span className={`text-xs font-semibold px-2 py-0.5 rounded ${
                    isPositive ? 'bg-emerald-50 text-emerald-600' : 'bg-rose-50 text-rose-600'
                  }`}>
                    {changeRate !== '-' ? `${isPositive ? '+' : ''}${changeRate}%` : '-'}
                  </span>
                </div>
                
                {/* ë‹¹ë…„ ìˆ˜ì¹˜ */}
                <div className="flex items-baseline gap-1 mb-3">
                  <span className="text-2xl font-bold text-zinc-900">{formatted.number}</span>
                  <span className="text-sm font-normal text-zinc-400">{formatted.unit}</span>
                </div>
                
                {/* ì „ë…„ ìˆ˜ì¹˜ ë° ì°¨ì•¡ (í•œ ì¤„) */}
                <div className="text-xs text-zinc-600 mb-3">
                  ì „ë…„ {formattedPrev.number.replace('ì–µì›', 'ì–µ')}ì–µì›
                  {diffBil !== 0 && (
                    <span className={`ml-1 font-medium ${diffBil >= 0 ? 'text-emerald-600' : 'text-rose-600'}`}>
                      {diffBil >= 0 ? '+' : ''}{formattedDiff.number.replace('ì–µì›', 'ì–µ')}ì–µì›
                    </span>
                  )}
                </div>
                
                {/* ë¹„ìœ¨ (í•´ë‹¹ë˜ëŠ” ê²½ìš°) */}
                {card.hasRate && (
                  <div className="pt-3 border-t border-zinc-100">
                    <div className="flex items-center justify-between text-xs">
                      <span className="text-zinc-400">{card.rateLabel}</span>
                      <div className="flex items-center gap-1.5">
                        <span className="text-zinc-900 font-semibold">{currRate}%</span>
                        {rateDiff !== null && parseFloat(rateDiff) !== 0 && (
                          <span className={`text-xs font-medium ${parseFloat(rateDiff) >= 0 ? 'text-emerald-600' : 'text-rose-600'}`}>
                            {parseFloat(rateDiff) >= 0 ? '+' : ''}{rateDiff}%p
                          </span>
                        )}
                      </div>
                    </div>
                  </div>
                )}
              </div>
            );
          })}
          </div>
        </div>

        {/* ì†ìµê³„ì‚°ì„œ í…Œì´ë¸” & ë²•ì¸ë³„ ë¶„ì„ */}
        <div className="flex flex-col xl:flex-row gap-4">
        {/* ì¢Œì¸¡: ì†ìµê³„ì‚°ì„œ í…Œì´ë¸” */}
        <div className="flex-1 min-w-0">
          <div className="bg-white rounded-lg border border-zinc-200 shadow-sm overflow-hidden">
            <div className="px-4 py-3 border-b border-zinc-200 bg-zinc-50">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-3">
                  <h3 className="text-sm font-semibold text-zinc-900">ì—°ê²° ì†ìµê³„ì‚°ì„œ</h3>
                </div>
                {/* ë¶„ê¸°/ëˆ„ì  ì„ íƒ ë²„íŠ¼ */}
                <div className="inline-flex p-0.5 bg-zinc-100 rounded-lg border border-zinc-200">
                  <button
                    onClick={() => setIncomeViewMode('quarter')}
                    className={`px-3 py-1 text-xs font-medium rounded transition-all duration-150 ${
                      incomeViewMode === 'quarter'
                        ? 'bg-white text-zinc-900 border border-zinc-200 shadow-sm'
                        : 'text-zinc-500 hover:text-zinc-700'
                    }`}
                  >
                    ë¶„ê¸°(3ê°œì›”)
                  </button>
                  <button
                    onClick={() => setIncomeViewMode('annual')}
                    className={`px-3 py-1 text-xs font-medium rounded transition-all duration-150 ${
                      incomeViewMode === 'annual'
                        ? 'bg-white text-zinc-900 border border-zinc-200 shadow-sm'
                        : 'text-zinc-500 hover:text-zinc-700'
                    }`}
                  >
                    ëˆ„ì  (ì—°ê°„)
                  </button>
                </div>
              </div>
            </div>
            <div className="overflow-x-auto">
              <table className="w-full text-sm">
                <thead>
                  <tr className="bg-zinc-50 border-b border-zinc-200">
                    <th className="text-left px-3 py-2.5 font-semibold text-zinc-700 border-r border-zinc-200 min-w-[175px]">ê³¼ëª©</th>
                    <th className="text-center px-3 py-2 font-semibold text-zinc-600 border-r border-zinc-200 min-w-[95px]">
                      {(() => {
                        const [yearStr, qStr] = selectedPeriod.split('_'); // ì˜ˆ: ['2025','Q2']
                        const quarterNum = (qStr || 'Q4').replace('Q', '');
                        const prevYear = String(Number(yearStr) - 1);
                        return incomeViewMode === 'quarter'
                          ? `${prevYear}.${quarterNum}Q`
                          : `${prevYear}ë…„`;
                      })()}
                    </th>
                    <th className="text-center px-3 py-2 font-semibold text-zinc-900 border-r border-zinc-200 bg-zinc-100 min-w-[95px]">
                      {(() => {
                        const [yearStr, qStr] = selectedPeriod.split('_'); // ì˜ˆ: ['2025','Q2']
                        const quarterNum = (qStr || 'Q4').replace('Q', '');
                        return incomeViewMode === 'quarter'
                          ? `${yearStr}.${quarterNum}Q`
                          : `${yearStr}ë…„`;
                      })()}
                    </th>
                    <th className="text-center px-3 py-2 font-semibold text-zinc-600 border-r border-zinc-200 min-w-[90px]">ì¦ê°ì•¡</th>
                    <th className="text-center px-3 py-2 font-semibold text-zinc-600 min-w-[70px]">ì¦ê°ë¥ </th>
                  </tr>
                </thead>
                <tbody>
                  {incomeItems.map((item, idx) => {
                    const isRateRow = item.isRate;
                    const isSelectable = item.selectable;
                    const isSelected = selectedAccount === item.key;
                    const isToggleParent = item.toggleParent;
                    const isToggleChild = item.toggleChild;
                    
                    // í† ê¸€ ìì‹ í•­ëª©ì´ê³  ì ‘í˜€ìˆìœ¼ë©´ ë Œë”ë§í•˜ì§€ ì•ŠìŒ
                    if (isToggleChild && !isNonOperatingExpanded) {
                      return null;
                    }
                    
                    // ë¹„ìœ¨ í–‰ ì²˜ë¦¬
                    if (isRateRow) {
                      const [num, denom] = item.rateOf;
                      const ratePrev = calcRate(incomeStatementData[prevPeriod]?.[num] || 0, incomeStatementData[prevPeriod]?.[denom] || 0);
                      const rateCurr = calcRate(incomeStatementData[currPeriod]?.[num] || 0, incomeStatementData[currPeriod]?.[denom] || 0);
                      const rateDiff = calcRateDiff(rateCurr, ratePrev);
                      
                      return (
                        <tr key={idx} className="border-b border-zinc-100 bg-zinc-50/50">
                          <td className="px-3 py-2 text-blue-600 italic border-r border-zinc-200 text-xs">{item.label}</td>
                          <td className="text-center px-3 py-2 text-blue-600 border-r border-zinc-200">{ratePrev}</td>
                          <td className="text-center px-3 py-2 font-medium text-blue-600 border-r border-zinc-200 bg-zinc-50">{rateCurr}</td>
                          <td colSpan="2" className={`text-center px-3 py-2 font-medium ${rateDiff.includes('+') ? 'text-emerald-600' : rateDiff.includes('-') ? 'text-rose-600' : 'text-blue-600'}`}>
                            {rateDiff}
                          </td>
                        </tr>
                      );
                    }

                    // ì¼ë°˜ ê¸ˆì•¡ í–‰ ì²˜ë¦¬
                    const valPrev = incomeStatementData[prevPeriod]?.[item.key] || 0;
                    const valCurr = incomeStatementData[currPeriod]?.[item.key] || 0;
                    const diff = valCurr - valPrev;
                    const changeRate = calculateYoY(valCurr, valPrev);
                    
                    const highlightClass = item.highlight === 'green' ? 'bg-emerald-50/50' : '';
                    const selectableClass = isSelectable ? 'cursor-pointer hover:bg-zinc-100' : '';
                    const selectedClass = isSelected ? 'bg-zinc-100 ring-1 ring-zinc-300 ring-inset' : '';
                    const toggleParentClass = isToggleParent ? 'cursor-pointer hover:bg-zinc-50' : '';
                    
                    return (
                      <tr 
                        key={idx} 
                        className={`border-b border-zinc-100 ${highlightClass} ${selectableClass} ${selectedClass} ${toggleParentClass}`}
                        onClick={() => {
                          if (isSelectable) setSelectedAccount(item.key);
                          if (isToggleParent) setIsNonOperatingExpanded(!isNonOperatingExpanded);
                        }}
                      >
                        <td className={`px-3 py-2 border-r border-zinc-200 ${item.bold ? 'font-semibold text-zinc-900' : 'text-zinc-600'} ${item.depth === 1 ? 'pl-6' : ''}`}>
                          {isToggleParent && (
                            <span className="inline-flex items-center justify-center w-4 h-4 mr-1.5 rounded bg-zinc-200 text-zinc-600 text-xs font-medium">
                              {isNonOperatingExpanded ? 'âˆ’' : '+'}
                            </span>
                          )}
                          {item.label}
                        </td>
                        <td className="text-right px-3 py-2 text-zinc-500 border-r border-zinc-200 tabular-nums">{formatNumber(valPrev)}</td>
                        <td className={`text-right px-3 py-2 border-r border-zinc-200 tabular-nums bg-zinc-50/50 ${item.bold ? 'font-semibold text-zinc-900' : 'text-zinc-700'}`}>{formatNumber(valCurr)}</td>
                        <td className={`text-right px-3 py-2 font-medium border-r border-zinc-200 tabular-nums ${diff >= 0 ? 'text-emerald-600' : 'text-rose-600'}`}>
                          {diff !== 0 ? formatNumber(diff) : '-'}
                        </td>
                        <td className={`text-right px-3 py-2 font-medium tabular-nums ${parseFloat(changeRate) >= 0 ? 'text-emerald-600' : 'text-rose-600'}`}>
                          {changeRate !== '-' ? `${changeRate}%` : '-'}
                        </td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>
          </div>
        </div>

        {/* ìš°ì¸¡: ë²•ì¸ë³„ ë¶„ì„ */}
        <div className="w-full xl:w-[360px] flex-shrink-0 space-y-3">
          {/* ë²•ì¸ë³„ ë¶„ì„ í—¤ë” */}
          <div className="bg-white rounded-lg border border-zinc-200 shadow-sm p-4">
            <h3 className="text-sm font-semibold text-zinc-900 mb-0.5">
              {incomeItems.find(i => i.key === selectedAccount)?.label || selectedAccount} ë²•ì¸ë³„ ë¶„ì„
            </h3>
            <p className="text-xs text-zinc-400">{periodLabel} ê¸°ì¤€ ë²•ì¸ë³„ ë¹„ì¤‘</p>
            
            {/* ë„ë„› ì°¨íŠ¸ ì˜ì—­ */}
            <div className="flex justify-around mt-4">
              <div className="text-center">
                <p className="text-xs font-medium text-zinc-500 mb-2">
                  {incomeViewMode === 'quarter' ? '2024.4Q' : '2024ë…„'}
                </p>
                <div style={{ width: 110, height: 110 }}>
                  {getDonutData(prevPeriod).length > 0 ? (
                    <PieChart width={110} height={110}>
                      <Pie
                        data={getDonutData(prevPeriod)}
                        cx={55}
                        cy={55}
                        innerRadius={28}
                        outerRadius={48}
                        paddingAngle={2}
                        dataKey="value"
                      >
                        {getDonutData(prevPeriod).map((entry, index) => (
                          <Cell key={`cell-prev-${index}`} fill={entry.color} />
                        ))}
                      </Pie>
                      <Tooltip 
                        content={<CustomPieTooltip formatter={(value) => `${formatNumber(Math.round(value/100))}ì–µì›`} />}
                      />
                    </PieChart>
                  ) : (
                    <div className="w-full h-full flex items-center justify-center text-zinc-400 text-xs">ë°ì´í„° ì—†ìŒ</div>
                  )}
                </div>
              </div>
              <div className="text-center">
                <p className="text-xs font-medium text-zinc-500 mb-2">
                  {incomeViewMode === 'quarter' 
                    ? (() => {
                        const [yearStr, qStr] = selectedPeriod.split('_');
                        const quarterNum = (qStr || 'Q4').replace('Q', '');
                        return `${yearStr}.${quarterNum}Q`;
                      })()
                    : '2025ë…„'}
                </p>
                <div style={{ width: 110, height: 110 }}>
                  {getDonutData(currPeriod).length > 0 ? (
                    <PieChart width={110} height={110}>
                      <Pie
                        data={getDonutData(currPeriod)}
                        cx={55}
                        cy={55}
                        innerRadius={28}
                        outerRadius={48}
                        paddingAngle={2}
                        dataKey="value"
                      >
                        {getDonutData(currPeriod).map((entry, index) => (
                          <Cell key={`cell-curr-${index}`} fill={entry.color} />
                        ))}
                      </Pie>
                      <Tooltip 
                        content={<CustomPieTooltip formatter={(value) => `${formatNumber(Math.round(value/100))}ì–µì›`} />}
                      />
                    </PieChart>
                  ) : (
                    <div className="w-full h-full flex items-center justify-center text-zinc-400 text-xs">ë°ì´í„° ì—†ìŒ</div>
                  )}
                </div>
              </div>
            </div>
            
            {/* ë²”ë¡€ */}
            <div className="flex flex-wrap justify-center gap-3 mt-3">
              {Object.entries(entityColors).map(([name, color]) => (
                <div key={name} className="flex items-center gap-1.5">
                  <span className="w-2 h-2 rounded-full" style={{ backgroundColor: color }}></span>
                  <span className="text-xs text-zinc-500">{name}</span>
                </div>
              ))}
            </div>
          </div>

          {/* ë²•ì¸ë³„ í…Œì´ë¸” */}
          <div className="bg-white rounded-lg border border-zinc-200 shadow-sm overflow-hidden">
            <table className="w-full text-sm">
              <thead>
                <tr className="bg-zinc-50 border-b border-zinc-200">
                  <th className="text-left px-3 py-2 font-semibold text-zinc-600 min-w-[80px] whitespace-nowrap">ë²•ì¸</th>
                  <th className="text-right px-2 py-2 font-semibold text-zinc-600 min-w-[85px]">
                    {incomeViewMode === 'quarter' ? '24.4Q' : '2024'}
                  </th>
                  <th className="text-right px-2 py-2 font-semibold text-zinc-600 min-w-[85px]">
                    {incomeViewMode === 'quarter' ? '25.4Q' : '2025'}
                  </th>
                  <th className="text-right px-2 py-2 font-semibold text-zinc-600 min-w-[55px]">ë¹„ì¤‘</th>
                  <th className="text-right px-3 py-2 font-semibold text-zinc-600 min-w-[70px] whitespace-nowrap">YoY</th>
                </tr>
              </thead>
              <tbody>
                {getEntityTableData().map((row, idx) => (
                  <tr key={idx} className="border-b border-zinc-100 hover:bg-zinc-50 transition-colors">
                    <td className="px-3 py-2 text-zinc-700 whitespace-nowrap">
                      <span 
                        className="inline-block w-2 h-2 rounded-full mr-1.5" 
                        style={{ backgroundColor: entityColors[row.entity] }}
                      ></span>
                      {row.entity}
                    </td>
                    <td className="text-right px-2 py-2 text-zinc-500 tabular-nums">{formatNumber(row.prevVal)}</td>
                    <td className="text-right px-2 py-2 text-zinc-900 font-medium tabular-nums">{formatNumber(row.currVal)}</td>
                    <td className="text-right px-2 py-2 text-zinc-500 tabular-nums">{row.ratio}%</td>
                    <td className={`text-right px-3 py-2 font-medium tabular-nums whitespace-nowrap ${parseFloat(row.change) >= 0 ? 'text-emerald-600' : 'text-rose-600'}`}>
                      {row.change !== '-' ? `${parseFloat(row.change) >= 0 ? '+' : ''}${row.change}%` : '-'}
                    </td>
                  </tr>
                ))}
                {/* í•©ê³„ í–‰ */}
                <tr className="bg-zinc-50 font-medium">
                  <td className="px-3 py-2 text-zinc-900 whitespace-nowrap">í•©ê³„</td>
                  <td className="text-right px-2 py-2 text-zinc-700 tabular-nums">
                    {formatNumber(getEntityTableData().reduce((sum, r) => sum + r.prevVal, 0))}
                  </td>
                  <td className="text-right px-2 py-2 text-zinc-900 tabular-nums">
                    {formatNumber(getEntityTableData().reduce((sum, r) => sum + r.currVal, 0))}
                  </td>
                  <td className="text-right px-2 py-2 text-zinc-700 tabular-nums">100%</td>
                  <td className="text-right px-3 py-2 text-zinc-400 whitespace-nowrap">-</td>
                </tr>
              </tbody>
            </table>
            <p className="text-[10px] text-zinc-400 px-3 py-1.5 bg-zinc-50 border-t border-zinc-100">* ë‹¨ìœ„: ë°±ë§Œì› (ì—°ê²°ì¡°ì • ì „ ë²•ì¸ë³„ í•©ì‚°)</p>
          </div>

          {/* ë²•ì¸ë³„ ì¦ê° ë¶„ì„ - ë™ì  ìƒì„± */}
          <div className="bg-white rounded-lg border border-zinc-200 shadow-sm p-4">
            <div className="flex items-center justify-between mb-3">
              <h3 className="text-sm font-semibold text-zinc-900">
                {incomeItems.find(i => i.key === selectedAccount)?.label || selectedAccount} ì¦ê° ë¶„ì„
              </h3>
              <button
                onClick={() => setIncomeEditMode(!incomeEditMode)}
                className={`text-xs px-2 py-1 rounded transition-colors ${
                  incomeEditMode 
                    ? 'bg-blue-500 text-white' 
                    : 'bg-zinc-100 text-zinc-600 hover:bg-zinc-200'
                }`}
              >
                {incomeEditMode ? 'âœ“ ì™„ë£Œ' : 'âœï¸ í¸ì§‘'}
              </button>
            </div>
            <div className="space-y-2 text-xs">
              {(() => {
                const tableData = getEntityTableData().filter(row => row.entity !== 'ê¸°íƒ€');
                const totalCurr = tableData.reduce((sum, r) => sum + r.currVal, 0);
                const totalPrev = tableData.reduce((sum, r) => sum + r.prevVal, 0);
                const totalDiff = totalCurr - totalPrev;
                
                return tableData
                  .sort((a, b) => Math.abs(b.currVal - b.prevVal) - Math.abs(a.currVal - a.prevVal))
                  .map((row, idx) => {
                    const diff = row.currVal - row.prevVal;
                    const isPositive = diff >= 0;
                    const contribution = totalDiff !== 0 ? ((diff / Math.abs(totalDiff)) * 100).toFixed(0) : 0;
                    const diffBil = Math.round(diff / 100); // ì–µì› ë‹¨ìœ„
                    
                    // í¸ì§‘ëœ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê³„ì‚°ëœ ê°’ ì‚¬ìš©
                    const editKey = `${selectedAccount}_${row.entity}`;
                    const editedData = incomeEditData[editKey] || {};
                    const displayAmount = editedData.amount !== undefined ? editedData.amount : `${isPositive ? '+' : ''}${formatNumber(diffBil)}`;
                    const displayRate = editedData.rate !== undefined ? editedData.rate : row.change;
                    const displayContribution = editedData.contribution !== undefined ? editedData.contribution : contribution;
                    
                    const colorMap = {
                      'OC(êµ­ë‚´)': { bg: 'bg-blue-50/50', border: 'border-blue-400' },
                      'ì¤‘êµ­': { bg: 'bg-amber-50/50', border: 'border-amber-400' },
                      'í™ì½©': { bg: 'bg-violet-50/50', border: 'border-violet-400' },
                    };
                    const colors = colorMap[row.entity] || { bg: 'bg-zinc-50', border: 'border-zinc-300' };
                    
                    return (
                      <div key={idx} className={`p-2.5 ${colors.bg} rounded-lg border-l-2 ${colors.border}`}>
                        <div className="flex items-center justify-between">
                          <span className="font-medium text-zinc-800">{row.entity}</span>
                          {incomeEditMode ? (
                            <input
                              type="text"
                              value={displayRate}
                              onChange={(e) => setIncomeEditData(prev => ({
                                ...prev,
                                [editKey]: { ...prev[editKey], rate: e.target.value }
                              }))}
                              className="w-16 text-right text-xs font-bold px-1.5 py-0.5 rounded bg-white border border-zinc-300 focus:outline-none focus:ring-1 focus:ring-blue-400"
                            />
                          ) : (
                            <span className={`text-xs font-bold px-1.5 py-0.5 rounded ${parseFloat(displayRate) >= 0 ? 'bg-emerald-100 text-emerald-700' : 'bg-rose-100 text-rose-700'}`}>
                              {parseFloat(displayRate) >= 0 ? 'â–²' : 'â–¼'} {displayRate}%
                            </span>
                          )}
                        </div>
                        <div className="mt-1.5 flex items-center justify-between text-[11px]">
                          {incomeEditMode ? (
                            <input
                              type="text"
                              value={displayAmount}
                              onChange={(e) => setIncomeEditData(prev => ({
                                ...prev,
                                [editKey]: { ...prev[editKey], amount: e.target.value }
                              }))}
                              className="w-[100px] text-xs px-2 py-1 rounded bg-white border border-zinc-300 focus:outline-none focus:ring-1 focus:ring-blue-400"
                            />
                          ) : (
                            <span className="text-zinc-500">{displayAmount}ì–µì›</span>
                          )}
                          {incomeEditMode ? (
                            <input
                              type="text"
                              value={displayContribution}
                              onChange={(e) => setIncomeEditData(prev => ({
                                ...prev,
                                [editKey]: { ...prev[editKey], contribution: e.target.value }
                              }))}
                              className="w-12 text-right text-xs px-1 py-0.5 rounded bg-white border border-zinc-300 focus:outline-none focus:ring-1 focus:ring-blue-400"
                            />
                          ) : (
                            <span className="text-zinc-400">ê¸°ì—¬ë„ {displayContribution}%</span>
                          )}
                        </div>
                      </div>
                    );
                  });
              })()}
            </div>
            
            {/* ì „ì²´ ìš”ì•½ */}
            {(() => {
              const tableData = getEntityTableData();
              const totalCurr = tableData.reduce((sum, r) => sum + r.currVal, 0);
              const totalPrev = tableData.reduce((sum, r) => sum + r.prevVal, 0);
              const totalDiff = totalCurr - totalPrev;
              const totalDiffBil = Math.round(totalDiff / 100);
              const totalChange = totalPrev !== 0 ? ((totalDiff / totalPrev) * 100).toFixed(1) : 0;
              const isPositive = totalDiff >= 0;
              
              // í¸ì§‘ëœ ì „ì²´ ë°ì´í„°
              const totalEditKey = `${selectedAccount}_total`;
              const totalEdited = incomeEditData[totalEditKey] || {};
              const displayTotalAmount = totalEdited.amount !== undefined ? totalEdited.amount : `${isPositive ? '+' : ''}${formatNumber(totalDiffBil)}`;
              const displayTotalRate = totalEdited.rate !== undefined ? totalEdited.rate : `${isPositive ? '+' : ''}${totalChange}`;
              
              return (
                <div className="mt-3 pt-3 border-t border-zinc-200">
                  <div className="flex items-center justify-between text-xs">
                    <span className="text-zinc-600 font-medium">ì „ì²´ YoY ë³€ë™</span>
                    {incomeEditMode ? (
                      <div className="flex items-center gap-1">
                        <input
                          type="text"
                          value={displayTotalAmount}
                          onChange={(e) => setIncomeEditData(prev => ({
                            ...prev,
                            [totalEditKey]: { ...prev[totalEditKey], amount: e.target.value }
                          }))}
                          className="w-20 text-right text-xs font-bold px-1 py-0.5 rounded bg-white border border-zinc-300 focus:outline-none focus:ring-1 focus:ring-blue-400"
                        />
                        <span className="text-zinc-500">ì–µì› (</span>
                        <input
                          type="text"
                          value={displayTotalRate}
                          onChange={(e) => setIncomeEditData(prev => ({
                            ...prev,
                            [totalEditKey]: { ...prev[totalEditKey], rate: e.target.value }
                          }))}
                          className="w-14 text-right text-xs font-bold px-1 py-0.5 rounded bg-white border border-zinc-300 focus:outline-none focus:ring-1 focus:ring-blue-400"
                        />
                        <span className="text-zinc-500">%)</span>
                      </div>
                    ) : (
                      <span className={`font-bold ${parseFloat(displayTotalRate) >= 0 ? 'text-emerald-600' : 'text-rose-600'}`}>
                        {displayTotalAmount}ì–µì› ({displayTotalRate}%)
                      </span>
                    )}
                  </div>
                </div>
              );
            })()}
          </div>
        </div>
      </div>
    </div>
    );
  };

  // ============================================
  // ì¬ë¬´ìƒíƒœí‘œ íƒ­ ë Œë”ë§
  // ============================================
  const renderBalanceSheetTab = () => {
      // ìš´ì „ìë³¸ ê³„ì‚° (ë§¤ì¶œì±„ê¶Œ + ì¬ê³ ìì‚° - ë§¤ì…ì±„ë¬´)
    const calcWorkingCapital = (period) => {
      const bs = balanceSheetData[period];
      return (bs?.ë§¤ì¶œì±„ê¶Œ || 0) + (bs?.ì¬ê³ ìì‚° || 0) - (bs?.ë§¤ì…ì±„ë¬´ || 0);
    };

    // ROE ê³„ì‚° (ë‹¹ê¸°ìˆœì´ìµ / ìë³¸ì´ê³„ * 100)
    const calcROE = (period) => {
      const selectedQuarter = selectedPeriod.split('_')[1];
      const yearKey = getPeriodKey(selectedPeriod, 'year');
      const netIncome = incomeStatementData[yearKey]?.ë‹¹ê¸°ìˆœì´ìµ || 0;
      const equity = balanceSheetData[period]?.ìë³¸ì´ê³„ || 0;
      if (!equity || equity === 0) return 0;
      return ((netIncome / equity) * 100).toFixed(1);
    };

    // ì¡°ë‹¨ìœ„ í¬ë§· í•¨ìˆ˜ (ì–µì› ë‹¨ìœ„ ì…ë ¥ë°›ì•„ ì¡°ë‹¨ìœ„ í‘œê¸°)
    const formatTrilBil = (valueInBil) => {
      if (valueInBil === 0 || valueInBil === undefined || valueInBil === null) return '-';
      const absValue = Math.abs(valueInBil);
      const sign = valueInBil < 0 ? '-' : '';
      
      if (absValue >= 10000) {
        const tril = Math.floor(absValue / 10000);
        const bil = Math.round(absValue % 10000);
        return `${sign}${tril}ì¡° ${formatNumber(bil)}`;
      }
      return `${sign}${formatNumber(Math.round(absValue))}`;
    };

    // ìš”ì•½ ì¹´ë“œ ë°ì´í„° (ì–µì› ë‹¨ìœ„)
    const summaryCards = [
      { 
        title: 'ìì‚°ì´ê³„', 
        curr: (balanceSheetData[bsCurrentPeriod]?.ìì‚°ì´ê³„ || 0) / 100,
        prev: (balanceSheetData[bsPrevPeriod]?.ìì‚°ì´ê³„ || 0) / 100,
        unit: 'ì–µì›',
        useTril: true,
      },
      { 
        title: 'ìš´ì „ìë³¸', 
        curr: calcWorkingCapital(bsCurrentPeriod) / 100,
        prev: calcWorkingCapital(bsPrevPeriod) / 100,
        unit: 'ì–µì›',
        useTril: false,
      },
      { 
        title: 'ìë³¸ì´ê³„', 
        curr: (balanceSheetData[bsCurrentPeriod]?.ìë³¸ì´ê³„ || 0) / 100,
        prev: (balanceSheetData[bsPrevPeriod]?.ìë³¸ì´ê³„ || 0) / 100,
        unit: 'ì–µì›',
        useTril: true,
      },
      { 
        title: 'ROE', 
        curr: calcROE(bsCurrentPeriod),
        prev: calcROE(bsPrevPeriod),
        isRatio: true,
      },
    ];

    // ì¬ë¬´ìƒíƒœí‘œ í•­ëª© (ì„±ê²©ë³„ ë¶„ë¥˜ - ìœ ë™/ë¹„ìœ ë™ í†µí•©)
    const balanceItems = [
      // ìì‚°
      { key: 'í˜„ê¸ˆì„±ìì‚°', label: 'í˜„ê¸ˆì„±ìì‚°', depth: 1, selectable: true },
      { key: 'ê¸ˆìœµìƒí’ˆ', label: 'ê¸ˆìœµìƒí’ˆ', depth: 1 },
      { key: 'ë§¤ì¶œì±„ê¶Œ', label: 'ë§¤ì¶œì±„ê¶Œ', depth: 1, selectable: true },
      { key: 'ì¬ê³ ìì‚°', label: 'ì¬ê³ ìì‚°', depth: 1, selectable: true },
      { key: 'ê´€ê³„ê¸°ì—…íˆ¬ì', label: 'ê´€ê³„ê¸°ì—…íˆ¬ì', depth: 1 },
      { key: 'ìœ ë¬´í˜•ìì‚°', label: 'ìœ Â·ë¬´í˜•ìì‚°', depth: 1, selectable: true },
      { key: 'ì‚¬ìš©ê¶Œìì‚°', label: 'ì‚¬ìš©ê¶Œìì‚°', depth: 1, selectable: true },
      { key: 'ê¸°íƒ€ìì‚°', label: 'ê¸°íƒ€ìì‚°', depth: 1 },
      { key: 'ìì‚°ì´ê³„', label: 'ìì‚°ì´ê³„', bold: true, highlight: 'blue' },
      // ë¶€ì±„
      { key: 'ì°¨ì…ê¸ˆ', label: 'ì°¨ì…ê¸ˆ', depth: 1, selectable: true },
      { key: 'ë§¤ì…ì±„ë¬´', label: 'ë§¤ì…ì±„ë¬´', depth: 1, selectable: true },
      { key: 'ë¯¸ì§€ê¸‰ê¸ˆ', label: 'ë¯¸ì§€ê¸‰ê¸ˆ', depth: 1 },
      { key: 'ë¦¬ìŠ¤ë¶€ì±„', label: 'ë¦¬ìŠ¤ë¶€ì±„', depth: 1 },
      { key: 'ë³´ì¦ê¸ˆ', label: 'ë³´ì¦ê¸ˆ', depth: 1 },
      { key: 'ê¸°íƒ€ë¶€ì±„', label: 'ê¸°íƒ€ë¶€ì±„', depth: 1 },
      { key: 'ë¶€ì±„ì´ê³„', label: 'ë¶€ì±„ì´ê³„', bold: true, highlight: 'red' },
      // ìë³¸ (ì´ê³„ë§Œ)
      { key: 'ìë³¸ì´ê³„', label: 'ìë³¸ì´ê³„', bold: true, highlight: 'green' },
    ];

    // ë²•ì¸ë³„ ë°ì´í„°ëŠ” ì»´í¬ë„ŒíŠ¸ ìƒìœ„ ë ˆë²¨ì—ì„œ ì •ì˜ë¨ (entityBSData)
    // ì•„ë˜ ì¤‘ë³µ ì •ì˜ëŠ” ì œê±°ë¨ - ìƒìœ„ ë ˆë²¨ì˜ entityBSData ì‚¬ìš©

    // ë¶„ê¸°ë³„ ë²•ì¸ë³„ ì¶”ì´ ë°ì´í„° (24.1Q ~ 25.4Q)
    const quarterlyEntityData = {
      í˜„ê¸ˆì„±ìì‚°: [
        { quarter: '24.1Q', 'OC(êµ­ë‚´)': 291693, ì¤‘êµ­: 12162, ê¸°íƒ€: 30852 },
        { quarter: '24.2Q', 'OC(êµ­ë‚´)': 161519, ì¤‘êµ­: 27175, ê¸°íƒ€: 31918 },
        { quarter: '24.3Q', 'OC(êµ­ë‚´)': 142325, ì¤‘êµ­: 24304, ê¸°íƒ€: 27134 },
        { quarter: '24.4Q', 'OC(êµ­ë‚´)': 61500, ì¤‘êµ­: 29229, ê¸°íƒ€: 32444 },
        { quarter: '25.1Q', 'OC(êµ­ë‚´)': 79496, ì¤‘êµ­: 60404, ê¸°íƒ€: 24144 },
        { quarter: '25.2Q', 'OC(êµ­ë‚´)': 88735, ì¤‘êµ­: 20311, ê¸°íƒ€: 17394 },
        { quarter: '25.3Q', 'OC(êµ­ë‚´)': 182075, ì¤‘êµ­: 9318, ê¸°íƒ€: 16892 },
      ],
      ë§¤ì¶œì±„ê¶Œ: [
        { quarter: '24.1Q', 'OC(êµ­ë‚´)': 109224, ì¤‘êµ­: 7225, ê¸°íƒ€: 11233 },
        { quarter: '24.2Q', 'OC(êµ­ë‚´)': 91507, ì¤‘êµ­: 7183, ê¸°íƒ€: 11546 },
        { quarter: '24.3Q', 'OC(êµ­ë‚´)': 137912, ì¤‘êµ­: 81857, ê¸°íƒ€: 15304 },
        { quarter: '24.4Q', 'OC(êµ­ë‚´)': 134453, ì¤‘êµ­: 40081, ê¸°íƒ€: 18050 },
        { quarter: '25.1Q', 'OC(êµ­ë‚´)': 123193, ì¤‘êµ­: 20896, ê¸°íƒ€: 11603 },
        { quarter: '25.2Q', 'OC(êµ­ë‚´)': 81953, ì¤‘êµ­: 8793, ê¸°íƒ€: 11029 },
        { quarter: '25.3Q', 'OC(êµ­ë‚´)': 205309, ì¤‘êµ­: 97531, ê¸°íƒ€: 19691 },
      ],
      ì¬ê³ ìì‚°: [
        { quarter: '24.1Q', 'OC(êµ­ë‚´)': 232095, ì¤‘êµ­: 136110, ê¸°íƒ€: 37423 },
        { quarter: '24.2Q', 'OC(êµ­ë‚´)': 207444, ì¤‘êµ­: 115040, ê¸°íƒ€: 35388 },
        { quarter: '24.3Q', 'OC(êµ­ë‚´)': 247068, ì¤‘êµ­: 174481, ê¸°íƒ€: 39236 },
        { quarter: '24.4Q', 'OC(êµ­ë‚´)': 214281, ì¤‘êµ­: 141223, ê¸°íƒ€: 43928 },
        { quarter: '25.1Q', 'OC(êµ­ë‚´)': 214607, ì¤‘êµ­: 123617, ê¸°íƒ€: 43546 },
        { quarter: '25.2Q', 'OC(êµ­ë‚´)': 199308, ì¤‘êµ­: 113822, ê¸°íƒ€: 38577 },
        { quarter: '25.3Q', 'OC(êµ­ë‚´)': 242024, ì¤‘êµ­: 281973, ê¸°íƒ€: 46723 },
      ],
      ìœ ë¬´í˜•ìì‚°: [
        { quarter: '24.1Q', 'OC(êµ­ë‚´)': 197870, ì¤‘êµ­: 9894, ê¸°íƒ€: 68713 },
        { quarter: '24.2Q', 'OC(êµ­ë‚´)': 251498, ì¤‘êµ­: 10189, ê¸°íƒ€: 70542 },
        { quarter: '24.3Q', 'OC(êµ­ë‚´)': 345549, ì¤‘êµ­: 9901, ê¸°íƒ€: 66407 },
        { quarter: '24.4Q', 'OC(êµ­ë‚´)': 609769, ì¤‘êµ­: 10416, ê¸°íƒ€: 73425 },
        { quarter: '25.1Q', 'OC(êµ­ë‚´)': 611019, ì¤‘êµ­: 9130, ê¸°íƒ€: 72558 },
        { quarter: '25.2Q', 'OC(êµ­ë‚´)': 607960, ì¤‘êµ­: 7699, ê¸°íƒ€: 67842 },
        { quarter: '25.3Q', 'OC(êµ­ë‚´)': 605413, ì¤‘êµ­: 8114, ê¸°íƒ€: 71004 },
      ],
      ì‚¬ìš©ê¶Œìì‚°: [
        { quarter: '24.1Q', 'OC(êµ­ë‚´)': 182423, ì¤‘êµ­: 62091, ê¸°íƒ€: 41112 },
        { quarter: '24.2Q', 'OC(êµ­ë‚´)': 181318, ì¤‘êµ­: 73343, ê¸°íƒ€: 40874 },
        { quarter: '24.3Q', 'OC(êµ­ë‚´)': 185625, ì¤‘êµ­: 77192, ê¸°íƒ€: 42094 },
        { quarter: '24.4Q', 'OC(êµ­ë‚´)': 183782, ì¤‘êµ­: 93085, ê¸°íƒ€: 48578 },
        { quarter: '25.1Q', 'OC(êµ­ë‚´)': 187827, ì¤‘êµ­: 64626, ê¸°íƒ€: 33029 },
        { quarter: '25.2Q', 'OC(êµ­ë‚´)': 188380, ì¤‘êµ­: 54824, ê¸°íƒ€: 29404 },
        { quarter: '25.3Q', 'OC(êµ­ë‚´)': 186612, ì¤‘êµ­: 56782, ê¸°íƒ€: 42060 },
      ],
      ì°¨ì…ê¸ˆ: [
        { quarter: '24.1Q', 'OC(êµ­ë‚´)': 0, ì¤‘êµ­: 72442, ê¸°íƒ€: 19871 },
        { quarter: '24.2Q', 'OC(êµ­ë‚´)': 0, ì¤‘êµ­: 0, ê¸°íƒ€: 20260 },
        { quarter: '24.3Q', 'OC(êµ­ë‚´)': 0, ì¤‘êµ­: 86820, ê¸°íƒ€: 26418 },
        { quarter: '24.4Q', 'OC(êµ­ë‚´)': 45000, ì¤‘êµ­: 100635, ê¸°íƒ€: 33248 },
        { quarter: '25.1Q', 'OC(êµ­ë‚´)': 20000, ì¤‘êµ­: 56470, ê¸°íƒ€: 40635 },
        { quarter: '25.2Q', 'OC(êµ­ë‚´)': 0, ì¤‘êµ­: 32157, ê¸°íƒ€: 41841 },
        { quarter: '25.3Q', 'OC(êµ­ë‚´)': 0, ì¤‘êµ­: 160605, ê¸°íƒ€: 49840 },
      ],
      ë§¤ì…ì±„ë¬´: [
        { quarter: '24.1Q', 'OC(êµ­ë‚´)': 69104, ì¤‘êµ­: 5104, ê¸°íƒ€: 46999 },
        { quarter: '24.2Q', 'OC(êµ­ë‚´)': 48681, ì¤‘êµ­: 1415, ê¸°íƒ€: 46111 },
        { quarter: '24.3Q', 'OC(êµ­ë‚´)': 115166, ì¤‘êµ­: 63397, ê¸°íƒ€: 45417 },
        { quarter: '24.4Q', 'OC(êµ­ë‚´)': 79795, ì¤‘êµ­: 17885, ê¸°íƒ€: 53121 },
        { quarter: '25.1Q', 'OC(êµ­ë‚´)': 69813, ì¤‘êµ­: 28622, ê¸°íƒ€: 47991 },
        { quarter: '25.2Q', 'OC(êµ­ë‚´)': 53644, ì¤‘êµ­: 10263, ê¸°íƒ€: 43041 },
        { quarter: '25.3Q', 'OC(êµ­ë‚´)': 139941, ì¤‘êµ­: 131315, ê¸°íƒ€: 50833 },
      ],
    };

    const entityColors = {
      'OC(êµ­ë‚´)': '#3B82F6',
      ì¤‘êµ­: '#F59E0B',
      í™ì½©: '#8B5CF6',
      STë¯¸êµ­: '#10B981',
      ì—°ê²°ì¡°ì •: '#9CA3AF',
      'ê¸°íƒ€(ì—°ê²°ì¡°ì •)': '#6B7280',
    };

    // ì¶”ì´ ê·¸ë˜í”„ìš© ìƒ‰ìƒ
    const trendColors = {
      'OC(êµ­ë‚´)': '#3B82F6',
      ì¤‘êµ­: '#F59E0B',
      ê¸°íƒ€: '#8B5CF6',
    };

    // ============================================
    // ì¬ë¬´ìƒíƒœí‘œ ë²•ì¸ë³„ ë¶„ì„ ë°ì´í„° ì •í•©ì„± ë³´ì •
    // - entityBSDataëŠ” ì—°ê²°ì¡°ì • ì „ ë²•ì¸ë³„ í•©ì‚°ì´ë¼ ì—°ê²°(BS) í•©ê³„ì™€ ë¶ˆì¼ì¹˜ ê°€ëŠ¥
    // - ì„ íƒ ê³„ì •/ê¸°ê°„ì˜ ì—°ê²° ê¸ˆì•¡(balanceSheetData)ì„ ê¸°ì¤€ìœ¼ë¡œ
    //   1) base(ë²•ì¸ë³„ í•©ì‚°) ìŠ¤ì¼€ì¼ë§
    //   2) ì°¨ì´ëŠ” 'ì—°ê²°ì¡°ì •' í•­ëª©ìœ¼ë¡œ ë³´ì •
    // ============================================
    const getBSConsolidatedTotal = (accountKey, period) => {
      const v = balanceSheetData?.[period]?.[accountKey];
      return typeof v === 'number' ? v : 0;
    };

    const getBaseBSBreakdown = (accountKey, period) => {
      const p = entityBSData?.[period];
      if (!p) return {};
      return p[accountKey] || p['ìì‚°ì´ê³„'] || {};
    };

    const getAlignedBSBreakdown = (accountKey, period) => {
      const consolidatedTotal = getBSConsolidatedTotal(accountKey, period);
      const base = getBaseBSBreakdown(accountKey, period);
      const baseKeys = Object.keys(base);

      if (baseKeys.length === 0) {
        return { ì—°ê²°ì¡°ì •: consolidatedTotal };
      }

      const baseSum = baseKeys.reduce((sum, k) => sum + (base[k] || 0), 0);
      if (baseSum === 0) {
        return { ...base, ì—°ê²°ì¡°ì •: consolidatedTotal };
      }

      const scale = consolidatedTotal / baseSum;
      const scaled = {};
      for (const k of baseKeys) {
        scaled[k] = Math.round((base[k] || 0) * scale);
      }

      const scaledSum = Object.values(scaled).reduce((sum, v) => sum + (v || 0), 0);
      const adjustment = consolidatedTotal - scaledSum;
      return { ...scaled, ì—°ê²°ì¡°ì •: adjustment };
    };

    // í‘œì‹œìš© ê·¸ë£¹í•‘: ë¹„ì¤‘ì´ ì‘ì€ ë²•ì¸ + ì—°ê²°ì¡°ì •ì„ 'ê¸°íƒ€(ì—°ê²°ì¡°ì •)'ë¡œ í•©ì‚°
    const BS_MINOR_ENTITY_RATIO_THRESHOLD = 0.03; // 3% ë¯¸ë§Œì€ ê¸°íƒ€ë¡œ í•©ì‚°
    const BS_MERGED_ENTITY_LABEL = 'ê¸°íƒ€(ì—°ê²°ì¡°ì •)';
    const BS_MAJOR_ENTITIES = ['OC(êµ­ë‚´)', 'ì¤‘êµ­'];

    // ë‹¨ì¼ ê¸°ê°„ìš© (ë„ë„› ì°¨íŠ¸ ë“±)
    const getGroupedBSBreakdown = (accountKey, period) => {
      return getGroupedBSBreakdownForComparison(accountKey, period, period);
    };

    // ë¹„êµìš©: ì „ê¸°/ë‹¹ê¸° ë‘˜ ë‹¤ë¥¼ ê³ ë ¤í•˜ì—¬, í•œ ê¸°ê°„ì´ë¼ë„ ìœ ì˜ë¯¸í•˜ë©´ ê°œë³„ë¡œ ìœ ì§€
    const getGroupedBSBreakdownForComparison = (accountKey, prevPeriod, currPeriod) => {
      const totalCurr = getBSConsolidatedTotal(accountKey, currPeriod);
      const totalPrev = getBSConsolidatedTotal(accountKey, prevPeriod);
      const alignedCurr = getAlignedBSBreakdown(accountKey, currPeriod);
      const alignedPrev = getAlignedBSBreakdown(accountKey, prevPeriod);

      // ì „ê¸°/ë‹¹ê¸° ëª¨ë‘ì˜ í‚¤ë¥¼ í•©ì§‘í•©ìœ¼ë¡œ ìˆ˜ì§‘
      const allKeys = Array.from(new Set([...Object.keys(alignedPrev), ...Object.keys(alignedCurr)]));

      const grouped = {};
      const entitiesToKeep = new Set();

      // 1. OC(êµ­ë‚´), ì¤‘êµ­ì€ í•­ìƒ ìœ ì§€
      BS_MAJOR_ENTITIES.forEach(entity => {
        if (allKeys.includes(entity)) {
          entitiesToKeep.add(entity);
        }
      });

      // 2. ì „ê¸°ë‚˜ ë‹¹ê¸° ì¤‘ í•˜ë‚˜ë¼ë„ ë°ì´í„°ê°€ ìˆê³ , ê·¸ ê¸°ê°„ì˜ ë¹„ì¤‘ì´ 3% ì´ìƒì´ë©´ ê°œë³„ë¡œ ìœ ì§€
      for (const name of allKeys) {
        if (BS_MAJOR_ENTITIES.includes(name) || name === 'ì—°ê²°ì¡°ì •' || name === 'ê¸°íƒ€') continue;

        const prevVal = alignedPrev[name] || 0;
        const currVal = alignedCurr[name] || 0;
        
        const prevRatio = totalPrev !== 0 ? Math.abs(prevVal) / Math.abs(totalPrev) : 0;
        const currRatio = totalCurr !== 0 ? Math.abs(currVal) / Math.abs(totalCurr) : 0;

        // ì „ê¸°ë‚˜ ë‹¹ê¸° ì¤‘ í•˜ë‚˜ë¼ë„ ë°ì´í„°ê°€ ìˆê³ , ê·¸ ê¸°ê°„ì˜ ë¹„ì¤‘ì´ 3% ì´ìƒì´ë©´ ê°œë³„ ìœ ì§€
        const hasDataInEitherPeriod = prevVal !== 0 || currVal !== 0;
        const isSignificantInEitherPeriod = prevRatio >= BS_MINOR_ENTITY_RATIO_THRESHOLD || currRatio >= BS_MINOR_ENTITY_RATIO_THRESHOLD;

        if (hasDataInEitherPeriod && isSignificantInEitherPeriod) {
          entitiesToKeep.add(name);
        }
      }

      // 3. ìœ ì§€í•  ë²•ì¸ë“¤ì„ groupedì— ì¶”ê°€ (ë‹¹ê¸° ê°’ì„ ì‚¬ìš©)
      entitiesToKeep.forEach(name => {
        grouped[name] = alignedCurr[name] || 0;
      });

      // 4. ë‚˜ë¨¸ì§€ëŠ” ê¸°íƒ€(ì—°ê²°ì¡°ì •)ë¡œ í¡ìˆ˜ (í•©ê³„ ì •í•©ì„± ë³´ì¥)
      const keptSum = Object.values(grouped).reduce((s, v) => s + (v || 0), 0);
      grouped[BS_MERGED_ENTITY_LABEL] = totalCurr - keptSum;

      return grouped;
    };

    // ë„ë„› ì°¨íŠ¸ ë°ì´í„° ìƒì„± í•¨ìˆ˜
    const getBSDonutData = (period) => {
      const accountData = getGroupedBSBreakdown(selectedBSAccount, period);
      const total = getBSConsolidatedTotal(selectedBSAccount, period);
      if (!accountData || total === 0) return [];

      return Object.entries(accountData)
        .map(([name, value]) => ({
          name,
          value: Math.abs(value),      // ì°¨íŠ¸ í‘œì‹œìš©(ì ˆëŒ€ê°’)
          valueRaw: value || 0,        // í…Œì´ë¸” í‘œì‹œìš©(ì›ê°’)
          ratio: total !== 0 ? ((Math.abs(value) / Math.abs(total)) * 100).toFixed(1) : '0.0',
          color:
            name === BS_MERGED_ENTITY_LABEL
              ? '#6B7280'
              : (entityColors[name] || '#9CA3AF'),
        }))
        .filter((item) => item.value > 0);
    };

    // ë„ë„› ì°¨íŠ¸ ë°ì´í„° ë¯¸ë¦¬ ê³„ì‚°
    const donutData2024 = getBSDonutData(bsPrevPeriod);
    const donutData2025 = getBSDonutData(bsCurrentPeriod);

    return (
      <div className="space-y-4">
        {/* ìš”ì•½ ì¹´ë“œ ì„¹ì…˜ */}
        <div className="grid grid-cols-4 gap-3">
          {summaryCards.map((card, idx) => {
            const curr = parseFloat(card.curr) || 0;
            const prev = parseFloat(card.prev) || 0;
            const diff = curr - prev;
            const changeRate = prev !== 0 ? ((curr - prev) / Math.abs(prev) * 100).toFixed(1) : '-';
            const isPositive = parseFloat(changeRate) >= 0;
            
            return (
              <div 
                key={idx}
                className="bg-white rounded-lg border border-zinc-200 shadow-sm p-4 hover:shadow-md transition-all duration-200"
              >
                <div className="flex items-center justify-between mb-3">
                  <span className="text-xs font-medium text-zinc-500 uppercase tracking-wide">{card.title}</span>
                  <span className={`text-xs font-semibold px-2 py-0.5 rounded ${
                    isPositive ? 'bg-emerald-50 text-emerald-600' : 'bg-rose-50 text-rose-600'
                  }`}>
                    {changeRate !== '-' ? `${isPositive ? '+' : ''}${changeRate}%` : '-'}
                  </span>
                </div>
                
                <div className="text-2xl font-bold text-zinc-900 tracking-tight">
                  {card.isRatio ? `${curr}%` : (card.useTril ? formatTrilBil(curr) : formatNumber(Math.round(curr)))}
                  {card.unit && <span className="text-sm font-normal text-zinc-500 ml-1">{card.unit}</span>}
                </div>
                
                <div className="flex items-center gap-2 mt-1 text-xs">
                  <span className="text-zinc-400">
                    ì „ë…„ {card.isRatio ? `${prev}%` : `${card.useTril ? formatTrilBil(prev) : formatNumber(Math.round(prev))}${card.unit || ''}`}
                  </span>
                  {!card.isRatio && (
                    <span className={`font-semibold ${isPositive ? 'text-emerald-600' : 'text-rose-600'}`}>
                      {isPositive ? '+' : ''}{formatNumber(Math.round(diff))}{card.unit || 'ì–µì›'}
                    </span>
                  )}
                </div>
              </div>
            );
          })}
        </div>

        {/* ì¬ë¬´ìƒíƒœí‘œ í…Œì´ë¸” & ë²•ì¸ë³„ ë¶„ì„ */}
        <div className="flex flex-col xl:flex-row gap-4">
          {/* ì¢Œì¸¡: ì¬ë¬´ìƒíƒœí‘œ í…Œì´ë¸” */}
          <div className="flex-1 min-w-0">
            <div className="bg-white rounded-lg border border-zinc-200 shadow-sm overflow-hidden">
              <div className="px-4 py-3 border-b border-zinc-200 bg-zinc-50">
                <h3 className="text-sm font-semibold text-zinc-900">ì—°ê²° ì¬ë¬´ìƒíƒœí‘œ</h3>
              </div>
              <div className="overflow-x-auto">
                <table className="w-full text-sm">
                  <thead>
                    <tr className="bg-zinc-50 border-b border-zinc-200">
                      <th className="text-left px-3 py-2.5 font-semibold text-zinc-700 border-r border-zinc-200 min-w-[175px]">ê³¼ëª©</th>
                      <th className="text-center px-3 py-2 font-semibold text-zinc-600 border-r border-zinc-200 min-w-[95px]">2024.4Q</th>
                      <th className="text-center px-3 py-2 font-semibold text-zinc-900 border-r border-zinc-200 bg-zinc-100 min-w-[95px]">
                        {(() => {
                          const [yearStr, qStr] = selectedPeriod.split('_');
                          const quarterNum = (qStr || 'Q4').replace('Q', '');
                          return `${yearStr}.${quarterNum}Q`;
                        })()}
                      </th>
                      <th className="text-center px-3 py-2 font-semibold text-zinc-600 border-r border-zinc-200 min-w-[90px]">ì¦ê°ì•¡</th>
                      <th className="text-center px-3 py-2 font-semibold text-zinc-600 min-w-[70px]">ì¦ê°ë¥ </th>
                    </tr>
                  </thead>
                  <tbody>
                    {balanceItems.map((item, idx) => {
                      const val2024 = balanceSheetData[bsPrevPeriod]?.[item.key] || 0;
                      const val2025 = balanceSheetData[bsCurrentPeriod]?.[item.key] || 0;
                      const diff = val2025 - val2024;
                      const change = calculateYoY(val2025, val2024);
                      
                      const highlightClass = item.highlight === 'blue' ? 'bg-blue-50/50' 
                        : item.highlight === 'green' ? 'bg-emerald-50/50' 
                        : item.highlight === 'red' ? 'bg-rose-50/50' 
                        : '';
                      const selectableClass = item.selectable ? 'cursor-pointer hover:bg-zinc-100' : '';
                      const isSelected = selectedBSAccount === item.key;
                      const selectedClass = isSelected ? 'bg-zinc-100 ring-1 ring-zinc-300 ring-inset' : '';
                      
                      return (
                        <tr 
                          key={idx} 
                          className={`border-b border-zinc-100 ${highlightClass} ${selectableClass} ${selectedClass}`}
                          onClick={() => item.selectable && setSelectedBSAccount(item.key)}
                        >
                          <td className={`px-3 py-2 border-r border-zinc-200 ${item.bold ? 'font-semibold text-zinc-900' : 'text-zinc-600'} ${item.depth === 1 ? 'pl-6' : ''}`}>
                            {item.label}
                          </td>
                          <td className="text-right px-3 py-2 text-zinc-500 border-r border-zinc-200 tabular-nums">{formatNumber(val2024)}</td>
                          <td className={`text-right px-3 py-2 border-r border-zinc-200 tabular-nums ${item.bold ? 'font-semibold text-zinc-900' : 'text-zinc-700'}`}>{formatNumber(val2025)}</td>
                          <td className={`text-right px-3 py-2 font-medium border-r border-zinc-200 tabular-nums ${diff >= 0 ? 'text-emerald-600' : 'text-rose-600'}`}>
                            {diff !== 0 ? formatNumber(diff) : '-'}
                          </td>
                          <td className={`text-right px-3 py-2 font-medium tabular-nums ${parseFloat(change) >= 0 ? 'text-emerald-600' : 'text-rose-600'}`}>
                            {change !== '-' ? `${change}%` : '-'}
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              </div>
            </div>

            {/* ë¶„ê¸°ë³„ ë²•ì¸ë³„ ì¶”ì´ ê·¸ë˜í”„ */}
            {balanceItems.find(i => i.key === selectedBSAccount)?.selectable && quarterlyEntityData[selectedBSAccount] && (
              <div className="bg-white rounded-lg border border-zinc-200 shadow-sm p-4 mt-4">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-sm font-semibold text-zinc-900">
                    {balanceItems.find(i => i.key === selectedBSAccount)?.label || selectedBSAccount} ë¶„ê¸°ë³„ ì¶”ì´
                  </h3>
                  <div className="flex items-center gap-4">
                    {Object.entries(trendColors).map(([name, color]) => (
                      <div key={name} className="flex items-center gap-1.5">
                        <span className="w-3 h-0.5 rounded" style={{ backgroundColor: color }}></span>
                        <span className="text-xs text-zinc-500">{name}</span>
                      </div>
                    ))}
                  </div>
                </div>
                <div style={{ height: 220 }}>
                  <ResponsiveContainer width="100%" height="100%">
                    <LineChart data={quarterlyEntityData[selectedBSAccount]} margin={{ top: 5, right: 20, left: 10, bottom: 5 }}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#e5e7eb" />
                      <XAxis 
                        dataKey="quarter" 
                        tick={{ fontSize: 11, fill: '#6b7280' }}
                        axisLine={{ stroke: '#d1d5db' }}
                        tickLine={{ stroke: '#d1d5db' }}
                      />
                      <YAxis 
                        tick={{ fontSize: 10, fill: '#6b7280' }}
                        axisLine={{ stroke: '#d1d5db' }}
                        tickLine={{ stroke: '#d1d5db' }}
                        tickFormatter={(value) => value >= 1000 ? `${(value / 1000).toFixed(0)}K` : value}
                      />
                      <Tooltip 
                        content={({ active, payload, label }) => {
                          if (active && payload && payload.length) {
                            return (
                              <div className="bg-white/95 backdrop-blur-sm border border-zinc-200 rounded-lg shadow-lg px-3 py-2.5 min-w-[130px]">
                                <p className="text-xs font-medium text-zinc-500 mb-1.5 pb-1.5 border-b border-zinc-100">{label}</p>
                                <div className="space-y-1">
                                  {payload.map((entry, index) => (
                                    <div key={index} className="flex items-center justify-between gap-3">
                                      <div className="flex items-center gap-1.5">
                                        <span className="w-2 h-2 rounded-full flex-shrink-0" style={{ backgroundColor: entry.color }} />
                                        <span className="text-xs text-zinc-600">{entry.dataKey}</span>
                                      </div>
                                      <span className="text-xs font-semibold text-zinc-900">{formatNumber(entry.value)}</span>
                                    </div>
                                  ))}
                                </div>
                              </div>
                            );
                          }
                          return null;
                        }}
                      />
                      <Line 
                        type="monotone" 
                        dataKey="OC(êµ­ë‚´)" 
                        stroke={trendColors['OC(êµ­ë‚´)']} 
                        strokeWidth={2.5}
                        dot={{ r: 4, fill: trendColors['OC(êµ­ë‚´)'], strokeWidth: 0 }}
                        activeDot={{ r: 6, strokeWidth: 2, stroke: '#fff' }}
                      />
                      <Line 
                        type="monotone" 
                        dataKey="ì¤‘êµ­" 
                        stroke={trendColors['ì¤‘êµ­']} 
                        strokeWidth={2.5}
                        dot={{ r: 4, fill: trendColors['ì¤‘êµ­'], strokeWidth: 0 }}
                        activeDot={{ r: 6, strokeWidth: 2, stroke: '#fff' }}
                      />
                      <Line 
                        type="monotone" 
                        dataKey="ê¸°íƒ€" 
                        stroke={trendColors['ê¸°íƒ€']} 
                        strokeWidth={2.5}
                        dot={{ r: 4, fill: trendColors['ê¸°íƒ€'], strokeWidth: 0 }}
                        activeDot={{ r: 6, strokeWidth: 2, stroke: '#fff' }}
                      />
                    </LineChart>
                  </ResponsiveContainer>
                </div>
                <p className="text-xs text-zinc-400 mt-2 text-center">* ê¸°íƒ€ = í™ì½© + STë¯¸êµ­</p>
              </div>
            )}
          </div>

          {/* ìš°ì¸¡: ë²•ì¸ë³„ ë¶„ì„ */}
          <div className="w-full xl:w-[360px] flex-shrink-0 space-y-3">
            {/* ë²•ì¸ë³„ ë¶„ì„ í—¤ë” */}
            <div className="bg-white rounded-lg border border-zinc-200 shadow-sm p-4">
              <h3 className="text-sm font-semibold text-zinc-900 mb-0.5">
                {balanceItems.find(i => i.key === selectedBSAccount)?.label || selectedBSAccount} ë²•ì¸ë³„ ë¶„ì„
              </h3>
              <p className="text-xs text-zinc-400">ê¸°ë§ ê¸°ì¤€ ë²•ì¸ë³„ ë¹„ì¤‘</p>
              
              {/* ë„ë„› ì°¨íŠ¸ ì˜ì—­ */}
              <div className="flex justify-around mt-4">
                {/* 2024ë…„ ë„ë„› */}
                <div className="text-center">
                  <p className="text-xs font-medium text-zinc-500 mb-2">2024.4Q</p>
                  <div style={{ width: 120, height: 120 }}>
                    {donutData2024.length > 0 ? (
                      <PieChart width={120} height={120}>
                        <Pie
                          data={donutData2024}
                          cx={60}
                          cy={60}
                          innerRadius={30}
                          outerRadius={50}
                          paddingAngle={2}
                          dataKey="value"
                        >
                          {donutData2024.map((entry, index) => (
                            <Cell key={`cell-2024-${index}`} fill={entry.color} />
                          ))}
                        </Pie>
                        <Tooltip content={<CustomPieTooltip formatter={(value) => `${formatNumber(value)} ë°±ë§Œì›`} />} />
                      </PieChart>
                    ) : (
                      <div className="w-full h-full flex items-center justify-center text-zinc-400 text-xs">ë°ì´í„° ì—†ìŒ</div>
                    )}
                  </div>
                </div>
                {/* 2025ë…„ ë„ë„› */}
                <div className="text-center">
                  <p className="text-xs font-medium text-zinc-500 mb-2">
                    {(() => {
                      const [yearStr, qStr] = selectedPeriod.split('_');
                      const quarterNum = (qStr || 'Q4').replace('Q', '');
                      return `${yearStr}.${quarterNum}Q`;
                    })()}
                  </p>
                  <div style={{ width: 120, height: 120 }}>
                    {donutData2025.length > 0 ? (
                      <PieChart width={120} height={120}>
                        <Pie
                          data={donutData2025}
                          cx={60}
                          cy={60}
                          innerRadius={30}
                          outerRadius={50}
                          paddingAngle={2}
                          dataKey="value"
                        >
                          {donutData2025.map((entry, index) => (
                            <Cell key={`cell-2025-${index}`} fill={entry.color} />
                          ))}
                        </Pie>
                        <Tooltip content={<CustomPieTooltip formatter={(value) => `${formatNumber(value)} ë°±ë§Œì›`} />} />
                      </PieChart>
                    ) : (
                      <div className="w-full h-full flex items-center justify-center text-zinc-400 text-xs">ë°ì´í„° ì—†ìŒ</div>
                    )}
                  </div>
                </div>
              </div>
              
              {/* ë²”ë¡€ */}
              <div className="flex flex-wrap justify-center gap-3 mt-3">
                {Object.entries(entityColors).map(([name, color]) => (
                  <div key={name} className="flex items-center gap-1.5">
                    <span className="w-2.5 h-2.5 rounded-full" style={{ backgroundColor: color }}></span>
                    <span className="text-xs text-zinc-600">{name}</span>
                  </div>
                ))}
              </div>
            </div>

            {/* ë²•ì¸ë³„ í…Œì´ë¸” */}
            <div className="bg-white rounded-lg border border-zinc-200 shadow-sm overflow-hidden">
              <table className="w-full text-sm">
                <thead>
                  <tr className="bg-zinc-50 border-b border-zinc-200">
                    <th className="text-left px-3 py-2 font-semibold text-zinc-600 min-w-[80px] whitespace-nowrap">ë²•ì¸</th>
                    <th className="text-right px-2 py-2 font-semibold text-zinc-600 min-w-[85px]">2024</th>
                    <th className="text-right px-2 py-2 font-semibold text-zinc-600 min-w-[85px]">2025</th>
                    <th className="text-right px-2 py-2 font-semibold text-zinc-600 min-w-[55px]">ë¹„ì¤‘</th>
                    <th className="text-right px-3 py-2 font-semibold text-zinc-600 min-w-[70px] whitespace-nowrap">YoY</th>
                  </tr>
                </thead>
                <tbody>
                  {donutData2025.map((entity, idx) => {
                    const prev = donutData2024.find(e => e.name === entity.name)?.valueRaw ?? donutData2024.find(e => e.name === entity.name)?.value ?? 0;
                    const curr = entity.valueRaw ?? entity.value;
                    const yoy = prev !== 0 ? ((curr - prev) / prev * 100).toFixed(1) : '-';
                    const isPositive = parseFloat(yoy) >= 0;
                    
                    return (
                      <tr key={idx} className="border-b border-zinc-100">
                        <td className="px-3 py-2 text-zinc-700 whitespace-nowrap">
                          <span className="inline-block w-2 h-2 rounded-full mr-1.5" style={{ backgroundColor: entity.color }}></span>
                          {entity.name}
                        </td>
                        <td className="text-right px-2 py-2 text-zinc-500 tabular-nums">{formatNumber(prev)}</td>
                        <td className="text-right px-2 py-2 font-medium text-zinc-900 tabular-nums">{formatNumber(curr)}</td>
                        <td className="text-right px-2 py-2 text-zinc-600 tabular-nums">{entity.ratio}%</td>
                        <td className={`text-right px-3 py-2 font-medium tabular-nums whitespace-nowrap ${isPositive ? 'text-emerald-600' : 'text-rose-600'}`}>
                          {yoy !== '-' ? `${isPositive ? '+' : ''}${yoy}%` : '-'}
                        </td>
                      </tr>
                    );
                  })}
                  {/* í•©ê³„ í–‰ */}
                  {(() => {
                    const totalPrev = getBSConsolidatedTotal(selectedBSAccount, bsPrevPeriod);
                    const totalCurr = getBSConsolidatedTotal(selectedBSAccount, bsCurrentPeriod);
                    const totalYoy = totalPrev !== 0 ? ((totalCurr - totalPrev) / totalPrev * 100).toFixed(1) : '-';
                    const isPositive = parseFloat(totalYoy) >= 0;

                    return (
                      <tr className="bg-zinc-50 font-medium">
                        <td className="px-3 py-2 text-zinc-900 whitespace-nowrap">í•©ê³„</td>
                        <td className="text-right px-2 py-2 text-zinc-700 tabular-nums">{formatNumber(totalPrev)}</td>
                        <td className="text-right px-2 py-2 text-zinc-900 tabular-nums">{formatNumber(totalCurr)}</td>
                        <td className="text-right px-2 py-2 text-zinc-700 tabular-nums">100%</td>
                        <td className={`text-right px-3 py-2 tabular-nums whitespace-nowrap ${totalYoy === '-' ? 'text-zinc-400' : isPositive ? 'text-emerald-600' : 'text-rose-600'}`}>
                          {totalYoy !== '-' ? `${isPositive ? '+' : ''}${totalYoy}%` : '-'}
                        </td>
                      </tr>
                    );
                  })()}
                </tbody>
              </table>
            </div>

            {/* ë²•ì¸ë³„ ì¦ê° ë¶„ì„ */}
            <div className="bg-white rounded-lg border border-zinc-200 shadow-sm p-4">
              <div className="flex items-center justify-between mb-3">
                <h3 className="text-sm font-semibold text-zinc-900">
                  {balanceItems.find(i => i.key === selectedBSAccount)?.label || selectedBSAccount} ì¦ê° ë¶„ì„
                </h3>
                <button
                  onClick={() => setBsEditMode(!bsEditMode)}
                  className={`text-xs px-2 py-1 rounded transition-colors ${
                    bsEditMode 
                      ? 'bg-blue-500 text-white' 
                      : 'bg-zinc-100 text-zinc-600 hover:bg-zinc-200'
                  }`}
                >
                  {bsEditMode ? 'âœ“ ì™„ë£Œ' : 'âœï¸ í¸ì§‘'}
                </button>
              </div>
              <div className="space-y-2 text-xs">
                {(() => {
                  const curr2025 = getAlignedBSBreakdown(selectedBSAccount, bsCurrentPeriod);
                  const curr2024 = getAlignedBSBreakdown(selectedBSAccount, bsPrevPeriod);
                  
                  // ë²•ì¸ë³„ ì¦ê° ê³„ì‚°
                  const changes = Object.keys(curr2025)
                    .filter(entity => entity !== 'ê¸°íƒ€')
                    .map(entity => ({
                      name: entity,
                      currVal: curr2025[entity] || 0,
                      prevVal: curr2024[entity] || 0,
                      diff: (curr2025[entity] || 0) - (curr2024[entity] || 0),
                      rate: curr2024[entity] !== 0 ? ((curr2025[entity] - curr2024[entity]) / Math.abs(curr2024[entity]) * 100).toFixed(1) : 0
                    })).sort((a, b) => Math.abs(b.diff) - Math.abs(a.diff));
                  
                  const total2025 = getBSConsolidatedTotal(selectedBSAccount, bsCurrentPeriod);
                  const total2024 = getBSConsolidatedTotal(selectedBSAccount, bsPrevPeriod);
                  const totalDiff = total2025 - total2024;
                  
                  const colorMap = {
                    'OC(êµ­ë‚´)': { bg: 'bg-blue-50/50', border: 'border-blue-400' },
                    'ì¤‘êµ­': { bg: 'bg-amber-50/50', border: 'border-amber-400' },
                    'í™ì½©': { bg: 'bg-violet-50/50', border: 'border-violet-400' },
                  };
                  
                  return changes.map((row, idx) => {
                    const isPositive = row.diff >= 0;
                    const contribution = totalDiff !== 0 ? ((row.diff / Math.abs(totalDiff)) * 100).toFixed(0) : 0;
                    const diffBil = Math.round(row.diff / 100); // ì–µì› ë‹¨ìœ„
                    const colors = colorMap[row.name] || { bg: 'bg-zinc-50', border: 'border-zinc-300' };
                    
                    // í¸ì§‘ëœ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê³„ì‚°ëœ ê°’ ì‚¬ìš©
                    const editKey = `${selectedBSAccount}_${row.name}`;
                    const editedData = bsEditData[editKey] || {};
                    const displayAmount = editedData.amount !== undefined ? editedData.amount : `${isPositive ? '+' : ''}${formatNumber(diffBil)}`;
                    const displayRate = editedData.rate !== undefined ? editedData.rate : row.rate;
                    const displayContribution = editedData.contribution !== undefined ? editedData.contribution : contribution;
                    
                    return (
                      <div key={idx} className={`p-2.5 ${colors.bg} rounded-lg border-l-2 ${colors.border}`}>
                        <div className="flex items-center justify-between">
                          <span className="font-medium text-zinc-800">{row.name}</span>
                          {bsEditMode ? (
                            <input
                              type="text"
                              value={displayRate}
                              onChange={(e) => setBsEditData(prev => ({
                                ...prev,
                                [editKey]: { ...prev[editKey], rate: e.target.value }
                              }))}
                              className="w-16 text-right text-xs font-bold px-1.5 py-0.5 rounded bg-white border border-zinc-300 focus:outline-none focus:ring-1 focus:ring-blue-400"
                            />
                          ) : (
                            <span className={`text-xs font-bold px-1.5 py-0.5 rounded ${parseFloat(displayRate) >= 0 ? 'bg-emerald-100 text-emerald-700' : 'bg-rose-100 text-rose-700'}`}>
                              {parseFloat(displayRate) >= 0 ? 'â–²' : 'â–¼'} {displayRate}%
                            </span>
                          )}
                        </div>
                        <div className="mt-1.5 flex items-center justify-between text-[11px]">
                          {bsEditMode ? (
                            <input
                              type="text"
                              value={displayAmount}
                              onChange={(e) => setBsEditData(prev => ({
                                ...prev,
                                [editKey]: { ...prev[editKey], amount: e.target.value }
                              }))}
                              className="w-[100px] text-xs px-2 py-1 rounded bg-white border border-zinc-300 focus:outline-none focus:ring-1 focus:ring-blue-400"
                            />
                          ) : (
                            <span className="text-zinc-500">{displayAmount}ì–µì›</span>
                          )}
                          {bsEditMode ? (
                            <input
                              type="text"
                              value={displayContribution}
                              onChange={(e) => setBsEditData(prev => ({
                                ...prev,
                                [editKey]: { ...prev[editKey], contribution: e.target.value }
                              }))}
                              className="w-12 text-right text-xs px-1 py-0.5 rounded bg-white border border-zinc-300 focus:outline-none focus:ring-1 focus:ring-blue-400"
                            />
                          ) : (
                            <span className="text-zinc-400">ê¸°ì—¬ë„ {displayContribution}%</span>
                          )}
                        </div>
                      </div>
                    );
                  });
                })()}
              </div>
              
              {/* ì „ì²´ ìš”ì•½ */}
              {(() => {
                const total2025 = getBSConsolidatedTotal(selectedBSAccount, bsCurrentPeriod);
                const total2024 = getBSConsolidatedTotal(selectedBSAccount, bsPrevPeriod);
                const totalDiff = total2025 - total2024;
                const totalDiffBil = Math.round(totalDiff / 100);
                const totalChange = total2024 !== 0 ? ((totalDiff / Math.abs(total2024)) * 100).toFixed(1) : 0;
                const isPositive = totalDiff >= 0;
                
                // í¸ì§‘ëœ ì „ì²´ ë°ì´í„°
                const totalEditKey = `${selectedBSAccount}_total`;
                const totalEdited = bsEditData[totalEditKey] || {};
                const displayTotalAmount = totalEdited.amount !== undefined ? totalEdited.amount : `${isPositive ? '+' : ''}${formatNumber(totalDiffBil)}`;
                const displayTotalRate = totalEdited.rate !== undefined ? totalEdited.rate : `${isPositive ? '+' : ''}${totalChange}`;
                
                return (
                  <div className="mt-3 pt-3 border-t border-zinc-200">
                    <div className="flex items-center justify-between text-xs">
                      <span className="text-zinc-600 font-medium">ì „ì²´ YoY ë³€ë™</span>
                      {bsEditMode ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={displayTotalAmount}
                            onChange={(e) => setBsEditData(prev => ({
                              ...prev,
                              [totalEditKey]: { ...prev[totalEditKey], amount: e.target.value }
                            }))}
                            className="w-20 text-right text-xs font-bold px-1 py-0.5 rounded bg-white border border-zinc-300 focus:outline-none focus:ring-1 focus:ring-blue-400"
                          />
                          <span className="text-zinc-500">ì–µì› (</span>
                          <input
                            type="text"
                            value={displayTotalRate}
                            onChange={(e) => setBsEditData(prev => ({
                              ...prev,
                              [totalEditKey]: { ...prev[totalEditKey], rate: e.target.value }
                            }))}
                            className="w-14 text-right text-xs font-bold px-1 py-0.5 rounded bg-white border border-zinc-300 focus:outline-none focus:ring-1 focus:ring-blue-400"
                          />
                          <span className="text-zinc-500">%)</span>
                        </div>
                      ) : (
                        <span className={`font-bold ${parseFloat(displayTotalRate) >= 0 ? 'text-emerald-600' : 'text-rose-600'}`}>
                          {displayTotalAmount}ì–µì› ({displayTotalRate}%)
                        </span>
                      )}
                    </div>
                  </div>
                );
              })()}
            </div>
          </div>
        </div>
      </div>
    );
  };

  // ============================================
  // ë©”ì¸ ë Œë”ë§
  // ============================================
  return (
    <div className="min-h-screen bg-zinc-50">
      <div className="max-w-6xl mx-auto p-4">
        {/* í—¤ë” */}
        <div className="mb-12">
          <div className="flex items-center gap-4">
            <div className="w-14 h-14 bg-zinc-900 rounded-lg flex items-center justify-center">
              <span className="text-white font-bold text-lg">F&F</span>
            </div>
            <div>
              <h1 className="text-2xl font-semibold tracking-tight text-zinc-900">F&F Corporation</h1>
              <p className="text-sm text-zinc-500">
                {(() => {
                  const [yearStr, qStr] = selectedPeriod.split('_');
                  const quarterNum = (qStr || 'Q4').replace('Q', '');
                  return `${yearStr} ${quarterNum}Q`;
                })()} ì—°ê²° ì¬ë¬´ì œí‘œ
              </p>
            </div>
          </div>
        </div>

        {/* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ë° ê¸°ê°„ ì„ íƒ */}
        <div className="mb-6 flex items-center justify-between">
          <div className="inline-flex p-0.5 bg-zinc-100 rounded-lg border border-zinc-200">
            {tabs.map((tab) => (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={`px-4 py-2 text-sm font-medium rounded transition-all duration-150 ${
                  activeTab === tab.id
                    ? 'bg-white text-zinc-900 border border-zinc-200'
                    : 'text-zinc-500 hover:text-zinc-700'
                }`}
              >
                {tab.label}
              </button>
            ))}
          </div>
          <div className="flex items-center gap-2">
            <select
              value={selectedPeriod}
              onChange={(e) => setSelectedPeriod(e.target.value)}
              className="px-4 py-2 bg-zinc-900 text-white text-sm font-medium rounded-lg border-none outline-none cursor-pointer hover:bg-zinc-800 transition-colors"
            >
              <option value="2025_Q1">FY2025 1Q</option>
              <option value="2025_Q2">FY2025 2Q</option>
              <option value="2025_Q3">FY2025 3Q</option>
              <option value="2025_Q4">FY2025 4Q</option>
            </select>
          </div>
        </div>

        {/* íƒ­ ì»¨í…ì¸  */}
        <div>
          {activeTab === 'summary' && renderSummaryTab()}
          {activeTab === 'income' && renderIncomeTab()}
          {activeTab === 'balance' && renderBalanceSheetTab()}
        </div>

        {/* í‘¸í„° */}
        <div className="mt-6 pt-4 border-t border-zinc-200">
          <p className="text-xs text-zinc-400 text-center">
            Â© 2025 F&F Corporation | ë‹¨ìœ„: ë°±ë§Œì›
          </p>
        </div>
      </div>
    </div>
  );
}
